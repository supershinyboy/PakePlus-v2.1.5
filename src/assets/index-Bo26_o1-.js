import{T as ft,H as De}from"./ThemeToggle-Bp7zvWHW.js";import{k as re,c as P,i as k,l as gt,a as d,n as kt,p as Z,b as o,C as Tt,F as ve,q as yt,s as wt,v as bt,x as ht,r as A,y as Be,z as _t,o as Ct,A as O,e as j,w as s,u as c,d as E,g as Ee,B as Pe,D as ue,f as xt,j as f,N as h,t as S,E as W,G as ae,H as $t,I as F}from"./index-BpMbMj_Q.js";import{_ as St}from"./xiaoyugan-Dwisk7G8.js";import Ut from"./manual-BKS2DslF.js";import Mt from"./url-BgaCQvkh.js";import{E as At,B as zt,T as Dt}from"./bin-DlpxIH6m.js";import Bt from"./wxqrcode-QG7bkBKT.js";import{_ as Et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Pt,C as It}from"./index-B_NaE_cW.js";import{C as Rt,a as de,S as Lt,T as Nt}from"./index-CWfAo2FS.js";import{A as Ie}from"./Add-7CRxGcAc.js";import{M as Ot}from"./Menu-C3OqYOwk.js";import{g as Oe,s as je,a as We,b as jt,i as Re,c as Wt,B as Ft}from"./index-DBlk97ae.js";import{R as ce}from"./Refresh-CoAARex0.js";import{E as Le}from"./EllipsisHorizontal-HzdRbbht.js";import"./AlertCircleOutline-PAtvzIPg.js";import"./CloudUpload-BOM7Afdd.js";import"./index-DEaShs97.js";import"./render-function-C-9MvElU.js";const Vt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Qt=gt('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),Gt=[Qt],Ht=re({name:"List",render:function(g,i){return k(),P("svg",Vt,Gt)}}),Kt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Jt=d("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),qt=[Jt],Ne=re({name:"Star",render:function(g,i){return k(),P("svg",Kt,qt)}}),Xt=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],Yt=["normal","processing","success","warning","danger"];var me=re({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:p=>Yt.includes(p)},count:{type:Number}},setup(p,{slots:g}){const{status:i,color:U,dotStyle:a,offset:I,text:r,dot:v,maxCount:D,count:x}=kt(p),y=Oe("badge"),V=Zt(y,i==null?void 0:i.value,g==null?void 0:g.default),R=Z(()=>{const L={...(a==null?void 0:a.value)||{}},[M,z]=(I==null?void 0:I.value)||[];M&&(L.marginRight=`${-M}px`),z&&(L.marginTop=`${z}px`);const B=!(U!=null&&U.value)||Xt.includes(U==null?void 0:U.value)?{}:{backgroundColor:U.value};return{mergedStyle:{...B,...L},computedDotStyle:L,computedColorStyle:B}}),Q=()=>{const L=r==null?void 0:r.value,M=U==null?void 0:U.value,z=i==null?void 0:i.value,B=v==null?void 0:v.value,N=Number(x==null?void 0:x.value),ee=(x==null?void 0:x.value)!=null,{computedDotStyle:_,mergedStyle:K}=R.value;return g.content?o("span",{class:`${y}-custom-dot`,style:_},[g.content()]):L&&!M&&!z?o("span",{class:`${y}-text`,style:_},[L]):z||M&&!ee?o("span",{class:`${y}-status-wrapper`},[o("span",{class:[`${y}-status-dot`,{[`${y}-status-${z}`]:z,[`${y}-color-${M}`]:M}],style:K},null),L&&o("span",{class:`${y}-status-text`},[L])]):(B||M)&&N>0?o("span",{class:[`${y}-dot`,{[`${y}-color-${M}`]:M}],style:K},null):N===0?null:o("span",{class:`${y}-number`,style:K},[o("span",null,[D.value&&N>D.value?`${D.value}+`:N])])};return()=>o("span",{class:V.value},[g.default&&g.default(),Q()])}});const Zt=(p,g,i)=>Z(()=>[p,{[`${p}-status`]:g,[`${p}-no-children`]:!i}]),en=Object.assign(me,{install:(p,g)=>{je(p,g);const i=We(g);p.component(i+me.name,me)}});var pe=re({name:"Space",props:{align:{type:String},direction:{type:String,default:"horizontal"},size:{type:[Number,String,Array],default:"small"},wrap:{type:Boolean},fill:{type:Boolean}},setup(p,{slots:g}){const i=Oe("space"),U=Z(()=>{var v;return(v=p.align)!=null?v:p.direction==="horizontal"?"center":""}),a=Z(()=>[i,{[`${i}-${p.direction}`]:p.direction,[`${i}-align-${U.value}`]:U.value,[`${i}-wrap`]:p.wrap,[`${i}-fill`]:p.fill}]);function I(v){if(Wt(v))return v;switch(v){case"mini":return 4;case"small":return 8;case"medium":return 16;case"large":return 24;default:return 8}}const r=v=>{const D={},x=`${I(Re(p.size)?p.size[0]:p.size)}px`,y=`${I(Re(p.size)?p.size[1]:p.size)}px`;return v?p.wrap?{marginBottom:y}:{}:(p.direction==="horizontal"&&(D.marginRight=x),(p.direction==="vertical"||p.wrap)&&(D.marginBottom=y),D)};return()=>{var v;const D=jt((v=g.default)==null?void 0:v.call(g),!0).filter(x=>x.type!==Tt);return o("div",{class:a.value},[D.map((x,y)=>{var V,R;const Q=g.split&&y>0;return o(ve,{key:(V=x.key)!=null?V:`item-${y}`},[Q&&o("div",{class:`${i}-item-split`,style:r(!1)},[(R=g.split)==null?void 0:R.call(g)]),o("div",{class:`${i}-item`,style:r(y===D.length-1)},[x])])})])}}});const tn=Object.assign(pe,{install:(p,g)=>{je(p,g);const i=We(g);p.component(i+pe.name,pe)}}),nn={class:"token-import-page"},on={class:"container"},sn={class:"page-header"},an={class:"header-content"},rn={class:"header-top"},ln={class:"card-header"},un={class:"card-body"},dn={key:0,class:"tokens-section"},cn={class:"section-header"},mn={class:"header-actions"},pn={key:0,class:"tokens-grid"},vn={class:"token-display"},fn={class:"token-value"},gn=["onClick"],kn={class:"remark-value"},Tn={class:"token-timestamps"},yn={class:"timestamp-item"},wn={class:"timestamp-value"},bn={class:"timestamp-item"},hn={class:"timestamp-value"},_n={class:"storage-info"},Cn={class:"storage-item"},xn={key:0,class:"storage-upgrade"},$n={key:1,class:"tokens-list"},Sn={style:{"min-width":"65px"}},Un={style:{"min-width":"100px"}},Mn={style:{display:"flex","align-items":"center","flex-wrap":"wrap",gap:"2px"}},An={style:{"font-weight":"bold","font-size":"0.95em"}},zn=["onClick"],Dn={class:"modal-actions"},Bn={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(p){const{getArrayBuffer:g}=yt(),i=p,U=xt(),a=wt(),I=bt(),r=ht(),v=A(!1),D=A(!1),x=A(!1);A(null),A(null);const y=A(null),V=A(null),R=A("manual"),Q=A(new Set),L=A(new Set),M=A(localStorage.getItem("tokenViewMode")||"list"),z=A(null),B=A(null),N=A({});Be(M,t=>{localStorage.setItem("tokenViewMode",t)});const ee=localStorage.getItem("tokenSortConfig"),_=A(ee?JSON.parse(ee):{field:"createdAt",direction:"asc"}),K=Z(()=>[...r.gameTokens].sort((t,e)=>{var b,w,C,T,se,G;let l,u;switch(_.value.field){case"name":l=((b=t.name)==null?void 0:b.toLowerCase())||"",u=((w=e.name)==null?void 0:w.toLowerCase())||"";break;case"server":l=((C=t.server)==null?void 0:C.toLowerCase())||"",u=((T=e.server)==null?void 0:T.toLowerCase())||"";break;case"createdAt":l=new Date(t.createdAt||0).getTime(),u=new Date(e.createdAt||0).getTime();break;case"lastUsed":l=new Date(t.lastUsed||0).getTime(),u=new Date(e.lastUsed||0).getTime();break;default:l=((se=t.name)==null?void 0:se.toLowerCase())||"",u=((G=e.name)==null?void 0:G.toLowerCase())||""}return l<u?_.value.direction==="asc"?-1:1:l>u?_.value.direction==="asc"?1:-1:0})),te=t=>{_.value.field===t?_.value.direction=_.value.direction==="asc"?"desc":"asc":(_.value.field=t,_.value.direction="asc"),localStorage.setItem("tokenSortConfig",JSON.stringify(_.value))},ne=t=>_.value.field!==t?null:_.value.direction==="asc"?"↑":"↓",fe=(t,e)=>{z.value=t,e.dataTransfer.effectAllowed="move"},ge=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},ke=(t,e)=>{if(e.preventDefault(),z.value===null||z.value===t)return;const l=[...r.gameTokens],u=l[z.value];l.splice(z.value,1),l.splice(t,0,u),r.gameTokens=l,z.value=null,a.success("Token 顺序已更新")},$=_t({name:"",token:"",server:"",wsUrl:"",remark:""}),Fe={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},Ve=[{label:"刷新所有Token",key:"refreshAll"},{label:"更新token信息",key:"updateInfo"},{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],Qe=()=>{v.value=!0},J=async t=>{Q.value.add(t.id);try{if(t.importMethod==="url"){let e;if(t.sourceUrl.startsWith(window.location.origin)||t.sourceUrl.startsWith("/")||t.sourceUrl.startsWith("http://localhost")||t.sourceUrl.startsWith("http://127.0.0.1"))e=await fetch(t.sourceUrl);else try{e=await fetch(t.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(b){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${b.message}`)}if(!e.ok)throw new Error(`请求失败: ${e.status} ${e.statusText}`);const u=await e.json();if(!u.token)throw new Error("返回数据中未找到token字段");r.updateToken(t.id,{token:u.token,server:u.server||t.server,lastRefreshed:Date.now()}),a.success("Token刷新成功")}else if(t.importMethod==="wxQrcode"||t.importMethod==="bin"){const e=await g(t.name);if(e){const l=await $t(e);r.updateToken(t.id,{token:l,lastRefreshed:Date.now()}),a.success("Token刷新成功")}}else{I.info({title:"重新获取Token",content:`Token "${t.name}" 是通过微信扫码登录导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{v.value=!0,R.value="manual",importForm.name=t.name,importForm.server=t.server,importForm.wsUrl=t.wsUrl},onNegativeClick:()=>{r.getWebSocketStatus(t.id)==="connected"&&r.closeWebSocketConnection(t.id),setTimeout(()=>{r.createWebSocketConnection(t.id,t.token,t.wsUrl),a.info("正在尝试重新连接...")},500)}});return}r.getWebSocketStatus(t.id)==="connected"&&(r.closeWebSocketConnection(t.id),setTimeout(()=>{r.createWebSocketConnection(t.id,t.token,t.wsUrl)},500))}catch(e){console.error("刷新Token失败:",e),a.error(e.message||"Token刷新失败")}finally{Q.value.delete(t.id)}},Te=t=>{I.warning({title:"升级为长期有效",content:`确认要将Token "${t.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{r.upgradeTokenToPermanent(t.id)?a.success(`Token "${t.name}" 已升级为长期有效！`):a.error("升级失败，该Token可能已经是长期有效状态")}})},ye=(t,e=!1)=>{if(B.value){xe();return}const l=ue.value===t.id,u=q(t.id);if(l&&u==="connected"&&!e){r.closeWebSocketConnection(t.id),a.success(`已断开 ${t.name} 的连接`);return}if(!l&&u==="connected"&&!e){r.closeWebSocketConnection(t.id),a.success(`已断开 ${t.name} 的连接`);return}if(l&&u==="connecting"&&!e){a.info(`${t.name} 正在连接中...`);return}r.selectToken(t.id,e)?e?a.success(`强制重连：${t.name}`):l?a.success(`重新连接：${t.name}`):a.success(`已选择：${t.name}`):a.error(`选择Token失败：${t.name}`)},q=t=>r.getWebSocketStatus(t),we=t=>{const e=q(t);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[e]||"未连接"},be=t=>{const e=q(t);return{connected:"success",connecting:"warning",disconnected:"danger",error:"danger",disconnecting:"warning"}[e]||"danger"},Ge=t=>q(t)==="connected"?"success":"error",He=t=>q(t)==="connected"?"green":"red",he=t=>{const e=[{label:"编辑",key:"edit",icon:()=>F(h,null,{default:()=>F(de)})},{label:"复制Token",key:"copy",icon:()=>F(h,null,{default:()=>F(It)})}];return t.importMethod==="url"&&t.sourceUrl?e.push({label:"从URL刷新",key:"refresh-url",icon:()=>F(h,null,{default:()=>F(Lt)})}):e.push({label:"重新获取",key:"refresh",icon:()=>F(h,null,{default:()=>F(ce)})}),e.push({type:"divider"},{label:"删除",key:"delete",icon:()=>F(h,null,{default:()=>F(Nt)}),props:{style:{color:"#e74c3c"}}}),e},_e=async(t,e)=>{switch(t){case"edit":Ke(e);break;case"copy":qe(e);break;case"refresh":J(e);break;case"refresh-url":J(e);break;case"delete":Xe(e);break}},Ke=t=>{V.value=t,Object.assign($,{name:t.name,token:t.token,server:t.server||"",wsUrl:t.wsUrl||"",remark:t.remark||""}),x.value=!0},Je=async()=>{if(!(!y.value||!V.value))try{await y.value.validate(),r.updateToken(V.value.id,{name:$.name,token:$.token,server:$.server,wsUrl:$.wsUrl,remark:$.remark}),a.success("Token信息已更新"),x.value=!1,V.value=null}catch{}},qe=async t=>{try{await navigator.clipboard.writeText(t.token),a.success("Token已复制到剪贴板")}catch{a.error("复制失败")}},Ce=t=>{B.value=t.id,N.value[t.id]=t.remark||""},xe=()=>{if(!B.value)return;const t=B.value,e=N.value[t]||"";r.updateToken(t,{remark:e}),B.value=null,a.success("备注已保存")},oe=t=>{xe()},$e=()=>{B.value=null},Xe=t=>{I.warning({title:"删除Token",content:`确定要删除Token "${t.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{r.removeToken(t.id),a.success("Token已删除")}})},Ye=async()=>{if(!r.gameTokens.length){a.warning("没有可刷新的Token");return}const t=r.gameTokens.filter(l=>l.importMethod==="url"||l.importMethod==="wxQrcode"||l.importMethod==="bin"),e=r.gameTokens.filter(l=>l.importMethod==="manual");if(t.length===0){a.warning("没有支持自动刷新的Token");return}I.warning({title:"批量刷新Token",content:"确定要刷新所有支持自动刷新的Token吗?",positiveText:"开始刷新",negativeText:"取消",onPositiveClick:async()=>{try{let l=0,u=0;const b=a.loading(`正在批量刷新Token (0/${t.length})`,{duration:0});for(let w=0;w<t.length;w++){const C=t[w];try{b.content=`正在刷新Token (${w+1}/${t.length}): ${C.name}`,await J(C),l++}catch(T){console.error(`刷新Token "${C.name}" 失败:`,T),u++}w<t.length-1&&await new Promise(T=>setTimeout(T,500))}b.destroy(),u===0?a.success(`批量刷新完成！成功刷新 ${l} 个Token`):a.warning(`批量刷新完成，成功 ${l} 个，失败 ${u} 个`),e.length>0&&a.info(`${e.length} 个手动导入的Token需要手动刷新`)}catch(l){a.error("批量刷新过程中发生错误: "+l.message)}}})},Ze=t=>{switch(t){case"refreshAll":Ye();break;case"updateInfo":at();break;case"export":et();break;case"import":tt();break;case"clean":nt();break;case"disconnect":ot();break;case"clear":st();break}},et=()=>{try{const t=r.exportTokens(),e=JSON.stringify(t,null,2),l=new Blob([e],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(l),u.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,u.click(),a.success("Token数据已导出")}catch{a.error("导出失败")}},tt=()=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{const l=e.target.files[0];if(l){const u=new FileReader;u.onload=b=>{try{const w=JSON.parse(b.target.result),C=r.importTokens(w);C.success?a.success(C.message):a.error(C.message)}catch{a.error("文件格式错误")}},u.readAsText(l)}},t.click()},nt=()=>{const t=r.cleanExpiredTokens();a.success(`已清理 ${t} 个过期Token`)},ot=()=>{r.gameTokens.forEach(t=>{r.closeWebSocketConnection(t.id)}),a.success("所有连接已断开")},st=()=>{I.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{r.clearAllTokens(),a.success("所有Token已清除")}})},at=async()=>{if(r.gameTokens.length===0){a.warning("没有可更新的Token");return}I.warning({title:"更新所有Token信息",content:`此操作将逐个连接所有Token，获取最新的角色名称和服务器信息，完成后自动断开连接。

预计耗时：约3-5秒/个Token`,positiveText:"开始更新",negativeText:"取消",onPositiveClick:async()=>{try{let t=0,e=0;const l=r.gameTokens.length,u=a.loading(`正在更新Token信息 (0/${l})`,{duration:0});for(let b=0;b<r.gameTokens.length;b++){const w=r.gameTokens[b];u.content=`正在更新Token信息 (${b+1}/${l}): ${w.name}`;try{await r.selectToken(w.id),await new Promise(C=>setTimeout(C,1e3)),r.closeWebSocketConnection(w.id),t++,a.success(`Token "${w.name}" 信息更新成功`)}catch(C){console.error(`更新Token "${w.name}" 失败:`,C),e++,a.error(`Token "${w.name}" 信息更新失败`)}b<r.gameTokens.length-1&&await new Promise(C=>setTimeout(C,500))}u.destroy(),e===0?a.success(`所有Token信息更新完成！成功更新 ${t} 个Token`):a.warning(`Token信息更新完成，成功 ${t} 个，失败 ${e} 个`)}catch(t){a.error("更新过程中发生错误: "+t.message)}}})},rt=t=>{if(!t)return"";const e=t.length;return e<=8?t:t.substring(0,4)+"***"+t.substring(e-4)},Se=t=>new Date(t).toLocaleString("zh-CN"),lt=()=>{U.push("/admin/batch-daily-tasks")},Ue=t=>{r.selectToken(t.id),a.success(`正在进入 ${t.name} 的控制台`),U.push("/admin/dashboard")},Me=async()=>{if(i.token||i.api)try{D.value=!0;let t=null;if(i.api){a.info("正在从API获取token...");const e=await fetch(i.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!e.ok)throw new Error(`API请求失败: ${e.status} ${e.statusText}`);const l=await e.json();if(!l.token)throw new Error("API返回数据中未找到token字段");t=r.importBase64Token(i.name||l.name||"通过API导入的Token",l.token,{server:i.server||l.server,wsUrl:i.wsUrl,sourceUrl:i.api,importMethod:"url"})}else i.token&&(a.info("正在导入token..."),t=r.importBase64Token(i.name||"通过URL导入的Token",i.token,{server:i.server,wsUrl:i.wsUrl,importMethod:"url"}));if(t&&t.success)a.success(`Token "${t.tokenName}" 导入成功！`),i.auto&&t.token?(r.selectToken(t.token.id),a.success("正在跳转到控制台..."),setTimeout(()=>{U.push("/admin/dashboard")},1500)):U.replace("/tokens");else throw new Error((t==null?void 0:t.message)||"Token导入失败")}catch(t){console.error("URL参数处理失败:",t),a.error(`导入失败: ${t.message}`),U.replace("/tokens")}finally{D.value=!1}};return Be(()=>[i.token,i.api],Me,{immediate:!1}),Ct(async()=>{r.initTokenStore(),await Me(),!r.hasTokens&&!i.token&&!i.api&&(v.value=!0)}),(t,e)=>{const l=ft,u=E("n-radio-button"),b=E("n-radio-group"),w=Pt,C=E("n-divider"),T=E("n-button"),se=E("n-button-group"),G=E("n-space"),le=E("n-dropdown"),it=Dt,Ae=en,ut=tn,H=E("n-input"),ze=Ft,ie=E("n-tag"),dt=Rt,ct=E("n-card"),mt=At,X=E("n-form-item"),pt=E("n-form"),vt=E("n-modal");return k(),P("div",nn,[d("div",on,[d("div",sn,[d("div",an,[d("div",rn,[e[30]||(e[30]=d("img",{src:St,alt:"XYZW",class:"brand-logo"},null,-1)),o(l)]),e[31]||(e[31]=d("h1",null,"游戏Token管理",-1))])]),o(w,{class:"token-import-modal",visible:v.value,"onUpdate:visible":e[9]||(e[9]=n=>v.value=n),width:"40rem",footer:!1,"default-visible":!c(r).hasTokens},{title:s(()=>[d("h2",null,[o(c(h),null,{default:s(()=>[o(c(Ie))]),_:1}),e[32]||(e[32]=f(" 添加游戏Token ",-1))])]),default:s(()=>[d("div",ln,[o(b,{value:R.value,"onUpdate:value":e[0]||(e[0]=n=>R.value=n),class:"import-method-tabs",size:"small"},{default:s(()=>[o(u,{value:"manual"},{default:s(()=>[...e[33]||(e[33]=[f(" 手动输入 ",-1)])]),_:1}),o(u,{value:"url"},{default:s(()=>[...e[34]||(e[34]=[f(" URL获取 ",-1)])]),_:1}),o(u,{value:"wxQrcode"},{default:s(()=>[...e[35]||(e[35]=[f(" 微信扫码获取 ",-1)])]),_:1}),o(u,{value:"bin"},{default:s(()=>[...e[36]||(e[36]=[f(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),d("div",un,[R.value==="manual"?(k(),j(Ut,{key:0,onCancel:e[1]||(e[1]=()=>v.value=!1),onOk:e[2]||(e[2]=()=>v.value=!1)})):O("",!0),R.value==="url"?(k(),j(Mt,{key:1,onCancel:e[3]||(e[3]=()=>v.value=!1),onOk:e[4]||(e[4]=()=>v.value=!1)})):O("",!0),R.value==="wxQrcode"?(k(),j(Bt,{key:2,onCancel:e[5]||(e[5]=()=>v.value=!1),onOk:e[6]||(e[6]=()=>v.value=!1)})):O("",!0),R.value==="bin"?(k(),j(zt,{key:3,onCancel:e[7]||(e[7]=()=>v.value=!1),onOk:e[8]||(e[8]=()=>v.value=!1)})):O("",!0)])]),_:1},8,["visible","default-visible"]),c(r).hasTokens?(k(),P("div",dn,[d("div",cn,[o(G,{align:"center"},{default:s(()=>[d("h2",null,"我的Token列表 ("+S(c(r).gameTokens.length)+"个)",1),o(b,{value:M.value,"onUpdate:value":e[10]||(e[10]=n=>M.value=n),size:"small"},{default:s(()=>[o(u,{value:"list"},{default:s(()=>[...e[37]||(e[37]=[f("列表",-1)])]),_:1}),o(u,{value:"card"},{default:s(()=>[...e[38]||(e[38]=[f("卡片",-1)])]),_:1})]),_:1},8,["value"]),o(C,{vertical:"",style:{height:"24px"}}),o(se,{size:"small"},{default:s(()=>[o(T,{onClick:e[11]||(e[11]=n=>te("name")),type:_.value.field==="name"?"primary":"default"},{default:s(()=>[f(" 名称 "+S(ne("name")),1)]),_:1},8,["type"]),o(T,{onClick:e[12]||(e[12]=n=>te("server")),type:_.value.field==="server"?"primary":"default"},{default:s(()=>[f(" 服务器 "+S(ne("server")),1)]),_:1},8,["type"]),o(T,{onClick:e[13]||(e[13]=n=>te("createdAt")),type:_.value.field==="createdAt"?"primary":"default"},{default:s(()=>[f(" 创建时间 "+S(ne("createdAt")),1)]),_:1},8,["type"]),o(T,{onClick:e[14]||(e[14]=n=>te("lastUsed")),type:_.value.field==="lastUsed"?"primary":"default"},{default:s(()=>[f(" 最后使用 "+S(ne("lastUsed")),1)]),_:1},8,["type"])]),_:1})]),_:1}),d("div",mn,[o(T,{type:"success",onClick:lt},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Ht))]),_:1})]),default:s(()=>[e[39]||(e[39]=f(" 批量功能 ",-1))]),_:1}),v.value?O("",!0):(k(),j(T,{key:0,type:"primary",onClick:e[15]||(e[15]=n=>v.value=!0)},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Ie))]),_:1})]),default:s(()=>[e[40]||(e[40]=f(" 添加Token ",-1))]),_:1})),o(le,{options:Ve,onSelect:Ze},{default:s(()=>[o(T,null,{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Ot))]),_:1})]),default:s(()=>[e[41]||(e[41]=f(" 批量操作 ",-1))]),_:1})]),_:1})])]),M.value==="card"?(k(),P("div",pn,[(k(!0),P(ve,null,Ee(c(K),(n,Y)=>(k(),j(dt,{key:n.id,draggable:"true",onDragstart:m=>fe(Y,m),onDragover:e[18]||(e[18]=m=>ge(m)),onDrop:m=>ke(Y,m),class:Pe({"token-card":!0,active:c(ue)===n.id}),onClick:m=>ye(n)},{title:s(()=>[o(ut,{class:"token-name"},{default:s(()=>[f(S(n.name)+" ",1),n.server?(k(),j(it,{key:0,color:He(n.id)},{default:s(()=>[f(S(n.server),1)]),_:2},1032,["color"])):O("",!0),o(Ae,{status:be(n.id),text:we(n.id)},null,8,["status","text"])]),_:2},1024)]),extra:s(()=>[o(le,{options:he(n),onSelect:m=>_e(m,n)},{default:s(()=>[o(T,{text:""},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Le))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:s(()=>[d("div",vn,[e[42]||(e[42]=d("span",{class:"token-label"},"Token:",-1)),d("code",fn,S(rt(n.token)),1)]),B.value===n.id?(k(),P("div",{key:0,class:"token-remark token-remark-edit",onClick:e[17]||(e[17]=W(()=>{},["stop"]))},[e[43]||(e[43]=d("span",{class:"remark-label"},"备注：",-1)),o(H,{value:N.value[n.id],"onUpdate:value":m=>N.value[n.id]=m,type:"textarea",rows:2,placeholder:"添加备注信息...",onBlur:m=>oe(n),onKeyup:[ae(m=>oe(n),["enter"]),e[16]||(e[16]=ae(m=>$e(),["esc"]))],autofocus:""},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(k(),P("div",{key:1,class:"token-remark",onClick:W(m=>Ce(n),["stop"])},[e[44]||(e[44]=d("span",{class:"remark-label"},"备注：",-1)),d("span",kn,S(n.remark||"点击添加备注"),1),o(c(h),{style:{"margin-left":"4px",color:"var(--text-tertiary)"}},{default:s(()=>[o(c(de))]),_:1})],8,gn)),o(ze,{loading:Q.value.has(n.id),onClick:W(m=>J(n),["stop"])},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(ce))]),_:1})]),default:s(()=>[f(" "+S(n.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),d("div",Tn,[d("div",yn,[e[45]||(e[45]=d("span",{class:"timestamp-label"},"创建：",-1)),d("span",wn,S(Se(n.createdAt)),1)]),d("div",bn,[e[46]||(e[46]=d("span",{class:"timestamp-label"},"使用：",-1)),d("span",hn,S(Se(n.lastUsed)),1)])]),d("div",_n,[d("div",Cn,[e[47]||(e[47]=d("span",{class:"storage-label"},"存储类型：",-1)),o(ie,{size:"small",type:n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?"success":"warning"},{default:s(()=>[f(S(n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?O("",!0):(k(),P("div",xn,[o(T,{size:"tiny",type:"success",ghost:"",onClick:W(m=>Te(n),["stop"])},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Ne))]),_:1})]),default:s(()=>[e[48]||(e[48]=f(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])]))])]),actions:s(()=>[o(T,{type:"primary",size:"large",block:"",loading:L.value.has(n.id),onClick:m=>Ue(n)},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(De))]),_:1})]),default:s(()=>[e[49]||(e[49]=f(" 进入控制台 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["onDragstart","onDrop","class","onClick"]))),128))])):(k(),P("div",$n,[(k(!0),P(ve,null,Ee(c(K),(n,Y)=>(k(),j(ct,{key:n.id,draggable:"true",onDragstart:m=>fe(Y,m),onDragover:e[22]||(e[22]=m=>ge(m)),onDrop:m=>ke(Y,m),size:"small",style:{"margin-bottom":"8px"},hoverable:"",onClick:m=>ye(n),class:Pe({active:c(ue)===n.id})},{default:s(()=>[o(G,{justify:"space-between",align:"center"},{default:s(()=>[o(G,{align:"center",size:6},{default:s(()=>[d("div",Sn,[o(Ae,{status:be(n.id),text:we(n.id)},null,8,["status","text"])]),d("div",Un,[d("div",Mn,[d("span",An,S(n.name),1),n.server?(k(),j(ie,{key:0,size:"small",type:Ge(n.id)},{default:s(()=>[f(S(n.server),1)]),_:2},1032,["type"])):O("",!0),B.value===n.id?(k(),P("div",{key:1,style:{"font-size":"0.75em",display:"flex","align-items":"center",gap:"4px"},onClick:e[20]||(e[20]=W(()=>{},["stop"]))},[e[50]||(e[50]=d("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),o(H,{value:N.value[n.id],"onUpdate:value":m=>N.value[n.id]=m,size:"small",placeholder:"添加备注...",onBlur:m=>oe(n),onKeyup:[ae(m=>oe(n),["enter"]),e[19]||(e[19]=ae(m=>$e(),["esc"]))],autofocus:"",style:{width:"150px"}},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(k(),P("div",{key:2,style:{"font-size":"0.75em",color:"var(--text-secondary)","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer",display:"flex","align-items":"center",gap:"4px"},onClick:W(m=>Ce(n),["stop"])},[e[51]||(e[51]=d("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),f(" "+S(n.remark||"点击添加备注")+" ",1),o(c(h),{style:{"font-size":"0.8em",color:"var(--text-tertiary)"}},{default:s(()=>[o(c(de))]),_:1})],8,zn))])])]),_:2},1024),o(G,null,{default:s(()=>[o(ie,{size:"small",type:n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?"success":"warning"},{default:s(()=>[f(S(n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?"长期":"临时"),1)]),_:2},1032,["type"]),n.importMethod==="url"||n.importMethod==="bin"||n.importMethod==="wxQrcode"||n.upgradedToPermanent?O("",!0):(k(),j(T,{key:0,size:"small",type:"success",ghost:"",onClick:W(m=>Te(n),["stop"])},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Ne))]),_:1})]),default:s(()=>[e[52]||(e[52]=f(" 升级 ",-1))]),_:1},8,["onClick"])),o(T,{size:"small",type:"primary",loading:L.value.has(n.id),onClick:W(m=>Ue(n),["stop"])},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(De))]),_:1})]),default:s(()=>[e[53]||(e[53]=f(" 控制台 ",-1))]),_:1},8,["loading","onClick"]),o(T,{size:"small",onClick:W(m=>J(n),["stop"]),loading:Q.value.has(n.id)},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(ce))]),_:1})]),default:s(()=>[e[54]||(e[54]=f(" 刷新 ",-1))]),_:1},8,["onClick","loading"]),o(le,{options:he(n),onSelect:m=>_e(m,n)},{default:s(()=>[o(T,{size:"small",circle:"",onClick:e[21]||(e[21]=W(()=>{},["stop"]))},{icon:s(()=>[o(c(h),null,{default:s(()=>[o(c(Le))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDragstart","onDrop","onClick","class"]))),128))]))])):O("",!0),!c(r).hasTokens&&!v.value?(k(),j(mt,{key:1},{image:s(()=>[...e[55]||(e[55]=[d("i",{class:"mdi:bed-empty"},null,-1)])]),default:s(()=>[e[57]||(e[57]=f(" 还没有导入任何Token ",-1)),o(ze,{type:"link",onClick:Qe},{default:s(()=>[...e[56]||(e[56]=[f("打开Token管理",-1)])]),_:1})]),_:1})):O("",!0)]),o(vt,{show:x.value,"onUpdate:show":e[29]||(e[29]=n=>x.value=n),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:s(()=>[d("div",Dn,[o(T,{onClick:e[28]||(e[28]=n=>x.value=!1)},{default:s(()=>[...e[58]||(e[58]=[f(" 取消 ",-1)])]),_:1}),o(T,{type:"primary",onClick:Je},{default:s(()=>[...e[59]||(e[59]=[f(" 保存 ",-1)])]),_:1})])]),default:s(()=>[o(pt,{ref_key:"editFormRef",ref:y,model:$,rules:Fe,"label-placement":"left","label-width":"80px"},{default:s(()=>[o(X,{label:"名称",path:"name"},{default:s(()=>[o(H,{value:$.name,"onUpdate:value":e[23]||(e[23]=n=>$.name=n)},null,8,["value"])]),_:1}),o(X,{label:"Token字符串",path:"token"},{default:s(()=>[o(H,{value:$.token,"onUpdate:value":e[24]||(e[24]=n=>$.token=n),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),o(X,{label:"服务器"},{default:s(()=>[o(H,{value:$.server,"onUpdate:value":e[25]||(e[25]=n=>$.server=n)},null,8,["value"])]),_:1}),o(X,{label:"WebSocket地址"},{default:s(()=>[o(H,{value:$.wsUrl,"onUpdate:value":e[26]||(e[26]=n=>$.wsUrl=n)},null,8,["value"])]),_:1}),o(X,{label:"备注"},{default:s(()=>[o(H,{value:$.remark,"onUpdate:value":e[27]||(e[27]=n=>$.remark=n),type:"textarea",rows:2,placeholder:"添加备注信息..."},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},Zn=Et(Bn,[["__scopeId","data-v-26fb889b"]]);export{Zn as default};
