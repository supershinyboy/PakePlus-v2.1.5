import{v as useTokenStore,q as useMessage,p as computed,r as ref,y as reactive,x as watch,o as onMounted,Z as onBeforeUnmount,R as nextTick,c as createElementBlock,a as createBaseVNode,b as createVNode,e as createBlock,z as createCommentVNode,t as toDisplayString,w as withCtx,d as resolveComponent,i as openBlock,j as createTextVNode,u as unref,F as Fragment,g as renderList,D as withModifiers,J as normalizeStyle,A as normalizeClass,a2 as preloadQuestions}from"./index-B5GXQUQo.js";import{D as DailyTaskRunner}from"./dailyTaskRunner-BYZ3jih5.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Settings}from"./Settings-Dn166i9N.js";const _hoisted_1={class:"batch-daily-tasks"},_hoisted_2={class:"main-layout"},_hoisted_3={class:"left-column"},_hoisted_4={class:"page-header",style:{display:"flex","justify-content":"space-between","align-items":"center","flex-wrap":"wrap",gap:"12px"}},_hoisted_5={style:{display:"flex","align-items":"center",gap:"16px"}},_hoisted_6={style:{display:"flex","align-items":"center",gap:"12px",padding:"8px 12px","background-color":"#f8f9fa","border-radius":"8px",border:"1px solid #e9ecef"}},_hoisted_7={style:{"font-size":"14px",color:"#495057"}},_hoisted_8={key:0,style:{"font-size":"14px","font-weight":"500",color:"#1677ff"}},_hoisted_9={key:1,style:{"font-size":"14px",color:"#6c757d"}},_hoisted_10={style:{display:"flex",gap:"8px"}},_hoisted_11={style:{display:"flex","align-items":"center",gap:"12px",padding:"8px 12px","background-color":"#f8f9fa","border-radius":"8px",border:"1px solid #e9ecef"}},_hoisted_12={class:"token-row"},_hoisted_13={class:"token-item"},_hoisted_14={class:"task-preview",style:{margin:"16px 0",padding:"16px",border:"1px solid #e5e7eb","border-radius":"8px","background-color":"#fafafa"}},_hoisted_15={key:0,style:{display:"flex","flex-direction":"column","align-items":"center",padding:"12px","background-color":"white","border-radius":"6px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)"}},_hoisted_16={style:{"font-size":"16px","font-weight":"bold","margin-bottom":"8px"}},_hoisted_17={key:1,style:{"text-align":"center",padding:"24px",color:"#6b7280","font-style":"italic"}},_hoisted_18={key:0,class:"tasks-count"},_hoisted_19={key:1,class:"tasks-count"},_hoisted_20={class:"right-column"},_hoisted_21={class:"custom-card-header"},_hoisted_22={class:"card-title"},_hoisted_23={class:"log-header-controls"},_hoisted_24={class:"time"},_hoisted_25={class:"message"},_hoisted_26={class:"settings-content"},_hoisted_27={class:"settings-grid"},_hoisted_28={class:"setting-item"},_hoisted_29={class:"setting-item"},_hoisted_30={class:"setting-item"},_hoisted_31={class:"setting-switches"},_hoisted_32={class:"switch-row"},_hoisted_33={class:"switch-row"},_hoisted_34={class:"switch-row"},_hoisted_35={class:"switch-row"},_hoisted_36={class:"switch-row"},_hoisted_37={class:"switch-row"},_hoisted_38={class:"switch-row"},_hoisted_39={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_40={class:"settings-content"},_hoisted_41={class:"settings-grid"},_hoisted_42={class:"setting-item"},_hoisted_43={key:0,class:"setting-item"},_hoisted_44={class:"recipient-info",style:{background:"#f7f8fa",padding:"16px","border-radius":"8px",border:"1px solid #e5e7eb",display:"flex","align-items":"flex-start",gap:"16px",transition:"all 0.3s ease"}},_hoisted_45={class:"avatar-container",style:{position:"relative",width:"80px",height:"80px","border-radius":"50%",overflow:"hidden",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex","align-items":"center","justify-content":"center",transition:"all 0.3s ease"}},_hoisted_46=["src"],_hoisted_47={key:1,class:"avatar-fallback",style:{display:"flex","align-items":"center","justify-content":"center",width:"100%",height:"100%",color:"white","font-size":"24px","font-weight":"bold","text-shadow":"0 2px 4px rgba(0, 0, 0, 0.3)"}},_hoisted_48={key:2,class:"avatar-loading",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}},_hoisted_49={class:"role-info",style:{flex:"1","min-width":"0"}},_hoisted_50={style:{"margin-bottom":"12px","font-size":"18px","font-weight":"bold",color:"#1d2129","text-shadow":"0 1px 2px rgba(0,0,0,0.1)"}},_hoisted_51={class:"role-info-grid",style:{display:"grid","grid-template-columns":"1fr 1fr",gap:"12px"}},_hoisted_52={class:"info-item"},_hoisted_53={class:"info-value",style:{"font-size":"14px","font-weight":"500",color:"#1d2129"}},_hoisted_54={class:"info-item"},_hoisted_55={class:"info-value",style:{"font-size":"14px","font-weight":"500",color:"#1d2129"}},_hoisted_56={class:"info-item"},_hoisted_57={class:"info-value",style:{"font-size":"16px","font-weight":"600",color:"#667eea"}},_hoisted_58={class:"info-item"},_hoisted_59={class:"info-value",style:{"font-size":"14px","font-weight":"500",color:"#1d2129"}},_hoisted_60={class:"info-item",style:{"grid-column":"1 / -1"}},_hoisted_61={class:"info-value",style:{"font-size":"14px","font-weight":"500",color:"#1d2129"}},_hoisted_62={class:"setting-item"},_hoisted_63={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_64={class:"settings-content"},_hoisted_65={class:"settings-grid"},_hoisted_66={key:0,class:"setting-item"},_hoisted_67={key:1,class:"setting-item"},_hoisted_68={class:"setting-item"},_hoisted_69={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_70={class:"tasks-list",style:{"max-height":"600px","overflow-y":"auto"}},_hoisted_71={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_72={style:{"font-weight":"bold"}},_hoisted_73={style:{"margin-bottom":"4px"}},_hoisted_74={style:{"margin-bottom":"4px"}},_hoisted_75={style:{"margin-bottom":"4px"}},_hoisted_76={style:{"margin-bottom":"4px"}},_hoisted_77={style:{"margin-bottom":"8px"}},_hoisted_78={style:{display:"flex",gap:"8px"}},_hoisted_79={key:0,style:{"text-align":"center",padding:"24px",color:"#6b7280"}},_hoisted_80={class:"settings-content"},_hoisted_81={class:"settings-grid"},_hoisted_82={class:"setting-item"},_hoisted_83={class:"setting-item"},_hoisted_84={key:0,class:"setting-item"},_hoisted_85={key:1,class:"setting-item"},_hoisted_86={key:0,class:"cron-parser"},_hoisted_87={key:0,class:"cron-validation success"},_hoisted_88={key:1,class:"cron-validation error"},_hoisted_89={key:2,class:"cron-next-runs"},_hoisted_90={class:"setting-item"},_hoisted_91={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_92={class:"setting-item"},_hoisted_93={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_94={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_95={class:"settings-content"},_hoisted_96={class:"settings-grid"},_hoisted_97={class:"setting-item"},_hoisted_98={class:"setting-item"},_hoisted_99={class:"setting-item"},_hoisted_100={class:"setting-item"},_hoisted_101={class:"setting-item"},_hoisted_102={class:"setting-item"},_hoisted_103={class:"setting-item"},_hoisted_104={class:"setting-item",style:{"flex-direction":"row","justify-content":"space-between","align-items":"center"}},_hoisted_105={class:"setting-item",style:{"flex-direction":"row","justify-content":"space-between","align-items":"center"}},_hoisted_106={class:"setting-item",style:{"flex-direction":"row","justify-content":"space-between","align-items":"center"}},_hoisted_107={class:"setting-item",style:{"flex-direction":"row","justify-content":"space-between","align-items":"center"}},_hoisted_108={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},FISH_TARGET=320,ARENA_TARGET=240,FOUR_HOURS_MS=4*60*60*1e3,_sfc_main={__name:"BatchDailyTasks",setup(__props){const tokenStore=useTokenStore(),message=useMessage(),tokens=computed(()=>tokenStore.gameTokens),isCarActivityOpen=computed(()=>{const t=new Date().getDay();return t>=1&&t<=3}),ismengjingActivityOpen=computed(()=>{const t=new Date().getDay();return t===0||t===1||t===3||t===4}),isbaokuActivityOpen=computed(()=>{const t=new Date().getDay();return t!=1&&t!=2}),isarenaActivityOpen=computed(()=>{const t=new Date().getHours();return t>=6&&t<22}),getCurrentActivityWeek=computed(()=>{const t=new Date,e=new Date("2025-12-12T12:00:00"),a=7*24*60*60*1e3,o=3*a,n=t-e;if(n<0)return null;const i=n%o;return i<a?"黑市周":i<2*a?"招募周":"宝箱周"}),isWeirdTowerActivityOpen=computed(()=>getCurrentActivityWeek.value==="黑市周"),selectedTokens=ref([]),tokenStatus=ref({}),isRunning=ref(!1),shouldStop=ref(!1),showSettingsModal=ref(!1),currentSettingsTokenId=ref(null),currentSettingsTokenName=ref(""),currentSettings=reactive({arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),showHelperModal=ref(!1),helperType=ref("box"),helperSettings=reactive({boxType:2001,fishType:1,count:100}),helperModalTitle=computed(()=>({box:"批量开宝箱",fish:"批量钓鱼",recruit:"批量招募"})[helperType.value]||"批量助手"),showBatchSettingsModal=ref(!1),batchSettings=reactive({boxCount:100,fishCount:100,recruitCount:100,defaultBoxType:2001,defaultFishType:1,receiverId:"",password:"",hideScheduledTasksModule:!1,tokenListColumns:2,commandDelay:500,taskDelay:500}),loadBatchSettings=()=>{try{const t=localStorage.getItem("batchSettings");if(t){const e=JSON.parse(t);Object.assign(batchSettings,e)}}catch(t){console.error("Failed to load batch settings:",t)}},saveBatchSettings=()=>{try{localStorage.setItem("batchSettings",JSON.stringify(batchSettings)),message.success("定时批量任务设置已保存"),showBatchSettingsModal.value=!1}catch(t){console.error("Failed to save batch settings:",t),message.error("保存设置失败")}},openBatchSettings=()=>{loadBatchSettings(),showBatchSettingsModal.value=!0};loadBatchSettings();const showLegacyGiftModal=ref(!1),recipientIdInput=ref(""),recipientIdError=ref(""),recipientInfo=ref(null),isQueryingRecipient=ref(!1),giftQuantity=ref(10),securityPassword=ref(""),isAvatarLoading=ref(!1),avatarLoadError=ref(!1),scheduledTasks=ref([]),showTaskModal=ref(!1),showTasksModal=ref(!1),editingTask=ref(null),taskForm=reactive({name:"",runType:"daily",runTime:null,cronExpression:"",selectedTokens:[],selectedTasks:[],enabled:!0}),cronValidation=ref({valid:!0,message:""}),cronNextRuns=ref([]),availableTasks=[{label:"日常任务",value:"startBatch"},{label:"领取挂机",value:"claimHangUpRewards"},{label:"一键加钟",value:"batchAddHangUpTime"},{label:"重置罐子",value:"resetBottles"},{label:"一键领取罐子",value:"batchlingguanzi"},{label:"一键爬塔",value:"climbTower"},{label:"一键答题",value:"batchStudy"},{label:"智能发车",value:"batchSmartSendCar"},{label:"一键收车",value:"batchClaimCars"},{label:"批量开箱",value:"batchOpenBox"},{label:"领取宝箱积分",value:"batchClaimBoxPointReward"},{label:"批量钓鱼",value:"batchFish"},{label:"批量招募",value:"batchRecruit"},{label:"一键宝库前3层",value:"batchbaoku13"},{label:"一键宝库4,5层",value:"batchbaoku45"},{label:"一键梦境",value:"batchmengjing"},{label:"一键俱乐部签到",value:"batchclubsign"},{label:"一键竞技场战斗3次",value:"batcharenafight"},{label:"一键钓鱼补齐",value:"batchTopUpFish"},{label:"一键竞技场补齐",value:"batchTopUpArena"},{label:"一键领取怪异塔免费道具",value:"batchClaimFreeEnergy"},{label:"一键购买四圣碎片",value:"legion_storebuygoods"},{label:"一键黑市采购",value:"store_purchase"},{label:"免费领取珍宝阁",value:"collection_claimfreereward"},{label:"批量领取功法残卷",value:"batchLegacyClaim"},{label:"批量赠送功法残卷",value:"batchLegacyGiftSendEnhanced"}],CarresearchItem=[20,21,22,23,24,26,28,30,32,34,36,38,40,42,44,47,50,53,56,59,62,65,68,71,74,78,82,86,90,94,99,104,109,114,119,126,133,140,147,154,163,172,181,190,199,210,221,232,243,369,393,422,457,498,548,607,678,763,865,1011],loadScheduledTasks=()=>{try{const t=localStorage.getItem("scheduledTasks");if(t){const e=JSON.parse(t);scheduledTasks.value=Array.isArray(e)?e:[]}else scheduledTasks.value=[]}catch(t){console.error("Failed to load scheduled tasks:",t),scheduledTasks.value=[]}},saveScheduledTasks=()=>{try{const t=JSON.stringify(scheduledTasks.value);localStorage.setItem("scheduledTasks",t);const e=localStorage.getItem("scheduledTasks")}catch(t){console.error("Failed to save scheduled tasks:",t)}},openTaskModal=()=>{editingTask.value=null,Object.assign(taskForm,{name:"",runType:"daily",runTime:void 0,cronExpression:"",selectedTokens:[],selectedTasks:[],enabled:!0}),showTaskModal.value=!0},editTask=t=>{editingTask.value=t;const e={...t};if(t.runType==="daily"&&t.runTime&&typeof t.runTime=="string"){const[a,o]=t.runTime.split(":").map(Number),n=new Date;e.runTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),a,o)}Object.assign(taskForm,e),showTaskModal.value=!0},validateCronExpression=t=>{if(!t)return{valid:!1,message:"Cron表达式不能为空"};const e=t.split(" ").filter(Boolean);if(e.length!==5)return{valid:!1,message:"Cron表达式必须包含5个字段：分 时 日 月 周"};const[a,o,n,i,l]=e,d=(v,k,p,m)=>{if(v==="*")return{valid:!0};if(v.includes("/")){const y=v.split("/");if(y.length!==2)return{valid:!1,message:`${m}字段步长格式错误`};const[b,T]=y,s=parseInt(T);if(isNaN(s)||s<=0)return{valid:!1,message:`${m}字段步长必须是正整数`};if(b!=="*")if(b.includes(",")){const w=b.split(",");for(const L of w)if(L.includes("-")){const S=L.split("-");if(S.length!==2)return{valid:!1,message:`${m}字段范围格式错误`};const[N,$]=S.map(Number);if(isNaN(N)||isNaN($)||N<k||$>p||N>$)return{valid:!1,message:`${m}字段范围必须在${k}-${p}之间，且开始值小于等于结束值`}}else{const S=parseInt(L);if(isNaN(S)||S<k||S>p)return{valid:!1,message:`${m}字段必须在${k}-${p}之间`}}}else if(b.includes("-")){const w=b.split("-");if(w.length!==2)return{valid:!1,message:`${m}字段范围格式错误`};const[L,S]=w.map(Number);if(isNaN(L)||isNaN(S)||L<k||S>p||L>S)return{valid:!1,message:`${m}字段范围必须在${k}-${p}之间，且开始值小于等于结束值`}}else{const w=parseInt(b);if(isNaN(w)||w<k||w>p)return{valid:!1,message:`${m}字段必须在${k}-${p}之间`}}return{valid:!0}}if(v.includes(",")){const y=v.split(",");for(const b of y){const T=b.trim();if(T.includes("-")){const s=T.split("-");if(s.length!==2)return{valid:!1,message:`${m}字段范围格式错误`};const[w,L]=s.map(Number);if(isNaN(w)||isNaN(L)||w<k||L>p||w>L)return{valid:!1,message:`${m}字段范围必须在${k}-${p}之间，且开始值小于等于结束值`}}else{const s=parseInt(T);if(isNaN(s)||s<k||s>p)return{valid:!1,message:`${m}字段必须在${k}-${p}之间`}}}return{valid:!0}}if(v.includes("-")){const y=v.split("-");if(y.length!==2)return{valid:!1,message:`${m}字段范围格式错误`};const[b,T]=y.map(Number);return isNaN(b)||isNaN(T)||b<k||T>p||b>T?{valid:!1,message:`${m}字段范围必须在${k}-${p}之间，且开始值小于等于结束值`}:{valid:!0}}const h=parseInt(v);return isNaN(h)||h<k||h>p?{valid:!1,message:`${m}字段必须在${k}-${p}之间`}:{valid:!0}},r=d(a,0,59,"分钟");if(!r.valid)return r;const c=d(o,0,23,"小时");if(!c.valid)return c;const f=d(n,1,31,"日期");if(!f.valid)return f;const u=d(i,1,12,"月份");if(!u.valid)return u;const g=d(l,0,7,"星期");return g.valid?{valid:!0,message:"Cron表达式格式正确"}:g},parseCronExpression=t=>{const e=validateCronExpression(t);if(cronValidation.value=e,!e.valid){cronNextRuns.value=[];return}const a=t.split(" ").filter(Boolean),[o,n,i,l,d]=a,r=calculateNextRuns(o,n,i,l,d,5);cronNextRuns.value=r},calculateNextRuns=(t,e,a,o,n,i=5)=>{const l=new Date,d=[];let r=new Date(l);r.setMilliseconds(0),r.setSeconds(0),r.setMinutes(r.getMinutes()+1);const c=new Date(l);for(c.setFullYear(c.getFullYear()+1);d.length<i&&r<=c;){const f=parseCronField(t,0,59),u=parseCronField(e,0,23),g=parseCronField(a,1,31),v=parseCronField(o,1,12),k=parseCronField(n,0,7),p=f.includes(r.getMinutes()),m=u.includes(r.getHours()),h=g.includes(r.getDate()),y=v.includes(r.getMonth()+1),b=k.includes(r.getDay()),T=n!=="*",s=a!=="*";let w;if(T&&s?w=h||b:w=h&&b,p&&m&&w&&y){const L=r.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});d.push(L),r.setMinutes(r.getMinutes()+1)}else r.setMinutes(r.getMinutes()+1)}return d},saveTask=()=>{var o;if(!taskForm.name){message.warning("请输入任务名称");return}if(taskForm.runType==="daily"&&!taskForm.runTime){message.warning("请选择运行时间");return}if(taskForm.runType==="cron"){if(!taskForm.cronExpression){message.warning("请输入Cron表达式");return}const n=validateCronExpression(taskForm.cronExpression);if(!n.valid){message.warning(n.message);return}}if(taskForm.selectedTokens.length===0){message.warning("请选择至少一个账号");return}if(taskForm.selectedTasks.length===0){message.warning("请选择至少一个任务");return}let t=null;taskForm.runType==="daily"&&taskForm.runTime&&(t=new Date(taskForm.runTime).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}));const e={id:((o=editingTask.value)==null?void 0:o.id)||"task_"+Date.now(),name:taskForm.name,runType:taskForm.runType,runTime:t,cronExpression:taskForm.runType==="cron"?taskForm.cronExpression:"",selectedTokens:[...taskForm.selectedTokens],selectedTasks:[...taskForm.selectedTasks],enabled:taskForm.enabled};let a=!editingTask.value;if(editingTask.value){const n=scheduledTasks.value.findIndex(i=>i.id===editingTask.value.id);n!==-1&&(scheduledTasks.value[n]=e)}else scheduledTasks.value.push(e);saveScheduledTasks(),addTaskSaveLog(e,a),showTaskModal.value=!1,message.success("定时任务已保存")},deleteTask=t=>{const e=scheduledTasks.value.find(a=>a.id===t);e&&(scheduledTasks.value=scheduledTasks.value.filter(a=>a.id!==t),saveScheduledTasks(),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${e.name} 已删除 ===`,type:"info"}),message.success("定时任务已删除"))},toggleTaskEnabled=(t,e)=>{const a=scheduledTasks.value.find(o=>o.id===t);a&&(a.enabled=e,saveScheduledTasks(),message.success(`定时任务已${e?"启用":"禁用"}`),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${a.name} 已${e?"启用":"禁用"} ===`,type:"info"}))},addTaskSaveLog=(t,e)=>{addLog({time:new Date().toLocaleTimeString(),message:`=== ${e?"新增":"修改"}定时任务: ${t.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`运行类型: ${t.runType==="daily"?"每天固定时间":"Cron表达式"}`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`运行时间: ${t.runType==="daily"?t.runTime:t.cronExpression}`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`选中账号: ${t.selectedTokens.length} 个`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`选中任务: ${t.selectedTasks.length} 个`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`状态: ${t.enabled?"启用":"禁用"}`,type:"info"})},resetRunType=()=>{taskForm.runType==="daily"?taskForm.cronExpression="":taskForm.runTime=void 0},selectAllTokens=()=>{taskForm.selectedTokens=tokens.value.map(t=>t.id)},deselectAllTokens=()=>{taskForm.selectedTokens=[]},selectAllTasks=()=>{taskForm.selectedTasks=availableTasks.map(t=>t.value)},deselectAllTasks=()=>{taskForm.selectedTasks=[]},legion_storebuygoods=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始购买四圣碎片: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"发送购买请求...",type:"info"});const a=await tokenStore.sendMessageWithPromise(t,"legion_storebuygoods",{id:6},5e3);await new Promise(o=>setTimeout(o,500)),a.error?a.error.includes("俱乐部商品购买数量超出上限")?addLog({time:new Date().toLocaleTimeString(),message:"本周已购买过四圣碎片，跳过",type:"info"}):a.error.includes("物品不存在")?(addLog({time:new Date().toLocaleTimeString(),message:"盐锭不足或未加入军团，购买失败",type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:`购买失败: ${a.error}`,type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:"购买成功，获得四圣碎片",type:"success"}),tokenStatus.value[t]="completed"),currentProgress.value=100}catch(a){addLog({time:new Date().toLocaleTimeString(),message:`购买过程出错: ${a.message}`,type:"error"}),tokenStatus.value[t]="failed"}finally{await new Promise(a=>setTimeout(a,1e3))}}currentRunningTokenId.value=null,isRunning.value=!1,shouldStop.value=!1}},legionStoreBuySkinCoins=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始购买俱乐部5皮肤币: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"发送购买请求...",type:"info"});for(let a=0;a<5;a++){const o=await tokenStore.sendMessageWithPromise(t,"legion_storebuygoods",{id:1},5e3);await new Promise(n=>setTimeout(n,500))}result.error?result.error.includes("俱乐部商品购买数量超出上限")?addLog({time:new Date().toLocaleTimeString(),message:"本周已购买过皮肤币，跳过",type:"info"}):result.error.includes("物品不存在")?(addLog({time:new Date().toLocaleTimeString(),message:"盐锭不足或未加入军团，购买失败",type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:`购买失败: ${result.error}`,type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:"购买成功，获得皮肤币",type:"success"}),tokenStatus.value[t]="completed"),currentProgress.value=100}catch(a){addLog({time:new Date().toLocaleTimeString(),message:`购买过程出错: ${a.message}`,type:"error"}),tokenStatus.value[t]="failed"}finally{await new Promise(a=>setTimeout(a,1e3))}}currentRunningTokenId.value=null,isRunning.value=!1,shouldStop.value=!1}},collection_claimfreereward=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始免费领取珍宝阁: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"发送珍宝阁免费领取请求...",type:"info"});const a=await tokenStore.sendMessageWithPromise(t,"collection_claimfreereward",{},5e3);await new Promise(o=>setTimeout(o,500)),a.error?(addLog({time:new Date().toLocaleTimeString(),message:`珍宝阁领取失败: ${a.error}`,type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:"珍宝阁领取成功",type:"success"}),tokenStatus.value[t]="completed"),currentProgress.value=100}catch(a){addLog({time:new Date().toLocaleTimeString(),message:`珍宝阁领取过程出错: ${a.message}`,type:"error"}),tokenStatus.value[t]="failed"}finally{await new Promise(a=>setTimeout(a,1e3))}}currentRunningTokenId.value=null,isRunning.value=!1,shouldStop.value=!1}},store_purchase=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始黑市一键采购: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"发送黑市采购请求...",type:"info"});const a=await tokenStore.sendMessageWithPromise(t,"store_purchase",{},5e3);await new Promise(o=>setTimeout(o,500)),a.error?(addLog({time:new Date().toLocaleTimeString(),message:`黑市采购失败: ${a.error}`,type:"error"}),tokenStatus.value[t]="failed"):(addLog({time:new Date().toLocaleTimeString(),message:"黑市采购成功",type:"success"}),tokenStatus.value[t]="completed"),currentProgress.value=100}catch(a){addLog({time:new Date().toLocaleTimeString(),message:`黑市采购过程出错: ${a.message}`,type:"error"}),tokenStatus.value[t]="failed"}finally{await new Promise(a=>setTimeout(a,1e3))}}currentRunningTokenId.value=null,isRunning.value=!1,shouldStop.value=!1}},parseCronField=(t,e,a)=>{const o=new Set;if(t.includes(",")){const i=t.split(",");for(const l of i)parseCronField(l.trim(),e,a).forEach(r=>o.add(r));return Array.from(o)}if(t==="*"){for(let i=e;i<=a;i++)o.add(i);return Array.from(o)}if(t.includes("/")){const[i,l]=t.split("/"),d=parseInt(l);let r=e,c=a;if(i!=="*")if(i.includes("-")){const[f,u]=i.split("-").map(Number);r=f,c=u}else r=parseInt(i),c=a;for(let f=r;f<=c;f+=d)o.add(f);return Array.from(o)}if(t.includes("-")){const[i,l]=t.split("-").map(Number);for(let d=i;d<=l;d++)o.add(d);return Array.from(o)}const n=parseInt(t);return isNaN(n)||o.add(n),Array.from(o)},calculateNextExecutionTime=t=>{const e=new Date;if(t.runType==="daily"){const[a,o]=t.runTime.split(":").map(Number),n=new Date(e);return n.setHours(a,o,0,0),n<=e&&n.setDate(n.getDate()+1),n}else if(t.runType==="cron"){const a=t.cronExpression.split(" ").filter(Boolean);if(a.length<5)return null;const[o,n,i,l,d]=a,r=parseCronField(o,0,59),c=parseCronField(n,0,23),f=parseCronField(i,1,31),u=parseCronField(l,1,12),g=parseCronField(d,0,7);let v=new Date(e);v.setSeconds(0,0),v.setMinutes(v.getMinutes()+1);const k=new Date(e);for(k.setFullYear(k.getFullYear()+1);v<=k;){const p=v.getMinutes(),m=v.getHours(),h=v.getDate(),y=v.getMonth()+1,b=v.getDay(),T=r.includes(p),s=c.includes(m),w=f.includes(h),L=u.includes(y),S=g.includes(b),N=d!=="*",$=i!=="*";let x;if(N&&$?x=w||S:x=w&&S,T&&s&&x&&L)return v;v.setMinutes(v.getMinutes()+1)}return null}return null},formatTimeDifference=t=>{const e=Math.floor(t/1e3),a=Math.floor(e/60),o=Math.floor(a/60),n=Math.floor(o/24),i=o%24,l=a%60,d=e%60;let r="";return n>0&&(r+=`${n}天`),(i>0||n>0)&&(r+=`${i}小时`),(l>0||i>0||n>0)&&(r+=`${l}分`),r+=`${d}秒`,r},taskCountdowns=ref({}),nextExecutionTimes=ref({}),updateCountdowns=()=>{const t=Date.now();scheduledTasks.value.forEach(e=>{if((!nextExecutionTimes.value[e.id]||nextExecutionTimes.value[e.id]<=t)&&(nextExecutionTimes.value[e.id]=calculateNextExecutionTime(e)),nextExecutionTimes.value[e.id]){const a=nextExecutionTimes.value[e.id]-t;taskCountdowns.value[e.id]={remainingTime:Math.max(0,a),formatted:formatTimeDifference(Math.max(0,a)),isNearExecution:a<5*60*1e3}}})},shortestCountdownTask=computed(()=>{if(scheduledTasks.value.length===0)return null;let t=null,e=1/0;return scheduledTasks.value.forEach(a=>{const o=taskCountdowns.value[a.id];o&&o.remainingTime<e&&(e=o.remainingTime,t={task:a,countdown:o})}),t});let countdownInterval=null;const startCountdown=()=>{countdownInterval&&clearInterval(countdownInterval),updateCountdowns(),countdownInterval=setInterval(updateCountdowns,1e3)};loadScheduledTasks(),watch(scheduledTasks,t=>{nextExecutionTimes.value={},taskCountdowns.value={},updateCountdowns()},{deep:!0}),watch(()=>showTaskModal.value,t=>{t&&!taskForm.runTime&&(taskForm.runTime=void 0)}),onMounted(()=>{scheduleTaskExecution(),startCountdown()}),onBeforeUnmount(()=>{countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null)});const scheduleTaskExecution=()=>{addLog({time:new Date().toLocaleTimeString(),message:"=== 定时任务调度服务已启动 ===",type:"info"});const t=ref(null);let e=null;const a=()=>{if(t.value||(console.error(`[${new Date().toISOString()}] Task scheduler interval is not running, restarting...`),o()),isRunning.value){const i=Date.now()-10*60*1e3;e&&e<i&&(console.error(`[${new Date().toISOString()}] isRunning has been true for more than 10 minutes, resetting to false`),isRunning.value=!1,addLog({time:new Date().toLocaleTimeString(),message:"=== 检测到任务执行超时，已重置isRunning状态 ===",type:"warning"}))}},o=()=>{t.value&&clearInterval(t.value),t.value=setInterval(()=>{try{const n=new Date,i=n.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),l=scheduledTasks.value.filter(d=>d.enabled);if(l.length===0)return;l.forEach(d=>{let r=!1,c="";if(d.runType==="daily"){const f=d.runTime,u=n.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"});r=u===f,c=`currentTime=${u}, taskTime=${f}, match=${r}`}else if(d.runType==="cron")try{const f=d.cronExpression.split(" ").filter(Boolean);if(f.length<5){console.error(`[${new Date().toISOString()}] Invalid cron expression: ${d.cronExpression}, must have at least 5 parts`),addLog({time:i,message:`=== 定时任务 ${d.name} 的Cron表达式无效: ${d.cronExpression}，必须包含至少5个字段 ===`,type:"error"});return}const[u,g,v,k,p]=f,m=parseCronField(u,0,59),h=parseCronField(g,0,23),y=parseCronField(v,1,31),b=parseCronField(k,1,12),T=parseCronField(p,0,7),s=m.includes(n.getMinutes()),w=h.includes(n.getHours()),L=y.includes(n.getDate()),S=b.includes(n.getMonth()+1),N=T.includes(n.getDay());r=s&&w&&L&&S&&N,c=`minute=${s}, hour=${w}, dayOfMonth=${L}, month=${S}, dayOfWeek=${N}`}catch(f){console.error(`[${new Date().toISOString()}] Error parsing cron expression ${d.cronExpression}:`,f),addLog({time:i,message:`=== 解析定时任务 ${d.name} 的Cron表达式失败: ${f.message} ===`,type:"error"});return}if(r){const f=`${d.id}_${n.getDate()}_${n.getHours()}_${n.getMinutes()}`;localStorage.getItem(`lastTaskExecution_${d.id}`)!==f?(localStorage.setItem(`lastTaskExecution_${d.id}`,f),e=Date.now(),executeScheduledTask(d)):addLog({time:i,message:`=== 任务 ${d.name} 本分钟内已执行，跳过 ===`,type:"info"})}})}catch(n){console.error(`[${new Date().toISOString()}] Error in task scheduler:`,n),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务调度服务发生错误: ${n.message} ===`,type:"error"})}},1e4)};o(),setInterval(a,5*60*1e3),a(),onBeforeUnmount(()=>{t.value&&(clearInterval(t.value),t.value=null),addLog({time:new Date().toLocaleTimeString(),message:"=== 定时任务调度服务已停止 ===",type:"info"})})},verifyTaskDependencies=async task=>{var t;addLog({time:new Date().toLocaleTimeString(),message:`=== 开始验证定时任务 ${task.name} 的依赖 ===`,type:"info"});try{localStorage.setItem("test","test"),localStorage.removeItem("test"),addLog({time:new Date().toLocaleTimeString(),message:"✅ localStorage可用",type:"info"})}catch(e){return addLog({time:new Date().toLocaleTimeString(),message:`❌ localStorage不可用: ${e.message}`,type:"error"}),!1}if(!tokenStore||!tokenStore.gameTokens)return addLog({time:new Date().toLocaleTimeString(),message:"❌ Token存储不可用",type:"error"}),!1;for(const taskName of task.selectedTasks){const taskFunction=eval(taskName);if(typeof taskFunction!="function")return addLog({time:new Date().toLocaleTimeString(),message:`❌ 任务函数不存在: ${taskName}`,type:"error"}),!1}const checkWebSocketWithRetry=async(e,a=3,o=1e3)=>{var n;for(let i=0;i<a;i++){if(tokenStore.getWebSocketStatus(e)==="connected")return!0;if(i<a){const d=((n=tokenStore.gameTokens.find(r=>r.id===e))==null?void 0:n.name)||e;try{addLog({time:new Date().toLocaleTimeString(),message:`⏳ 账号 ${d} WebSocket未连接，尝试手动连接... (${i+1}/${a})`,type:"warning"});const r=tokenStore.gameTokens.find(c=>c.id===e);if(r&&r.token)typeof tokenStore.createWebSocketConnection=="function"?tokenStore.createWebSocketConnection(e,r.token):typeof tokenStore.selectToken=="function"&&tokenStore.selectToken(e,!0),await new Promise(c=>setTimeout(c,o));else{addLog({time:new Date().toLocaleTimeString(),message:`⚠️  账号 ${d} 缺少token信息，无法尝试手动连接`,type:"warning"});break}}catch(r){addLog({time:new Date().toLocaleTimeString(),message:`❌ 账号 ${d} 尝试手动连接失败: ${r.message}`,type:"error"}),await new Promise(c=>setTimeout(c,o))}}}return tokenStore.getWebSocketStatus(e)==="connected"},connectedTokens=[],disconnectedTokens=[];for(const e of task.selectedTokens){const a=((t=tokenStore.gameTokens.find(n=>n.id===e))==null?void 0:t.name)||e;await checkWebSocketWithRetry(e)?connectedTokens.push({id:e,name:a}):disconnectedTokens.push({id:e,name:a})}return connectedTokens.length>0&&addLog({time:new Date().toLocaleTimeString(),message:`✅ 已连接账号: ${connectedTokens.map(e=>e.name).join(", ")}`,type:"info"}),disconnectedTokens.length>0&&addLog({time:new Date().toLocaleTimeString(),message:`⚠️  未连接账号: ${disconnectedTokens.map(e=>e.name).join(", ")}`,type:"warning"}),connectedTokens.length===0?(addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 没有可用的连接账号，取消执行 ===`,type:"error"}),!1):(task.connectedTokens=connectedTokens.map(e=>e.id),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 的依赖验证通过，将执行 ${connectedTokens.length} 个账号 ===`,type:"success"}),!0)},executeScheduledTask=async task=>{var t;addLog({time:new Date().toLocaleTimeString(),message:`=== 开始执行定时任务: ${task.name} ===`,type:"info"});try{const dependenciesValid=await verifyTaskDependencies(task);if(!dependenciesValid){addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 依赖验证失败，取消执行 ===`,type:"error"});return}selectedTokens.value=[...task.connectedTokens||task.selectedTokens];for(const taskName of task.selectedTasks){if(shouldStop.value)break;addLog({time:new Date().toLocaleTimeString(),message:`执行任务: ${((t=availableTasks.find(e=>e.value===taskName))==null?void 0:t.label)||taskName}`,type:"info"});const taskFunction=eval(taskName);typeof taskFunction=="function"?["batchOpenBox","batchFish","batchRecruit","batchLegacyGiftSendEnhanced"].includes(taskName)?await taskFunction(!0):await taskFunction():addLog({time:new Date().toLocaleTimeString(),message:`任务函数不存在: ${taskName}`,type:"error"})}addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务执行完成: ${task.name} ===`,type:"success"})}catch(e){addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务执行失败: ${e.message} ===`,type:"error"}),console.error(`[${new Date().toISOString()}] Error executing scheduled task ${task.name}:`,e)}},boxTypeOptions=[{label:"木质宝箱",value:2001},{label:"青铜宝箱",value:2002},{label:"黄金宝箱",value:2003},{label:"铂金宝箱",value:2004}],fishTypeOptions=[{label:"普通鱼竿",value:1},{label:"黄金鱼竿",value:2}],openHelperModal=t=>{helperType.value=t,showHelperModal.value=!0},clearRecipientError=()=>{recipientIdError.value=""},handleAvatarLoad=()=>{isAvatarLoading.value=!1,avatarLoadError.value=!1},handleAvatarError=()=>{isAvatarLoading.value=!1,avatarLoadError.value=!0},resetAvatarState=()=>{isAvatarLoading.value=!0,avatarLoadError.value=!1},queryRecipientInfo=async()=>{var o,n,i,l,d,r,c,f;if(!recipientIdInput.value||recipientIdInput.value===""){recipientIdError.value="请输入接收者ID";return}const t=Number(recipientIdInput.value);if(!Number.isInteger(t)||t<=0){recipientIdError.value="请输入有效的数字ID";return}if(selectedTokens.value.length===0){recipientIdError.value="请先选择要操作的角色";return}isQueryingRecipient.value=!0,recipientIdError.value="",recipientInfo.value=null,resetAvatarState();const e=selectedTokens.value[0],a=tokens.value.find(u=>u.id===e);addLog({time:new Date().toLocaleTimeString(),message:`=== 开始查询接收者信息: 使用账号 ${a.name} (ID: ${e}) ===`,type:"info"});try{addLog({time:new Date().toLocaleTimeString(),message:"正在建立WebSocket连接...",type:"info"}),await ensureConnection(e),addLog({time:new Date().toLocaleTimeString(),message:"WebSocket连接成功",type:"success"}),addLog({time:new Date().toLocaleTimeString(),message:`正在发送查询命令，接收者ID: ${t}`,type:"info"});const u=await tokenStore.sendMessageWithPromise(e,"rank_getroleinfo",{bottleType:0,includeBottleTeam:!1,isSearch:!1,roleId:t},1e4);addLog({time:new Date().toLocaleTimeString(),message:"查询命令发送成功，正在处理响应...",type:"info"}),console.log("rank_getroleinfo 响应结果:",u);const g=(u==null?void 0:u.role)||(u==null?void 0:u.roleInfo);if(g){recipientInfo.value={roleId:g.roleId||((o=g.role)==null?void 0:o.roleId),name:g.name||((n=g.role)==null?void 0:n.name),avatarUrl:((i=u==null?void 0:u.roleInfo)==null?void 0:i.headImg)||(g==null?void 0:g.headImg)||((l=g==null?void 0:g.role)==null?void 0:l.headImg)||"",power:function(k){return(k/1e8).toFixed(2)}(g.power||((d=g.role)==null?void 0:d.power)||0),powerUnit:"亿",serverName:g.serverName||((r=g.role)==null?void 0:r.serverName)||"",legionName:((c=u==null?void 0:u.legionInfo)==null?void 0:c.name)||"",legionId:((f=u==null?void 0:u.legionInfo)==null?void 0:f.id)||0};const v=recipientInfo.value.name||"未知角色";addLog({time:new Date().toLocaleTimeString(),message:`=== 查询成功: 找到角色 ${v} (ID: ${recipientInfo.value.roleId})，战力: ${recipientInfo.value.power}${recipientInfo.value.powerUnit} ===`,type:"success"}),message.success("查询成功")}else{const v="未找到该角色信息";recipientIdError.value=v,addLog({time:new Date().toLocaleTimeString(),message:`=== 查询失败: ${v} ===`,type:"error"}),message.error(v)}}catch(u){console.error("查询接收者信息失败:",u);let g="查询失败",v="error";u.message.includes("连接失败")?g="WebSocket连接失败，请检查网络或账号状态":u.message.includes("timeout")||u.message.includes("超时")?(g="查询超时，请稍后重试",v="warning"):u.message.includes("200160")?g="功法系统未开启":g=`查询失败: ${u.message}`,recipientIdError.value=g,addLog({time:new Date().toLocaleTimeString(),message:`=== ${g} ===`,type:v}),message.error(g)}finally{isQueryingRecipient.value=!1,addLog({time:new Date().toLocaleTimeString(),message:"=== 查询操作完成 ===",type:"info"})}},confirmLegacyGift=async()=>{if(!recipientIdInput.value||!recipientInfo.value){message.error("请先查询并确认接收者信息");return}if(!securityPassword.value){message.error("请输入安全密码");return}await batchLegacyGiftSendEnhanced(),showLegacyGiftModal.value=!1,securityPassword.value=""},executeHelper=()=>{if(helperSettings.count%10!==0||helperSettings.count<10){message.warning("消耗数量必须是10的整数倍，最小为10");return}showHelperModal.value=!1,helperType.value==="box"?batchOpenBox():helperType.value==="fish"?batchFish():helperType.value==="recruit"&&batchRecruit()},formationOptions=[1,2,3,4,5,6].map(t=>({label:`阵容${t}`,value:t})),bossTimesOptions=[0,1,2,3,4].map(t=>({label:`${t}次`,value:t})),loadSettings=t=>{try{const e=localStorage.getItem(`daily-settings:${t}`),a={arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0};return e?{...a,...JSON.parse(e)}:a}catch(e){return console.error("Failed to load settings:",e),null}},openSettings=t=>{currentSettingsTokenId.value=t.id,currentSettingsTokenName.value=t.name;const e=loadSettings(t.id);Object.assign(currentSettings,e),showSettingsModal.value=!0},saveSettings=()=>{currentSettingsTokenId.value&&(localStorage.setItem(`daily-settings:${currentSettingsTokenId.value}`,JSON.stringify(currentSettings)),message.success(`已保存 ${currentSettingsTokenName.value} 的设置`),showSettingsModal.value=!1)},currentRunningTokenId=ref(null),currentProgress=ref(0),logs=ref([]),logContainer=ref(null),autoScrollLog=ref(!0),filterErrorsOnly=ref(!1),errorCount=computed(()=>logs.value.filter(t=>t.type==="error").length),filteredLogs=computed(()=>filterErrorsOnly.value?logs.value.filter(t=>t.type==="error"):logs.value),currentRunningTokenName=computed(()=>{const t=tokens.value.find(e=>e.id===currentRunningTokenId.value);return t?t.name:""}),isAllSelected=computed(()=>selectedTokens.value.length===tokens.value.length&&tokens.value.length>0),isIndeterminate=computed(()=>selectedTokens.value.length>0&&selectedTokens.value.length<tokens.value.length),handleSelectAll=t=>{t?selectedTokens.value=tokens.value.map(e=>e.id):selectedTokens.value=[]},getStatusType=t=>{const e=tokenStatus.value[t];return e==="completed"?"success":e==="failed"?"error":e==="running"?"info":"default"},getStatusText=t=>{const e=tokenStatus.value[t];return e==="completed"?"已完成":e==="failed"?"失败":e==="running"?"执行中":"等待中"},pickArenaTargetId=t=>{var a,o,n,i,l;const e=((a=t==null?void 0:t.rankList)==null?void 0:a[0])||((o=t==null?void 0:t.roleList)==null?void 0:o[0])||((n=t==null?void 0:t.targets)==null?void 0:n[0])||((i=t==null?void 0:t.targetList)==null?void 0:i[0])||((l=t==null?void 0:t.list)==null?void 0:l[0]);return e!=null&&e.roleId?e.roleId:e!=null&&e.id?e.id:(t==null?void 0:t.roleId)||(t==null?void 0:t.id)},getTodayStartSec=()=>{const t=new Date;return t.setHours(0,0,0,0),Math.floor(t.getTime()/1e3)},isTodayAvailable=t=>!t||typeof t!="number"?!0:t<getTodayStartSec(),calculateMonthProgress=()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),a=t.getDate();return Math.min(1,Math.max(0,a/e))},addLog=t=>{logs.value.push(t),nextTick(()=>{logContainer.value&&autoScrollLog.value&&(logContainer.value.scrollTop=logContainer.value.scrollHeight)})};watch(autoScrollLog,t=>{t&&logContainer.value&&nextTick(()=>{logContainer.value.scrollTop=logContainer.value.scrollHeight})});const copyLogs=()=>{if(logs.value.length===0){message.warning("没有可复制的日志");return}const t=logs.value.map(e=>`${e.time} ${e.message}`).join(`
`);navigator.clipboard.writeText(t).then(()=>{message.success("日志已复制到剪贴板")}).catch(e=>{message.error("复制日志失败: "+e.message)})},waitForConnection=async(t,e=2e3)=>{const a=Date.now();for(;Date.now()-a<e;){if(tokenStore.getWebSocketStatus(t)==="connected")return!0;await new Promise(n=>setTimeout(n,500))}return!1},resetBottles=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始重置罐子: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"停止计时...",type:"info"}),await tokenStore.sendMessageWithPromise(t,"bottlehelper_stop",{},5e3),await new Promise(a=>setTimeout(a,500)),addLog({time:new Date().toLocaleTimeString(),message:"开始计时...",type:"info"}),await tokenStore.sendMessageWithPromise(t,"bottlehelper_start",{},5e3),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 重置完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`重置失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量重置罐子结束")}},claimHangUpRewards=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取挂机: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"领取挂机奖励",type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_claimhangupreward",{},5e3),await new Promise(a=>setTimeout(a,500));for(let a=0;a<4;a++)addLog({time:new Date().toLocaleTimeString(),message:`挂机加钟 ${a+1}/4`,type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_mysharecallback",{isSkipShareCard:!0,type:2},5e3),await new Promise(o=>setTimeout(o,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取挂机结束")}},batchbaoku13=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t);const o=(await tokenStore.sendMessageWithPromise(t,"bosstower_getinfo",{})).bossTower.towerId;if(o>=1&&o<=3){for(let n=0;n<2&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startboss",{}),await new Promise(i=>setTimeout(i,500));for(let n=0;n<9&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startbox",{}),await new Promise(i=>setTimeout(i,500))}tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 宝库战斗已完成，请上线手动领取奖励 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`宝库战斗失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量宝库结束")}},batchbaoku45=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t);const o=(await tokenStore.sendMessageWithPromise(t,"bosstower_getinfo",{})).bossTower.towerId;if(o>=4&&o<=5)for(let n=0;n<2&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startboss",{}),await new Promise(i=>setTimeout(i,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 宝库战斗已完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`宝库战斗失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量宝库结束")}},batchmengjing=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;const a={0:107},o=new Date().getDay();if(o===0|o===1|o===3|o===4)await tokenStore.sendMessageWithPromise(t,"dungeon_selecthero",{battleTeam:a},5e3),await new Promise(n=>setTimeout(n,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 咸王梦境已完成 ===`,type:"success"});else{addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 当前未在开放时间 ===`,type:"error"});break}}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`咸王梦境失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量梦境结束")}},batchlingguanzi=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键领取盐罐: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;await tokenStore.sendMessageWithPromise(t,"bottlehelper_claim",{},5e3),await new Promise(a=>setTimeout(a,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取盐罐已完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取盐罐失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取盐罐结束")}},batchclubsign=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键俱乐部签到: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;await tokenStore.sendMessageWithPromise(t,"legion_signin",{},5e3),await new Promise(a=>setTimeout(a,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 俱乐部签到已完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`俱乐部签到失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量俱乐部签到结束")}},batcharenafight=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键竞技场战斗: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;for(let a=0;a<3;a++){await tokenStore.sendMessageWithPromise(t,"arena_startarea",{});let o;try{o=await tokenStore.sendMessageWithPromise(t,"arena_getareatarget",{})}catch(i){message.error(`获取竞技场目标失败：${i.message}`);break}const n=pickArenaTargetId(o);if(!n){addLog({time:new Date().toLocaleTimeString(),message:`未找到可用的竞技场目标: ${error.message||"未知错误"}`,type:"error"});break}try{await tokenStore.sendMessageWithPromise(t,"fight_startareaarena",{targetId:n}),addLog({time:new Date().toLocaleTimeString(),message:`${e.name} 竞技场战斗 ${a+1}/3`,type:"info"}),await new Promise(i=>setTimeout(i,500))}catch{addLog({time:new Date().toLocaleTimeString(),message:`竞技场对决失败: ${error.message||"未知错误"}`,type:"error"})}}await new Promise(a=>setTimeout(a,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 竞技场战斗已完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`竞技场战斗失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量竞技场战斗结束")}},batchAddHangUpTime=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键加钟: ${e.name} ===`,type:"info"}),await ensureConnection(t);for(let a=0;a<4&&!shouldStop.value;a++)addLog({time:new Date().toLocaleTimeString(),message:`执行加钟 ${a+1}/4`,type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_mysharecallback",{isSkipShareCard:!0,type:2},5e3),await new Promise(o=>setTimeout(o,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 加钟完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`加钟失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量加钟结束")}},ensureConnection=async t=>{var n;const e=tokens.value.find(i=>i.id===t);let o=tokenStore.getWebSocketStatus(t)==="connected";if(!o&&(addLog({time:new Date().toLocaleTimeString(),message:"正在连接...",type:"info"}),tokenStore.createWebSocketConnection(t,e.token,e.wsUrl),o=await waitForConnection(t),!o)){addLog({time:new Date().toLocaleTimeString(),message:"连接超时，尝试重连...",type:"warning"}),tokenStore.closeWebSocketConnection(t),await new Promise(l=>setTimeout(l,2e3)),addLog({time:new Date().toLocaleTimeString(),message:"正在重连...",type:"info"});const i=tokens.value.find(l=>l.id===t);tokenStore.createWebSocketConnection(t,i.token,i.wsUrl),o=await waitForConnection(t)}if(!o)throw new Error("连接失败 (重试后仍超时)");try{await tokenStore.sendMessageWithPromise(t,"role_getroleinfo",{},5e3);const i=await tokenStore.sendMessageWithPromise(t,"fight_startlevel",{},5e3);(n=i==null?void 0:i.battleData)!=null&&n.version&&tokenStore.setBattleVersion(i.battleData.version)}catch(i){addLog({time:new Date().toLocaleTimeString(),message:`初始化数据失败: ${i.message}`,type:"warning"})}return!0},climbTower=async()=>{var t,e,a,o,n,i,l,d,r;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(c=>{tokenStatus.value[c]="waiting"});for(const c of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=c,tokenStatus.value[c]="running",currentProgress.value=0;const f=tokens.value.find(u=>u.id===c);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始爬塔: ${f.name} ===`,type:"info"}),await ensureConnection(c),await tokenStore.sendMessageWithPromise(c,"tower_getinfo",{},5e3).catch(()=>{});let u=await tokenStore.sendGetRoleInfo(c),g=((e=(t=u==null?void 0:u.role)==null?void 0:t.tower)==null?void 0:e.energy)||0;addLog({time:new Date().toLocaleTimeString(),message:`初始体力: ${g}`,type:"info"});let v=0;const k=100;let p=0;for(;g>0&&v<k&&!shouldStop.value;)try{await tokenStore.sendMessageWithPromise(c,"fight_starttower",{},5e3),v++,p=0,addLog({time:new Date().toLocaleTimeString(),message:`爬塔第 ${v} 次`,type:"info"}),await new Promise(h=>setTimeout(h,2e3)),tokenStore.sendMessage(c,"tower_getinfo"),u=await tokenStore.sendGetRoleInfo(c);const m=(a=tokenStore.gameData)==null?void 0:a.roleInfo;g=((n=(o=m==null?void 0:m.role)==null?void 0:o.tower)==null?void 0:n.energy)??((l=(i=u==null?void 0:u.role)==null?void 0:i.tower)==null?void 0:l.energy)??0}catch(m){if(m.message&&m.message.includes("200400")){addLog({time:new Date().toLocaleTimeString(),message:"爬塔次数已用完 (200400)",type:"info"});break}if(p++,addLog({time:new Date().toLocaleTimeString(),message:`战斗出错: ${m.message} (重试 ${p}/3)`,type:"warning"}),p>=3){addLog({time:new Date().toLocaleTimeString(),message:"连续失败次数过多，停止爬塔",type:"error"});break}await new Promise(h=>setTimeout(h,2e3));try{u=await tokenStore.sendGetRoleInfo(c),g=((r=(d=u==null?void 0:u.role)==null?void 0:d.tower)==null?void 0:r.energy)||0}catch{}}tokenStatus.value[c]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${f.name} 爬塔结束，共 ${v} 次 ===`,type:"success"})}catch(u){console.error(u),tokenStatus.value[c]="failed",addLog({time:new Date().toLocaleTimeString(),message:`爬塔失败: ${u.message}`,type:"error"})}currentProgress.value=100,await new Promise(u=>setTimeout(u,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量爬塔结束")}},batchStudy=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"}),addLog({time:new Date().toLocaleTimeString(),message:"正在加载题库...",type:"info"}),await preloadQuestions();for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始答题: ${e.name} ===`,type:"info"}),await ensureConnection(t),tokenStore.gameData.studyStatus={isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},await tokenStore.sendMessageWithPromise(t,"study_startgame",{},5e3);let a=90,o=!1,n="";for(;a>0&&!shouldStop.value;){const i=tokenStore.gameData.studyStatus;if(i.status!==n&&(n=i.status,i.status==="answering"?addLog({time:new Date().toLocaleTimeString(),message:"开始答题...",type:"info"}):i.status==="claiming_rewards"&&addLog({time:new Date().toLocaleTimeString(),message:"正在领取奖励...",type:"info"})),i.status==="answering"&&i.questionCount>0,i.status==="completed"){o=!0;break}await new Promise(l=>setTimeout(l,1e3)),a--}o?(tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 答题完成 ===`,type:"success"})):shouldStop.value?addLog({time:new Date().toLocaleTimeString(),message:"已停止",type:"warning"}):(tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:"答题超时或未开始",type:"error"}))}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`答题失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量答题结束")}},batchTopUpFish=async()=>{var t,e,a,o,n,i,l,d,r;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(c=>{tokenStatus.value[c]="waiting"});for(const c of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=c,tokenStatus.value[c]="running",currentProgress.value=0;const f=tokens.value.find(u=>u.id===c);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始钓鱼补齐: ${f.name} ===`,type:"info"}),await ensureConnection(c),addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度...",type:"info"});const u=await tokenStore.sendMessageWithPromise(c,"activity_get",{},1e4),g=(u==null?void 0:u.activity)||((t=u==null?void 0:u.body)==null?void 0:t.activity)||u;if(!g){addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度失败",type:"error"}),tokenStatus.value[c]="failed";continue}const v=g.myMonthInfo||{},k=Number(((e=v==null?void 0:v["2"])==null?void 0:e.num)||0),p=calculateMonthProgress(),m=new Date,h=new Date(m.getFullYear(),m.getMonth()+1,0).getDate(),y=m.getDate(),T=Math.max(0,h-y)===0?FISH_TARGET:Math.min(FISH_TARGET,Math.ceil(p*FISH_TARGET)),s=Math.max(0,T-k);if(addLog({time:new Date().toLocaleTimeString(),message:`当前进度: ${k}/${FISH_TARGET}，需要补齐: ${s}次`,type:"info"}),s<=0){addLog({time:new Date().toLocaleTimeString(),message:"当前进度已达标，无需补齐",type:"success"}),tokenStatus.value[c]="completed";continue}addLog({time:new Date().toLocaleTimeString(),message:"开始执行钓鱼补齐...",type:"info"});let w=(o=(a=tokenStore.gameData)==null?void 0:a.roleInfo)==null?void 0:o.role;if(!w)try{const C=await tokenStore.sendGetRoleInfo(c);w=C==null?void 0:C.role}catch{}let L=0;const S=Number(((n=w==null?void 0:w.statisticsTime)==null?void 0:n["artifact:normal:lottery:time"])||0);if(isTodayAvailable(S)){addLog({time:new Date().toLocaleTimeString(),message:"检测到今日免费钓鱼次数，开始消耗 3 次",type:"info"});for(let C=0;C<3&&s>L&&!shouldStop.value;C++)try{await tokenStore.sendMessageWithPromise(c,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},8e3),L++,await new Promise(B=>setTimeout(B,500))}catch(B){addLog({time:new Date().toLocaleTimeString(),message:`免费钓鱼失败: ${B.message}`,type:"error"});break}}const N=await tokenStore.sendMessageWithPromise(c,"activity_get",{},1e4),x=((N==null?void 0:N.activity)||((i=N==null?void 0:N.body)==null?void 0:i.activity)||N).myMonthInfo||{},I=Number(((l=x==null?void 0:x["2"])==null?void 0:l.num)||0);let _=Math.max(0,T-I);if(addLog({time:new Date().toLocaleTimeString(),message:`免费次数后进度: ${I}/${FISH_TARGET}，还需补齐: ${_}次`,type:"info"}),_<=0){addLog({time:new Date().toLocaleTimeString(),message:"已通过免费次数完成目标",type:"success"}),tokenStatus.value[c]="completed";continue}for(addLog({time:new Date().toLocaleTimeString(),message:`开始付费钓鱼补齐: 共需 ${_} 次（每次最多10）`,type:"info"});_>0&&!shouldStop.value;){const C=Math.min(10,_);try{await tokenStore.sendMessageWithPromise(c,"artifact_lottery",{lotteryNumber:C,newFree:!0,type:1},12e3),addLog({time:new Date().toLocaleTimeString(),message:`完成 ${C} 次付费钓鱼`,type:"info"}),_-=C,await new Promise(B=>setTimeout(B,800))}catch(B){addLog({time:new Date().toLocaleTimeString(),message:`付费钓鱼失败: ${B.message}`,type:"error"});break}}const D=await tokenStore.sendMessageWithPromise(c,"activity_get",{},1e4),V=((D==null?void 0:D.activity)||((d=D==null?void 0:D.body)==null?void 0:d.activity)||D).myMonthInfo||{},M=Number(((r=V==null?void 0:V["2"])==null?void 0:r.num)||0);M>=T||M>=FISH_TARGET?addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐完成，最终进度: ${M}/${FISH_TARGET}`,type:"success"}):addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐已停止，未达到目标，最终进度: ${M}/${FISH_TARGET}`,type:"warning"}),tokenStatus.value[c]="completed"}catch(u){console.error(u),tokenStatus.value[c]="failed",addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐失败: ${u.message}`,type:"error"})}currentProgress.value=100,await new Promise(u=>setTimeout(u,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量钓鱼补齐结束")}},batchTopUpArena=async()=>{var t,e,a;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(o=>{tokenStatus.value[o]="waiting"});for(const o of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=o,tokenStatus.value[o]="running",currentProgress.value=0;const n=tokens.value.find(i=>i.id===o);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始竞技场补齐: ${n.name} ===`,type:"info"}),await ensureConnection(o),addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度...",type:"info"});const i=await tokenStore.sendMessageWithPromise(o,"activity_get",{},1e4),l=(i==null?void 0:i.activity)||((t=i==null?void 0:i.body)==null?void 0:t.activity)||i;if(!l){addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度失败",type:"error"}),tokenStatus.value[o]="failed";continue}const d=l.myArenaInfo||{},r=Number((d==null?void 0:d.num)||0),c=calculateMonthProgress(),f=new Date,u=new Date(f.getFullYear(),f.getMonth()+1,0).getDate(),g=f.getDate(),k=Math.max(0,u-g)===0?ARENA_TARGET:Math.min(ARENA_TARGET,Math.ceil(c*ARENA_TARGET)),p=Math.max(0,k-r);if(addLog({time:new Date().toLocaleTimeString(),message:`当前进度: ${r}/${ARENA_TARGET}，需要补齐: ${p}次`,type:"info"}),p<=0){addLog({time:new Date().toLocaleTimeString(),message:"当前进度已达标，无需补齐",type:"success"}),tokenStatus.value[o]="completed";continue}addLog({time:new Date().toLocaleTimeString(),message:"开始执行竞技场补齐...",type:"info"});try{await tokenStore.sendMessageWithPromise(o,"arena_startarea",{},6e3)}catch(S){addLog({time:new Date().toLocaleTimeString(),message:`开始竞技场失败: ${S.message}`,type:"warning"})}let m=0;const h=100;let y=1,b=p;for(;b>0&&m<h&&!shouldStop.value;){const S=Math.ceil(b/2);addLog({time:new Date().toLocaleTimeString(),message:`第${y}轮：计划战斗 ${S} 场`,type:"info"});for(let _=0;_<S&&m<h&&!shouldStop.value;_++){let D;try{D=await tokenStore.sendMessageWithPromise(o,"arena_getareatarget",{},8e3)}catch(V){addLog({time:new Date().toLocaleTimeString(),message:`获取竞技场目标失败：${V.message}`,type:"error"});break}const P=pickArenaTargetId(D);if(!P){addLog({time:new Date().toLocaleTimeString(),message:"未找到可用的竞技场目标",type:"warning"});break}try{await tokenStore.sendMessageWithPromise(o,"fight_startareaarena",{targetId:P},15e3),addLog({time:new Date().toLocaleTimeString(),message:`竞技场战斗 ${_+1}/${S} 完成`,type:"info"})}catch(V){addLog({time:new Date().toLocaleTimeString(),message:`竞技场对决失败：${V.message}`,type:"error"})}m++,await new Promise(V=>setTimeout(V,1200))}const N=await tokenStore.sendMessageWithPromise(o,"activity_get",{},1e4),x=((N==null?void 0:N.activity)||((e=N==null?void 0:N.body)==null?void 0:e.activity)||N).myArenaInfo||{},I=Number((x==null?void 0:x.num)||0);b=Math.max(0,k-I),addLog({time:new Date().toLocaleTimeString(),message:`第${y}轮后进度: ${I}/${ARENA_TARGET}，还需补齐: ${b}次`,type:"info"}),y++}const T=await tokenStore.sendMessageWithPromise(o,"activity_get",{},1e4),w=((T==null?void 0:T.activity)||((a=T==null?void 0:T.body)==null?void 0:a.activity)||T).myArenaInfo||{},L=Number((w==null?void 0:w.num)||0);L>=k||L>=ARENA_TARGET?addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐完成，最终进度: ${L}/${ARENA_TARGET}`,type:"success"}):m>=h?addLog({time:new Date().toLocaleTimeString(),message:`达到安全上限，竞技场补齐已停止，最终进度: ${L}/${ARENA_TARGET}`,type:"warning"}):addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐已停止，未达到目标，最终进度: ${L}/${ARENA_TARGET}`,type:"warning"}),tokenStatus.value[o]="completed"}catch(i){console.error(i),tokenStatus.value[o]="failed",addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐失败: ${i.message}`,type:"error"})}currentProgress.value=100,await new Promise(i=>setTimeout(i,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量竞技场补齐结束")}},normalizeCars=t=>{const e=t||{},a=e.body||e,o=a.roleCar||a.rolecar||{},n=o.carDataMap||o.cardatamap;if(n&&typeof n=="object")return Object.entries(n).map(([l,d],r)=>({key:r,id:l,...d||{}}));let i=a.cars||a.list||a.data||a.carList||a.vehicles||[];return!Array.isArray(i)&&typeof i=="object"&&i!==null&&(i=Object.values(i)),Array.isArray(a)&&i.length===0&&(i=a),(Array.isArray(i)?i:[]).map((l,d)=>({key:d,...l}))},gradeLabel=t=>({1:"绿·普通",2:"蓝·稀有",3:"紫·史诗",4:"橙·传说",5:"红·神话",6:"金·传奇"})[t]||"未知",isBigPrize=t=>{const e=[{type:3,itemId:3201,value:10},{type:3,itemId:1001,value:10},{type:3,itemId:1022,value:2e3},{type:2,itemId:0,value:2e3},{type:3,itemId:1023,value:5},{type:3,itemId:1022,value:2500},{type:3,itemId:1001,value:12}];return Array.isArray(t)?e.some(a=>t.find(o=>o.type===a.type&&o.itemId===a.itemId&&Number(o.value||0)>=a.value)):!1},countRacingRefreshTickets=t=>Array.isArray(t)?t.reduce((e,a)=>e+(a.type===3&&a.itemId===35002?Number(a.value||0):0),0):0,shouldSendCar=(t,e)=>{const a=Number((t==null?void 0:t.color)||0),o=Array.isArray(t==null?void 0:t.rewards)?t.rewards:[],n=countRacingRefreshTickets(o);return e>=6?a>=5||n>=4||isBigPrize(o):a>=4||n>=2||isBigPrize(o)},canClaim=t=>{const e=Number((t==null?void 0:t.sendAt)||0);if(!e)return!1;const a=e<1e12?e*1e3:e;return Date.now()-a>=FOUR_HOURS_MS},batchSmartSendCar=async()=>{var t,e,a,o,n,i,l;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(d=>{tokenStatus.value[d]="waiting"});for(const d of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=d,tokenStatus.value[d]="running",currentProgress.value=0;const r=tokens.value.find(c=>c.id===d);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始智能发车: ${r.name} ===`,type:"info"}),await ensureConnection(d),addLog({time:new Date().toLocaleTimeString(),message:"获取车辆信息...",type:"info"});const c=await tokenStore.sendMessageWithPromise(d,"car_getrolecar",{},1e4);let f=normalizeCars((c==null?void 0:c.body)??c),u=0;try{const g=await tokenStore.sendMessageWithPromise(d,"role_getroleinfo",{},1e4),v=(a=(e=(t=g==null?void 0:g.role)==null?void 0:t.items)==null?void 0:e[35002])==null?void 0:a.quantity;u=Number(v||0),addLog({time:new Date().toLocaleTimeString(),message:`剩余车票: ${u}`,type:"info"})}catch{}for(const g of f){if(shouldStop.value)break;if(Number(g.sendAt||0)!==0)continue;if(shouldSendCar(g,u)){addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(g.color)}]满足条件，直接发车`,type:"info"}),await tokenStore.sendMessageWithPromise(d,"car_send",{carId:String(g.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(p=>setTimeout(p,500));continue}let v=!1;const k=Number(g.refreshCount??0)===0;if(u>=6)v=!0;else if(k)v=!0;else{addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(g.color)}]不满足条件且无刷新次数，直接发车`,type:"warning"}),await tokenStore.sendMessageWithPromise(d,"car_send",{carId:String(g.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(p=>setTimeout(p,500));continue}for(;v&&!shouldStop.value;){addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(g.color)}]尝试刷新...`,type:"info"});const p=await tokenStore.sendMessageWithPromise(d,"car_refresh",{carId:String(g.id)},1e4),m=(p==null?void 0:p.car)||((o=p==null?void 0:p.body)==null?void 0:o.car)||p;m&&typeof m=="object"&&(m.color!=null&&(g.color=Number(m.color)),m.refreshCount!=null&&(g.refreshCount=Number(m.refreshCount)),m.rewards!=null&&(g.rewards=m.rewards));try{const y=await tokenStore.sendMessageWithPromise(d,"role_getroleinfo",{},5e3);u=Number(((l=(i=(n=y==null?void 0:y.role)==null?void 0:n.items)==null?void 0:i[35002])==null?void 0:l.quantity)||0)}catch{}if(shouldSendCar(g,u)){addLog({time:new Date().toLocaleTimeString(),message:`刷新后车辆[${gradeLabel(g.color)}]满足条件，发车`,type:"success"}),await tokenStore.sendMessageWithPromise(d,"car_send",{carId:String(g.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(y=>setTimeout(y,500));break}const h=Number(g.refreshCount??0)===0;if(u>=6)v=!0;else if(h)v=!0;else{addLog({time:new Date().toLocaleTimeString(),message:`刷新后车辆[${gradeLabel(g.color)}]仍不满足条件且无刷新次数，发车`,type:"warning"}),await tokenStore.sendMessageWithPromise(d,"car_send",{carId:String(g.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(y=>setTimeout(y,500));break}await new Promise(y=>setTimeout(y,1e3))}}tokenStatus.value[d]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${r.name} 智能发车完成 ===`,type:"success"})}catch(c){console.error(c),tokenStatus.value[d]="failed",addLog({time:new Date().toLocaleTimeString(),message:`智能发车失败: ${c.message}`,type:"error"})}currentProgress.value=100,await new Promise(c=>setTimeout(c,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量智能发车结束")}},batchClaimCars=async()=>{var t,e,a,o,n,i,l,d;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(r=>{tokenStatus.value[r]="waiting"});for(const r of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=r,tokenStatus.value[r]="running",currentProgress.value=0;const c=tokens.value.find(f=>f.id===r);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键收车: ${c.name} ===`,type:"info"}),await ensureConnection(r),addLog({time:new Date().toLocaleTimeString(),message:"获取车辆信息...",type:"info"});const f=await tokenStore.sendMessageWithPromise(r,"car_getrolecar",{},1e4);let u=normalizeCars((f==null?void 0:f.body)??f),g=((e=(t=f==null?void 0:f.roleCar)==null?void 0:t.research)==null?void 0:e[1])||0,v=0;for(const k of u)if(canClaim(k)){try{await tokenStore.sendMessageWithPromise(r,"car_claim",{carId:String(k.id)},1e4),v++,addLog({time:new Date().toLocaleTimeString(),message:`收车成功: ${gradeLabel(k.color)}`,type:"success"});const p=await tokenStore.sendMessageWithPromise(r,"role_getroleinfo",{},5e3);let m=Number(((n=(o=(a=p==null?void 0:p.role)==null?void 0:a.items)==null?void 0:o[35009])==null?void 0:n.quantity)||0);for(;g<CarresearchItem.length&&m>=CarresearchItem[g];)try{await tokenStore.sendMessageWithPromise(r,"car_research",{researchId:1},5e3),g++;const h=await tokenStore.sendMessageWithPromise(r,"role_getroleinfo",{},5e3);m=Number(((d=(l=(i=h==null?void 0:h.role)==null?void 0:i.items)==null?void 0:l[35009])==null?void 0:d.quantity)||0),addLog({time:new Date().toLocaleTimeString(),message:`执行车辆改装升级，当前等级: ${g}`,type:"success"}),await new Promise(y=>setTimeout(y,300))}catch(h){addLog({time:new Date().toLocaleTimeString(),message:`车辆改装升级失败: ${h.message}`,type:"error"});break}}catch(p){addLog({time:new Date().toLocaleTimeString(),message:`收车失败: ${p.message}`,type:"warning"})}await new Promise(p=>setTimeout(p,300))}v===0&&addLog({time:new Date().toLocaleTimeString(),message:"没有可收取的车辆",type:"info"}),tokenStatus.value[r]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${c.name} 收车完成，共收取 ${v} 辆 ===`,type:"success"})}catch(f){console.error(f),tokenStatus.value[r]="failed",addLog({time:new Date().toLocaleTimeString(),message:`收车失败: ${f.message}`,type:"error"})}currentProgress.value=100,await new Promise(f=>setTimeout(f,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量一键收车结束")}},startBatch=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;let e=0;const a=1;let o=!1;for(;e<=a&&!o;){const n=tokens.value.find(i=>i.id===t);try{addLog(e===0?{time:new Date().toLocaleTimeString(),message:`=== 开始执行: ${n.name} ===`,type:"info"}:{time:new Date().toLocaleTimeString(),message:`=== 尝试重试: ${n.name} (第${e}次) ===`,type:"info"}),await ensureConnection(t),await new DailyTaskRunner(tokenStore,{commandDelay:batchSettings.commandDelay,taskDelay:batchSettings.taskDelay}).run(t,{onLog:l=>addLog(l),onProgress:l=>{currentProgress.value=l}}),o=!0,tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${n.name} 执行完成 ===`,type:"success"})}catch(i){console.error(i),e<a?(addLog({time:new Date().toLocaleTimeString(),message:`执行出错: ${i.message}，等待3秒后重试...`,type:"warning"}),await new Promise(l=>setTimeout(l,3e3)),e++):(tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`执行失败: ${i.message}`,type:"error"}))}}await new Promise(n=>setTimeout(n,1e3))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量任务执行结束")}},batchClaimBoxPointReward=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取宝箱积分: ${e.name} ===`,type:"info"}),await ensureConnection(t),await tokenStore.sendMessageWithPromise(t,"item_batchclaimboxpointreward",{},5e3),addLog({time:new Date().toLocaleTimeString(),message:"宝箱积分领取成功",type:"success"}),await tokenStore.sendMessage(t,"role_getroleinfo"),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取宝箱积分结束")}},batchOpenBox=async(t=!1)=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const e=t?batchSettings.defaultBoxType:helperSettings.boxType,a=t?batchSettings.boxCount:helperSettings.count,o=Math.floor(a/10),n=a%10,i={2001:"木质宝箱",2002:"青铜宝箱",2003:"黄金宝箱",2004:"铂金宝箱"};selectedTokens.value.forEach(l=>{tokenStatus.value[l]="waiting"});for(const l of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=l,tokenStatus.value[l]="running",currentProgress.value=0;const d=tokens.value.find(r=>r.id===l);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量开箱: ${d.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`宝箱类型: ${i[e]}, 数量: ${a}`,type:"info"}),await ensureConnection(l);for(let r=0;r<o&&!shouldStop.value;r++)await tokenStore.sendMessageWithPromise(l,"item_openbox",{itemId:e,number:10},5e3),currentProgress.value=Math.floor((r+1)/(o+(n>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`开箱进度: ${(r+1)*10}/${a}`,type:"info"}),await new Promise(c=>setTimeout(c,300));n>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(l,"item_openbox",{itemId:e,number:n},5e3),addLog({time:new Date().toLocaleTimeString(),message:`开箱进度: ${a}/${a}`,type:"info"})),await tokenStore.sendMessageWithPromise(l,"item_batchclaimboxpointreward"),await new Promise(r=>setTimeout(r,500)),await tokenStore.sendMessage(l,"role_getroleinfo"),tokenStatus.value[l]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${d.name} 开箱完成 ===`,type:"success"})}catch(r){console.error(r),tokenStatus.value[l]="failed",addLog({time:new Date().toLocaleTimeString(),message:`开箱失败: ${r.message}`,type:"error"})}currentProgress.value=100,await new Promise(r=>setTimeout(r,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量开箱结束")},batchFish=async(t=!1)=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const e=t?batchSettings.defaultFishType:helperSettings.fishType,a=t?batchSettings.fishCount:helperSettings.count,o=Math.floor(a/10),n=a%10,i={1:"普通鱼竿",2:"黄金鱼竿"};selectedTokens.value.forEach(l=>{tokenStatus.value[l]="waiting"});for(const l of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=l,tokenStatus.value[l]="running",currentProgress.value=0;const d=tokens.value.find(r=>r.id===l);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量钓鱼: ${d.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`鱼竿类型: ${i[e]}, 数量: ${a}`,type:"info"}),await ensureConnection(l);for(let r=0;r<o&&!shouldStop.value;r++)await tokenStore.sendMessageWithPromise(l,"artifact_lottery",{type:e,lotteryNumber:10,newFree:!0},5e3),currentProgress.value=Math.floor((r+1)/(o+(n>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`钓鱼进度: ${(r+1)*10}/${a}`,type:"info"}),await new Promise(c=>setTimeout(c,300));n>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(l,"artifact_lottery",{type:e,lotteryNumber:n,newFree:!0},5e3),addLog({time:new Date().toLocaleTimeString(),message:`钓鱼进度: ${a}/${a}`,type:"info"})),await tokenStore.sendMessage(l,"role_getroleinfo"),tokenStatus.value[l]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${d.name} 钓鱼完成 ===`,type:"success"})}catch(r){console.error(r),tokenStatus.value[l]="failed",addLog({time:new Date().toLocaleTimeString(),message:`钓鱼失败: ${r.message}`,type:"error"})}currentProgress.value=100,await new Promise(r=>setTimeout(r,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量钓鱼结束")},batchRecruit=async(t=!1)=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const e=t?batchSettings.recruitCount:helperSettings.count,a=Math.floor(e/10),o=e%10;selectedTokens.value.forEach(n=>{tokenStatus.value[n]="waiting"});for(const n of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=n,tokenStatus.value[n]="running",currentProgress.value=0;const i=tokens.value.find(l=>l.id===n);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量招募: ${i.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`招募数量: ${e}`,type:"info"}),await ensureConnection(n);for(let l=0;l<a&&!shouldStop.value;l++)await tokenStore.sendMessageWithPromise(n,"hero_recruit",{recruitType:1,recruitNumber:10},5e3),currentProgress.value=Math.floor((l+1)/(a+(o>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`招募进度: ${(l+1)*10}/${e}`,type:"info"}),await new Promise(d=>setTimeout(d,300));o>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(n,"hero_recruit",{recruitType:1,recruitNumber:o},5e3),addLog({time:new Date().toLocaleTimeString(),message:`招募进度: ${e}/${e}`,type:"info"})),await tokenStore.sendMessage(n,"role_getroleinfo"),tokenStatus.value[n]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${i.name} 招募完成 ===`,type:"success"})}catch(l){console.error(l),tokenStatus.value[n]="failed",addLog({time:new Date().toLocaleTimeString(),message:`招募失败: ${l.message}`,type:"error"})}currentProgress.value=100,await new Promise(l=>setTimeout(l,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量招募结束")},batchClaimFreeEnergy=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取怪异塔免费道具: ${e.name} ===`,type:"info"}),await ensureConnection(t);const a=await tokenStore.sendMessageWithPromise(t,"mergebox_getinfo",{actType:1},5e3);a&&a.mergeBox.freeEnergy>0?(await tokenStore.sendMessageWithPromise(t,"mergebox_claimfreeenergy",{actType:1},5e3),addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 成功领取免费道具${a.mergeBox.freeEnergy}个`,type:"success"})):addLog({time:new Date().toLocaleTimeString(),message:`===  ${e.name} 暂无免费道具可领取`,type:"success"}),tokenStatus.value[t]="completed"}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取免费道具失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取怪异塔免费道具结束")}},batchLegacyClaim=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(a=>a.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取功法残卷: ${e.name} ===`,type:"info"}),await ensureConnection(t);const a=await tokenStore.sendMessageWithPromise(t,"legacy_claimhangup",{},5e3);addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 成功领取功法残卷${a.reward[0].value}，共有${a.role.items[37007].quantity}个`,type:"success"}),tokenStatus.value[t]="completed"}catch(a){console.error(a),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取功法残卷失败: ${a.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取功法残卷结束")}},batchLegacyGiftSendEnhanced=async(t=!1)=>{var l,d,r,c,f,u,g,v,k,p;if(selectedTokens.value.length===0){message.warning("请先选择要操作的角色");return}const e=t?batchSettings.receiverId:recipientIdInput.value,a=t?batchSettings.password:securityPassword.value,o={recipientId:Number(e),itemId:37007,quantity:giftQuantity.value||0,serverName:((l=recipientInfo.value)==null?void 0:l.serverName)||"",name:((d=recipientInfo.value)==null?void 0:d.name)||""};if(!t){if(!o.recipientId||o.recipientId<=0){message.error("请输入有效的接收者ID");return}if(o.quantity<=0||o.quantity>1e3){message.error("赠送数量必须在1-1000之间");return}}isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(m=>{tokenStatus.value[m]="waiting"});let n=0,i=0;for(const m of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=m,tokenStatus.value[m]="running",currentProgress.value=0;const h=tokens.value.find(T=>T.id===m);let y=0;const b=2;for(;y<=b;)try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始赠送功法残卷: ${h.name} (尝试 ${y+1}/${b+1}) ===`,type:"info"}),await ensureConnection(m);const T=await tokenStore.sendGetRoleInfo(m),s=((f=(c=(r=T==null?void 0:T.role)==null?void 0:r.items)==null?void 0:c[o.itemId])==null?void 0:f.quantity)||0;if(t){if(s===0){addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 功法残卷不足，当前拥有: 0 ===`,type:"error"}),tokenStatus.value[m]="failed",i++;break}const S=await tokenStore.sendMessageWithPromise(m,"rank_getroleinfo",{bottleType:0,includeBottleTeam:!1,isSearch:!1,roleId:o.recipientId},5e3);if(o.serverName=((u=S==null?void 0:S.roleInfo)==null?void 0:u.serverName)||"",o.name=((g=S==null?void 0:S.roleInfo)==null?void 0:g.name)||"",!((v=S==null?void 0:S.roleInfo)!=null&&v.roleId)){addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 赠送功法残卷失败: 接收者${o.recipientId}不存在`,type:"error"}),tokenStatus.value[m]="failed",i++;break}o.quantity=s}if(s<o.quantity){addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 功法残卷不足，当前拥有: ${s}，需要: ${o.quantity} ===`,type:"error"}),tokenStatus.value[m]="failed",i++;break}addLog({time:new Date().toLocaleTimeString(),message:"=== 开始解除安全密码验证 ===",type:"info"});const w=await tokenStore.sendMessageWithPromise(m,"role_commitpassword",{password:a,passwordType:1},5e3);if(!w)throw new Error("安全密码验证请求无响应");if(!((p=(k=w.role)==null?void 0:k.statistics)!=null&&p["que:wh:tm"])){addLog({time:new Date().toLocaleTimeString(),message:"=== 密码解除失败,请检查密码是否配置正确",type:"error"}),tokenStatus.value[m]="failed",i++;break}if(addLog({time:new Date().toLocaleTimeString(),message:"=== 安全密码验证成功 ===",type:"success"}),addLog({time:new Date().toLocaleTimeString(),message:`=== 开始赠送功法残卷${o.quantity}个,目标:[${o.serverName}] ID:${o.recipientId} ${o.name} ===`,type:"info"}),!await tokenStore.sendMessageWithPromise(m,"legacy_sendgift",{itemCnt:o.quantity,legacyUIds:[],targetId:o.recipientId},5e3))throw new Error("赠送请求无响应");await tokenStore.sendMessage(m,"role_getroleinfo"),addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 成功赠送功法残卷${o.quantity}个给[${o.serverName}] ID:${o.recipientId} ${o.name} ===`,type:"success"}),tokenStatus.value[m]="completed",n++;break}catch(T){y++,console.error(`赠送失败: ${T.message}`);let s=T.message||"未知错误";if(s.includes("200160")?s="模块未开启":s.includes("timeout")?s="请求超时":s.includes("网络")&&(s="网络错误"),y<=b)addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 赠送功法残卷失败: ${s}，将在3秒后重试 ===`,type:"warning"}),await new Promise(w=>setTimeout(w,3e3));else{addLog({time:new Date().toLocaleTimeString(),message:`=== ${h.name} 赠送功法残卷失败: ${s}，已达最大重试次数 ===`,type:"error"}),tokenStatus.value[m]="failed",i++;break}}currentProgress.value=100,await new Promise(T=>setTimeout(T,500))}isRunning.value=!1,currentRunningTokenId.value=null,addLog({time:new Date().toLocaleTimeString(),message:`=== 批量赠送功法残卷完成: 成功 ${n} 个，失败 ${i} 个 ===`,type:"success"}),message.success(`批量赠送功法残卷结束，成功 ${n} 个，失败 ${i} 个`)},stopBatch=()=>{shouldStop.value=!0,addLog({time:new Date().toLocaleTimeString(),message:"正在停止...",type:"warning"})};return(t,e)=>{const a=resolveComponent("n-button"),o=resolveComponent("n-icon"),n=resolveComponent("n-space"),i=resolveComponent("n-checkbox"),l=resolveComponent("n-tag"),d=resolveComponent("n-grid-item"),r=resolveComponent("n-grid"),c=resolveComponent("n-checkbox-group"),f=resolveComponent("n-card"),u=resolveComponent("n-progress"),g=resolveComponent("n-select"),v=resolveComponent("n-switch"),k=resolveComponent("n-modal"),p=resolveComponent("n-input"),m=resolveComponent("n-text"),h=resolveComponent("n-input-number"),y=resolveComponent("n-radio"),b=resolveComponent("n-radio-group"),T=resolveComponent("n-time-picker");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[e[54]||(e[54]=createBaseVNode("h2",null,"批量日常任务",-1)),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7," 共 "+toDisplayString(scheduledTasks.value.length)+" 个定时任务 ",1),shortestCountdownTask.value?(openBlock(),createElementBlock("div",_hoisted_8," 即将执行："+toDisplayString(shortestCountdownTask.value.task.name)+" ("+toDisplayString(shortestCountdownTask.value.countdown.formatted)+") ",1)):(openBlock(),createElementBlock("div",_hoisted_9," 暂无定时任务 ")),createBaseVNode("div",_hoisted_10,[createVNode(a,{type:"primary",size:"small",onClick:openTaskModal},{default:withCtx(()=>[...e[52]||(e[52]=[createTextVNode(" 新增定时任务 ",-1)])]),_:1}),createVNode(a,{size:"small",onClick:e[0]||(e[0]=s=>showTasksModal.value=!0)},{default:withCtx(()=>[...e[53]||(e[53]=[createTextVNode(" 查看定时任务 ",-1)])]),_:1})])])]),createBaseVNode("div",_hoisted_11,[createVNode(a,{type:"primary",onClick:startBatch,disabled:isRunning.value||selectedTokens.value.length===0,size:"medium"},{default:withCtx(()=>[createTextVNode(toDisplayString(isRunning.value?"执行中...":"开始执行"),1)]),_:1},8,["disabled"]),createVNode(a,{onClick:stopBatch,disabled:!isRunning.value,type:"error",size:"medium"},{default:withCtx(()=>[...e[55]||(e[55]=[createTextVNode(" 停止 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{onClick:openBatchSettings,size:"medium"},{icon:withCtx(()=>[createVNode(o,null,{default:withCtx(()=>[createVNode(unref(Settings))]),_:1})]),default:withCtx(()=>[e[56]||(e[56]=createTextVNode(" 设置 ",-1))]),_:1})])]),createVNode(f,{title:"账号列表",class:"token-list-card"},{default:withCtx(()=>[createVNode(n,{style:{"margin-bottom":"12px"}},{default:withCtx(()=>[createVNode(a,{size:"small",onClick:claimHangUpRewards,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[57]||(e[57]=[createTextVNode(" 领取挂机 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchAddHangUpTime,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[58]||(e[58]=[createTextVNode(" 一键加钟 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:resetBottles,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[59]||(e[59]=[createTextVNode(" 重置罐子 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchlingguanzi,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[60]||(e[60]=[createTextVNode(" 一键领取罐子 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:climbTower,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[61]||(e[61]=[createTextVNode(" 一键爬塔 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchStudy,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[62]||(e[62]=[createTextVNode(" 一键答题 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchSmartSendCar,disabled:isRunning.value||selectedTokens.value.length===0||!isCarActivityOpen.value},{default:withCtx(()=>[...e[63]||(e[63]=[createTextVNode(" 智能发车 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchClaimCars,disabled:isRunning.value||selectedTokens.value.length===0||!isCarActivityOpen.value},{default:withCtx(()=>[...e[64]||(e[64]=[createTextVNode(" 一键收车 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:e[1]||(e[1]=s=>openHelperModal("box")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[65]||(e[65]=[createTextVNode(" 批量开箱 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchClaimBoxPointReward,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[66]||(e[66]=[createTextVNode(" 领取宝箱积分 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:e[2]||(e[2]=s=>openHelperModal("fish")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[67]||(e[67]=[createTextVNode(" 批量钓鱼 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:e[3]||(e[3]=s=>openHelperModal("recruit")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[68]||(e[68]=[createTextVNode(" 批量招募 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchbaoku13,disabled:isRunning.value||selectedTokens.value.length===0||!isbaokuActivityOpen.value},{default:withCtx(()=>[...e[69]||(e[69]=[createTextVNode(" 一键宝库前3层 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchbaoku45,disabled:isRunning.value||selectedTokens.value.length===0||!isbaokuActivityOpen.value},{default:withCtx(()=>[...e[70]||(e[70]=[createTextVNode(" 一键宝库4,5层 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchmengjing,disabled:isRunning.value||selectedTokens.value.length===0||!ismengjingActivityOpen.value},{default:withCtx(()=>[...e[71]||(e[71]=[createTextVNode(" 一键梦境 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchclubsign,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[72]||(e[72]=[createTextVNode(" 一键俱乐部签到 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batcharenafight,disabled:isRunning.value||selectedTokens.value.length===0||!isarenaActivityOpen.value},{default:withCtx(()=>[...e[73]||(e[73]=[createTextVNode(" 一键竞技场战斗3次 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchTopUpFish,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[74]||(e[74]=[createTextVNode(" 一键钓鱼补齐 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchTopUpArena,disabled:isRunning.value||selectedTokens.value.length===0||!isarenaActivityOpen.value},{default:withCtx(()=>[...e[75]||(e[75]=[createTextVNode(" 一键竞技场补齐 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchClaimFreeEnergy,disabled:isRunning.value||selectedTokens.value.length===0||!isWeirdTowerActivityOpen.value},{default:withCtx(()=>[...e[76]||(e[76]=[createTextVNode(" 一键领取怪异塔免费道具 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:legion_storebuygoods,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[77]||(e[77]=[createTextVNode(" 一键购买四圣碎片 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:legionStoreBuySkinCoins,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[78]||(e[78]=[createTextVNode(" 一键购买俱乐部5皮肤币 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:store_purchase,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[79]||(e[79]=[createTextVNode(" 一键黑市采购 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:collection_claimfreereward,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[80]||(e[80]=[createTextVNode(" 免费领取珍宝阁 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:batchLegacyClaim,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[81]||(e[81]=[createTextVNode(" 批量功法残卷领取 ",-1)])]),_:1},8,["disabled"]),createVNode(a,{size:"small",onClick:e[4]||(e[4]=s=>showLegacyGiftModal.value=!0),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[82]||(e[82]=[createTextVNode(" 批量功法残卷赠送 ",-1)])]),_:1},8,["disabled"])]),_:1}),createVNode(n,{vertical:""},{default:withCtx(()=>[createVNode(i,{checked:isAllSelected.value,indeterminate:isIndeterminate.value,"onUpdate:checked":handleSelectAll},{default:withCtx(()=>[...e[83]||(e[83]=[createTextVNode(" 全选 ",-1)])]),_:1},8,["checked","indeterminate"]),createVNode(c,{value:selectedTokens.value,"onUpdate:value":e[5]||(e[5]=s=>selectedTokens.value=s)},{default:withCtx(()=>[createVNode(r,{"x-gap":12,"y-gap":8,cols:batchSettings.tokenListColumns},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(tokens.value,s=>(openBlock(),createBlock(d,{key:s.id},{default:withCtx(()=>[createBaseVNode("div",_hoisted_12,[createVNode(i,{value:s.id,label:s.name,style:{flex:"1"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_13,[createBaseVNode("span",null,toDisplayString(s.name),1),createVNode(l,{size:"small",type:getStatusType(s.id),style:{"margin-left":"8px"}},{default:withCtx(()=>[createTextVNode(toDisplayString(getStatusText(s.id)),1)]),_:2},1032,["type"])])]),_:2},1032,["value","label"]),createVNode(a,{size:"tiny",circle:"",onClick:withModifiers(w=>openSettings(s),["stop"])},{icon:withCtx(()=>[createVNode(o,null,{default:withCtx(()=>[createVNode(unref(Settings))]),_:1})]),_:1},8,["onClick"])])]),_:2},1024))),128))]),_:1},8,["cols"])]),_:1},8,["value"])]),_:1})]),_:1}),batchSettings.hideScheduledTasksModule?createCommentVNode("",!0):(openBlock(),createBlock(f,{key:0,title:"定时任务",class:"scheduled-tasks-card",style:{"margin-top":"16px"}},{default:withCtx(()=>[createVNode(n,{style:{"margin-bottom":"12px"}},{default:withCtx(()=>[createVNode(a,{type:"primary",size:"small",onClick:openTaskModal},{default:withCtx(()=>[...e[84]||(e[84]=[createTextVNode(" 新增定时任务 ",-1)])]),_:1}),createVNode(a,{size:"small",onClick:e[6]||(e[6]=s=>showTasksModal.value=!0)},{default:withCtx(()=>[...e[85]||(e[85]=[createTextVNode(" 查看定时任务 ",-1)])]),_:1})]),_:1}),createBaseVNode("div",_hoisted_14,[e[86]||(e[86]=createBaseVNode("h4",{style:{margin:"0 0 12px 0",color:"#333"}},"即将执行的任务",-1)),shortestCountdownTask.value?(openBlock(),createElementBlock("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,toDisplayString(shortestCountdownTask.value.task.name),1),createBaseVNode("div",{style:normalizeStyle([{"font-size":"24px","font-weight":"bold",color:"#1677ff"},{color:shortestCountdownTask.value.countdown.isNearExecution?"#ff4d4f":"#1677ff"}])},toDisplayString(shortestCountdownTask.value.countdown.formatted),5)])):(openBlock(),createElementBlock("div",_hoisted_17," 暂无定时任务 "))]),scheduledTasks.value.length>0?(openBlock(),createElementBlock("div",_hoisted_18,[createBaseVNode("p",null,"已保存 "+toDisplayString(scheduledTasks.value.length)+" 个定时任务",1)])):(openBlock(),createElementBlock("div",_hoisted_19,[...e[87]||(e[87]=[createBaseVNode("p",null,"暂无定时任务",-1)])]))]),_:1}))]),createBaseVNode("div",_hoisted_20,[createVNode(f,{class:"log-card"},{header:withCtx(()=>[createBaseVNode("div",_hoisted_21,[createBaseVNode("div",_hoisted_22,toDisplayString(currentRunningTokenName.value?`正在执行: ${currentRunningTokenName.value}`:"执行日志"),1),createBaseVNode("div",_hoisted_23,[createVNode(i,{checked:autoScrollLog.value,"onUpdate:checked":e[7]||(e[7]=s=>autoScrollLog.value=s),size:"small"},{default:withCtx(()=>[...e[88]||(e[88]=[createTextVNode(" 自动滚动 ",-1)])]),_:1},8,["checked"]),createVNode(i,{checked:filterErrorsOnly.value,"onUpdate:checked":e[8]||(e[8]=s=>filterErrorsOnly.value=s),size:"small"},{default:withCtx(()=>[...e[89]||(e[89]=[createTextVNode(" 只看错误 ",-1)])]),_:1},8,["checked"]),errorCount.value>0?(openBlock(),createBlock(l,{key:0,type:"error",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(errorCount.value)+" 个错误 ",1)]),_:1})):createCommentVNode("",!0),createVNode(a,{size:"small",onClick:copyLogs},{default:withCtx(()=>[...e[90]||(e[90]=[createTextVNode(" 复制日志 ",-1)])]),_:1})])])]),default:withCtx(()=>[createVNode(u,{type:"line",percentage:currentProgress.value,"indicator-placement":"inside",processing:""},null,8,["percentage"]),createBaseVNode("div",{class:"log-container",ref_key:"logContainer",ref:logContainer},[(openBlock(!0),createElementBlock(Fragment,null,renderList(filteredLogs.value,(s,w)=>(openBlock(),createElementBlock("div",{key:w,class:normalizeClass(["log-item",s.type])},[createBaseVNode("span",_hoisted_24,toDisplayString(s.time),1),createBaseVNode("span",_hoisted_25,toDisplayString(s.message),1)],2))),128))],512)]),_:1})])]),createVNode(k,{show:showSettingsModal.value,"onUpdate:show":e[19]||(e[19]=s=>showSettingsModal.value=s),preset:"card",title:`任务设置 - ${currentSettingsTokenName.value}`,style:{width:"90%","max-width":"400px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_26,[createBaseVNode("div",_hoisted_27,[createBaseVNode("div",_hoisted_28,[e[91]||(e[91]=createBaseVNode("label",{class:"setting-label"},"竞技场阵容",-1)),createVNode(g,{value:currentSettings.arenaFormation,"onUpdate:value":e[9]||(e[9]=s=>currentSettings.arenaFormation=s),options:unref(formationOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_29,[e[92]||(e[92]=createBaseVNode("label",{class:"setting-label"},"BOSS阵容",-1)),createVNode(g,{value:currentSettings.bossFormation,"onUpdate:value":e[10]||(e[10]=s=>currentSettings.bossFormation=s),options:unref(formationOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_30,[e[93]||(e[93]=createBaseVNode("label",{class:"setting-label"},"BOSS次数",-1)),createVNode(g,{value:currentSettings.bossTimes,"onUpdate:value":e[11]||(e[11]=s=>currentSettings.bossTimes=s),options:unref(bossTimesOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,[e[94]||(e[94]=createBaseVNode("span",{class:"switch-label"},"领罐子",-1)),createVNode(v,{value:currentSettings.claimBottle,"onUpdate:value":e[12]||(e[12]=s=>currentSettings.claimBottle=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_33,[e[95]||(e[95]=createBaseVNode("span",{class:"switch-label"},"领挂机",-1)),createVNode(v,{value:currentSettings.claimHangUp,"onUpdate:value":e[13]||(e[13]=s=>currentSettings.claimHangUp=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_34,[e[96]||(e[96]=createBaseVNode("span",{class:"switch-label"},"竞技场",-1)),createVNode(v,{value:currentSettings.arenaEnable,"onUpdate:value":e[14]||(e[14]=s=>currentSettings.arenaEnable=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_35,[e[97]||(e[97]=createBaseVNode("span",{class:"switch-label"},"开宝箱",-1)),createVNode(v,{value:currentSettings.openBox,"onUpdate:value":e[15]||(e[15]=s=>currentSettings.openBox=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_36,[e[98]||(e[98]=createBaseVNode("span",{class:"switch-label"},"领取邮件奖励",-1)),createVNode(v,{value:currentSettings.claimEmail,"onUpdate:value":e[16]||(e[16]=s=>currentSettings.claimEmail=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_37,[e[99]||(e[99]=createBaseVNode("span",{class:"switch-label"},"黑市购买物品",-1)),createVNode(v,{value:currentSettings.blackMarketPurchase,"onUpdate:value":e[17]||(e[17]=s=>currentSettings.blackMarketPurchase=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_38,[e[100]||(e[100]=createBaseVNode("span",{class:"switch-label"},"付费招募",-1)),createVNode(v,{value:currentSettings.payRecruit,"onUpdate:value":e[18]||(e[18]=s=>currentSettings.payRecruit=s)},null,8,["value"])])])]),createBaseVNode("div",_hoisted_39,[createVNode(a,{type:"primary",onClick:saveSettings},{default:withCtx(()=>[...e[101]||(e[101]=[createTextVNode("保存设置",-1)])]),_:1})])])]),_:1},8,["show","title"]),createVNode(k,{show:showLegacyGiftModal.value,"onUpdate:show":e[24]||(e[24]=s=>showLegacyGiftModal.value=s),preset:"card",title:"批量功法残卷赠送",style:{width:"90%","max-width":"600px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_40,[createBaseVNode("div",_hoisted_41,[createBaseVNode("div",_hoisted_42,[e[103]||(e[103]=createBaseVNode("label",{class:"setting-label"},"接收者ID",-1)),createVNode(n,null,{default:withCtx(()=>[createVNode(p,{value:recipientIdInput.value,"onUpdate:value":e[20]||(e[20]=s=>recipientIdInput.value=s),placeholder:"请输入接收者ID",type:"number",onInput:clearRecipientError,style:{width:"180px"}},null,8,["value"]),createVNode(p,{value:securityPassword.value,"onUpdate:value":e[21]||(e[21]=s=>securityPassword.value=s),placeholder:"请输入安全密码",type:"password",onInput:clearRecipientError,style:{width:"180px"}},null,8,["value"]),createVNode(a,{type:"primary",onClick:queryRecipientInfo,disabled:!recipientIdInput.value||isQueryingRecipient.value||!securityPassword.value},{default:withCtx(()=>[...e[102]||(e[102]=[createTextVNode(" 查询 ",-1)])]),_:1},8,["disabled"])]),_:1}),recipientIdError.value?(openBlock(),createBlock(m,{key:0,type:"error",style:{"margin-top":"5px",display:"block"}},{default:withCtx(()=>[createTextVNode(toDisplayString(recipientIdError.value),1)]),_:1})):createCommentVNode("",!0)]),recipientInfo.value?(openBlock(),createElementBlock("div",_hoisted_43,[e[110]||(e[110]=createBaseVNode("label",{class:"setting-label"},"接收者信息",-1)),createBaseVNode("div",_hoisted_44,[createBaseVNode("div",_hoisted_45,[recipientInfo.value.avatarUrl&&!avatarLoadError.value?(openBlock(),createElementBlock("img",{key:0,src:recipientInfo.value.avatarUrl,alt:"角色头像",style:{width:"100%",height:"100%","object-fit":"cover",transition:"all 0.3s ease"},onError:handleAvatarError,onLoad:handleAvatarLoad},null,40,_hoisted_46)):(openBlock(),createElementBlock("div",_hoisted_47,toDisplayString((recipientInfo.value.name||"未知角色")[0]||"?"),1)),isAvatarLoading.value?(openBlock(),createElementBlock("div",_hoisted_48,[...e[104]||(e[104]=[createBaseVNode("div",{class:"loading-spinner",style:{width:"30px",height:"30px",border:"3px solid rgba(255, 255, 255, 0.3)","border-top":"3px solid white","border-radius":"50%",animation:"spin 1s linear infinite"}},null,-1)])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_49,[createBaseVNode("div",_hoisted_50,toDisplayString(recipientInfo.value.name||"未知角色"),1),createBaseVNode("div",_hoisted_51,[createBaseVNode("div",_hoisted_52,[e[105]||(e[105]=createBaseVNode("div",{class:"info-label",style:{"font-size":"12px",color:"#86909c","margin-bottom":"2px"}},"角色ID",-1)),createBaseVNode("div",_hoisted_53,toDisplayString(recipientInfo.value.roleId),1)]),createBaseVNode("div",_hoisted_54,[e[106]||(e[106]=createBaseVNode("div",{class:"info-label",style:{"font-size":"12px",color:"#86909c","margin-bottom":"2px"}},"服务器",-1)),createBaseVNode("div",_hoisted_55,toDisplayString(recipientInfo.value.serverName),1)]),createBaseVNode("div",_hoisted_56,[e[107]||(e[107]=createBaseVNode("div",{class:"info-label",style:{"font-size":"12px",color:"#86909c","margin-bottom":"2px"}},"战力",-1)),createBaseVNode("div",_hoisted_57,toDisplayString(recipientInfo.value.power)+" "+toDisplayString(recipientInfo.value.powerUnit),1)]),createBaseVNode("div",_hoisted_58,[e[108]||(e[108]=createBaseVNode("div",{class:"info-label",style:{"font-size":"12px",color:"#86909c","margin-bottom":"2px"}},"军团",-1)),createBaseVNode("div",_hoisted_59,toDisplayString(recipientInfo.value.legionName||"无"),1)]),createBaseVNode("div",_hoisted_60,[e[109]||(e[109]=createBaseVNode("div",{class:"info-label",style:{"font-size":"12px",color:"#86909c","margin-bottom":"2px"}},"军团ID",-1)),createBaseVNode("div",_hoisted_61,toDisplayString(recipientInfo.value.legionId||"无"),1)])])])])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_62,[e[111]||(e[111]=createBaseVNode("label",{class:"setting-label"},"赠送数量",-1)),createVNode(h,{value:giftQuantity.value,"onUpdate:value":e[22]||(e[22]=s=>giftQuantity.value=s),min:1,max:1e3,step:1,placeholder:"请输入赠送数量"},null,8,["value"])])]),createBaseVNode("div",_hoisted_63,[createVNode(a,{onClick:e[23]||(e[23]=s=>showLegacyGiftModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[112]||(e[112]=[createTextVNode("取消",-1)])]),_:1}),createVNode(a,{type:"primary",onClick:confirmLegacyGift,disabled:!recipientIdInput.value||!recipientInfo.value},{default:withCtx(()=>[...e[113]||(e[113]=[createTextVNode(" 开始赠送 ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["show"]),createVNode(k,{show:showHelperModal.value,"onUpdate:show":e[29]||(e[29]=s=>showHelperModal.value=s),preset:"card",title:helperModalTitle.value,style:{width:"90%","max-width":"400px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_64,[createBaseVNode("div",_hoisted_65,[helperType.value==="box"?(openBlock(),createElementBlock("div",_hoisted_66,[e[114]||(e[114]=createBaseVNode("label",{class:"setting-label"},"宝箱类型",-1)),createVNode(g,{value:helperSettings.boxType,"onUpdate:value":e[25]||(e[25]=s=>helperSettings.boxType=s),options:boxTypeOptions,size:"small"},null,8,["value"])])):createCommentVNode("",!0),helperType.value==="fish"?(openBlock(),createElementBlock("div",_hoisted_67,[e[115]||(e[115]=createBaseVNode("label",{class:"setting-label"},"鱼竿类型",-1)),createVNode(g,{value:helperSettings.fishType,"onUpdate:value":e[26]||(e[26]=s=>helperSettings.fishType=s),options:fishTypeOptions,size:"small"},null,8,["value"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_68,[e[116]||(e[116]=createBaseVNode("label",{class:"setting-label"},"消耗数量（10的倍数）",-1)),createVNode(h,{value:helperSettings.count,"onUpdate:value":e[27]||(e[27]=s=>helperSettings.count=s),min:10,max:1e4,step:10,size:"small"},null,8,["value"])])]),createBaseVNode("div",_hoisted_69,[createVNode(a,{onClick:e[28]||(e[28]=s=>showHelperModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[117]||(e[117]=[createTextVNode("取消",-1)])]),_:1}),createVNode(a,{type:"primary",onClick:executeHelper},{default:withCtx(()=>[...e[118]||(e[118]=[createTextVNode("开始执行",-1)])]),_:1})])])]),_:1},8,["show","title"]),createVNode(k,{show:showTasksModal.value,"onUpdate:show":e[30]||(e[30]=s=>showTasksModal.value=s),preset:"card",title:"定时任务列表",style:{width:"90%","max-width":"800px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_70,[(openBlock(!0),createElementBlock(Fragment,null,renderList(scheduledTasks.value,s=>{var w,L;return openBlock(),createElementBlock("div",{key:s.id,class:"task-item",style:{"margin-bottom":"16px",padding:"12px",border:"1px solid #e5e7eb","border-radius":"8px"}},[createBaseVNode("div",_hoisted_71,[createBaseVNode("div",_hoisted_72,toDisplayString(s.name),1),createVNode(v,{value:s.enabled,"onUpdate:value":[S=>s.enabled=S,S=>toggleTaskEnabled(s.id,S)]},null,8,["value","onUpdate:value"])]),createBaseVNode("div",_hoisted_73,[e[119]||(e[119]=createBaseVNode("span",{style:{color:"#6b7280"}},"运行类型：",-1)),createBaseVNode("span",null,toDisplayString(s.runType==="daily"?"每天固定时间":"Cron表达式"),1)]),createBaseVNode("div",_hoisted_74,[e[120]||(e[120]=createBaseVNode("span",{style:{color:"#6b7280"}},"运行时间：",-1)),createBaseVNode("span",null,toDisplayString(s.runType==="daily"?s.runTime:s.cronExpression),1)]),createBaseVNode("div",_hoisted_75,[e[121]||(e[121]=createBaseVNode("span",{style:{color:"#6b7280"}},"下次执行：",-1)),createBaseVNode("span",{style:normalizeStyle({fontWeight:"bold",color:(w=taskCountdowns.value[s.id])!=null&&w.isNearExecution?"#ff4d4f":"#1677ff"})},toDisplayString(((L=taskCountdowns.value[s.id])==null?void 0:L.formatted)||"计算中..."),5)]),createBaseVNode("div",_hoisted_76,[e[122]||(e[122]=createBaseVNode("span",{style:{color:"#6b7280"}},"选中账号：",-1)),createBaseVNode("span",null,toDisplayString(s.selectedTokens.length)+" 个",1)]),createBaseVNode("div",_hoisted_77,[e[123]||(e[123]=createBaseVNode("span",{style:{color:"#6b7280"}},"选中任务：",-1)),createBaseVNode("span",null,toDisplayString(s.selectedTasks.length)+" 个",1)]),createBaseVNode("div",_hoisted_78,[createVNode(a,{size:"tiny",onClick:S=>editTask(s)},{default:withCtx(()=>[...e[124]||(e[124]=[createTextVNode(" 编辑 ",-1)])]),_:1},8,["onClick"]),createVNode(a,{size:"tiny",type:"error",onClick:S=>deleteTask(s.id)},{default:withCtx(()=>[...e[125]||(e[125]=[createTextVNode(" 删除 ",-1)])]),_:1},8,["onClick"])])])}),128)),scheduledTasks.value.length===0?(openBlock(),createElementBlock("div",_hoisted_79," 暂无定时任务 ")):createCommentVNode("",!0)])]),_:1},8,["show"]),createVNode(k,{show:showTaskModal.value,"onUpdate:show":e[38]||(e[38]=s=>showTaskModal.value=s),preset:"card",title:editingTask.value?"编辑定时任务":"新增定时任务",style:{width:"90%","max-width":"600px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_80,[createBaseVNode("div",_hoisted_81,[createBaseVNode("div",_hoisted_82,[e[126]||(e[126]=createBaseVNode("label",{class:"setting-label"},"任务名称",-1)),createVNode(p,{value:taskForm.name,"onUpdate:value":e[31]||(e[31]=s=>taskForm.name=s),placeholder:"请输入任务名称"},null,8,["value"])]),createBaseVNode("div",_hoisted_83,[e[129]||(e[129]=createBaseVNode("label",{class:"setting-label"},"运行类型",-1)),createVNode(b,{value:taskForm.runType,"onUpdate:value":[e[32]||(e[32]=s=>taskForm.runType=s),resetRunType]},{default:withCtx(()=>[createVNode(y,{value:"daily"},{default:withCtx(()=>[...e[127]||(e[127]=[createTextVNode("每天固定时间",-1)])]),_:1}),createVNode(y,{value:"cron"},{default:withCtx(()=>[...e[128]||(e[128]=[createTextVNode("Cron表达式",-1)])]),_:1})]),_:1},8,["value"])]),taskForm.runType==="daily"?(openBlock(),createElementBlock("div",_hoisted_84,[e[130]||(e[130]=createBaseVNode("label",{class:"setting-label"},"运行时间",-1)),createVNode(T,{value:taskForm.runTime,"onUpdate:value":e[33]||(e[33]=s=>taskForm.runTime=s),format:"HH:mm"},null,8,["value"])])):createCommentVNode("",!0),taskForm.runType==="cron"?(openBlock(),createElementBlock("div",_hoisted_85,[e[132]||(e[132]=createBaseVNode("label",{class:"setting-label"},"Cron表达式",-1)),createVNode(p,{value:taskForm.cronExpression,"onUpdate:value":e[34]||(e[34]=s=>taskForm.cronExpression=s),placeholder:"请输入Cron表达式",onInput:parseCronExpression},null,8,["value"]),taskForm.cronExpression?(openBlock(),createElementBlock("div",_hoisted_86,[cronValidation.value.valid?(openBlock(),createElementBlock("div",_hoisted_87,[createVNode(m,{type:"success"},{default:withCtx(()=>[createTextVNode("✓ "+toDisplayString(cronValidation.value.message),1)]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_88,[createVNode(m,{type:"error"},{default:withCtx(()=>[createTextVNode("✗ "+toDisplayString(cronValidation.value.message),1)]),_:1})])),cronValidation.value.valid&&cronNextRuns.value.length>0?(openBlock(),createElementBlock("div",_hoisted_89,[e[131]||(e[131]=createBaseVNode("h4",null,"未来5次执行时间：",-1)),createBaseVNode("ul",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(cronNextRuns.value,(s,w)=>(openBlock(),createElementBlock("li",{key:w},toDisplayString(s),1))),128))])])):createCommentVNode("",!0)])):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_90,[createBaseVNode("div",_hoisted_91,[e[135]||(e[135]=createBaseVNode("label",{class:"setting-label"},"选择账号",-1)),createVNode(n,{size:"small"},{default:withCtx(()=>[createVNode(a,{size:"small",onClick:selectAllTokens},{default:withCtx(()=>[...e[133]||(e[133]=[createTextVNode(" 全选 ",-1)])]),_:1}),createVNode(a,{size:"small",onClick:deselectAllTokens},{default:withCtx(()=>[...e[134]||(e[134]=[createTextVNode(" 全不选 ",-1)])]),_:1})]),_:1})]),createVNode(c,{value:taskForm.selectedTokens,"onUpdate:value":e[35]||(e[35]=s=>taskForm.selectedTokens=s)},{default:withCtx(()=>[createVNode(r,{cols:2,"x-gap":12,"y-gap":8},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(tokens.value,s=>(openBlock(),createBlock(d,{key:s.id},{default:withCtx(()=>[createVNode(i,{value:s.id},{default:withCtx(()=>[createTextVNode(toDisplayString(s.name),1)]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),createBaseVNode("div",_hoisted_92,[createBaseVNode("div",_hoisted_93,[e[138]||(e[138]=createBaseVNode("label",{class:"setting-label"},"选择任务",-1)),createVNode(n,{size:"small"},{default:withCtx(()=>[createVNode(a,{size:"small",onClick:selectAllTasks},{default:withCtx(()=>[...e[136]||(e[136]=[createTextVNode(" 全选 ",-1)])]),_:1}),createVNode(a,{size:"small",onClick:deselectAllTasks},{default:withCtx(()=>[...e[137]||(e[137]=[createTextVNode(" 全不选 ",-1)])]),_:1})]),_:1})]),createVNode(c,{value:taskForm.selectedTasks,"onUpdate:value":e[36]||(e[36]=s=>taskForm.selectedTasks=s)},{default:withCtx(()=>[createVNode(r,{cols:2,"x-gap":12,"y-gap":8},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(availableTasks,s=>createVNode(d,{key:s.value},{default:withCtx(()=>[createVNode(i,{value:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(s.label),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["value"])])]),createBaseVNode("div",_hoisted_94,[createVNode(a,{onClick:e[37]||(e[37]=s=>showTaskModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[139]||(e[139]=[createTextVNode("取消",-1)])]),_:1}),createVNode(a,{type:"primary",onClick:saveTask},{default:withCtx(()=>[...e[140]||(e[140]=[createTextVNode("保存",-1)])]),_:1})])])]),_:1},8,["show","title"]),createVNode(k,{show:showBatchSettingsModal.value,"onUpdate:show":e[51]||(e[51]=s=>showBatchSettingsModal.value=s),preset:"card",title:"任务设置",style:{width:"90%","max-width":"400px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_95,[e[154]||(e[154]=createBaseVNode("div",{style:{"margin-bottom":"20px",color:"#6b7280","font-size":"14px"}}," 设置定时任务执行批量使用操作时的数量设置 ",-1)),createBaseVNode("div",_hoisted_96,[createBaseVNode("div",_hoisted_97,[e[141]||(e[141]=createBaseVNode("label",{class:"setting-label"},"定时批量开箱数量（10的倍数）",-1)),createVNode(h,{value:batchSettings.boxCount,"onUpdate:value":e[39]||(e[39]=s=>batchSettings.boxCount=s),min:10,max:1e4,step:10,size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_98,[e[142]||(e[142]=createBaseVNode("label",{class:"setting-label"},"定时批量钓鱼数量（10的倍数）",-1)),createVNode(h,{value:batchSettings.fishCount,"onUpdate:value":e[40]||(e[40]=s=>batchSettings.fishCount=s),min:10,max:1e4,step:10,size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_99,[e[143]||(e[143]=createBaseVNode("label",{class:"setting-label"},"定时批量招募数量（10的倍数）",-1)),createVNode(h,{value:batchSettings.recruitCount,"onUpdate:value":e[41]||(e[41]=s=>batchSettings.recruitCount=s),min:10,max:1e4,step:10,size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_100,[e[144]||(e[144]=createBaseVNode("label",{class:"setting-label"},"默认宝箱类型",-1)),createVNode(g,{value:batchSettings.defaultBoxType,"onUpdate:value":e[42]||(e[42]=s=>batchSettings.defaultBoxType=s),options:boxTypeOptions,size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_101,[e[145]||(e[145]=createBaseVNode("label",{class:"setting-label"},"默认鱼竿类型",-1)),createVNode(g,{value:batchSettings.defaultFishType,"onUpdate:value":e[43]||(e[43]=s=>batchSettings.defaultFishType=s),options:fishTypeOptions,size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_102,[e[146]||(e[146]=createBaseVNode("label",{class:"setting-label"},"接收者ID",-1)),createVNode(p,{value:batchSettings.receiverId,"onUpdate:value":e[44]||(e[44]=s=>batchSettings.receiverId=s),type:"text",placeholder:"请输入接收者ID",size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_103,[e[147]||(e[147]=createBaseVNode("label",{class:"setting-label"},"密码设置",-1)),createVNode(p,{value:batchSettings.password,"onUpdate:value":e[45]||(e[45]=s=>batchSettings.password=s),type:"password",placeholder:"请输入密码",size:"small"},null,8,["value"])]),createBaseVNode("div",_hoisted_104,[e[148]||(e[148]=createBaseVNode("label",{class:"setting-label"},"隐藏底部定时任务模块",-1)),createVNode(v,{value:batchSettings.hideScheduledTasksModule,"onUpdate:value":e[46]||(e[46]=s=>batchSettings.hideScheduledTasksModule=s)},null,8,["value"])]),createBaseVNode("div",_hoisted_105,[e[149]||(e[149]=createBaseVNode("label",{class:"setting-label"},"账号列表每行显示数量",-1)),createVNode(h,{value:batchSettings.tokenListColumns,"onUpdate:value":e[47]||(e[47]=s=>batchSettings.tokenListColumns=s),min:1,max:10,step:1,size:"small",style:{width:"100px"}},null,8,["value"])]),createBaseVNode("div",_hoisted_106,[e[150]||(e[150]=createBaseVNode("label",{class:"setting-label"},"日常任务命令执行后延迟(ms)",-1)),createVNode(h,{value:batchSettings.commandDelay,"onUpdate:value":e[48]||(e[48]=s=>batchSettings.commandDelay=s),min:100,max:2e3,step:100,size:"small",style:{width:"100px"}},null,8,["value"])]),createBaseVNode("div",_hoisted_107,[e[151]||(e[151]=createBaseVNode("label",{class:"setting-label"},"日常任务任务间延迟(ms)",-1)),createVNode(h,{value:batchSettings.taskDelay,"onUpdate:value":e[49]||(e[49]=s=>batchSettings.taskDelay=s),min:100,max:2e3,step:100,size:"small",style:{width:"100px"}},null,8,["value"])])]),createBaseVNode("div",_hoisted_108,[createVNode(a,{onClick:e[50]||(e[50]=s=>showBatchSettingsModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[152]||(e[152]=[createTextVNode("取消",-1)])]),_:1}),createVNode(a,{type:"primary",onClick:saveBatchSettings},{default:withCtx(()=>[...e[153]||(e[153]=[createTextVNode("保存设置",-1)])]),_:1})])])]),_:1},8,["show"])])}}},BatchDailyTasks=_export_sfc(_sfc_main,[["__scopeId","data-v-3c970b6b"]]);export{BatchDailyTasks as default};
