import{T as vt,H as ze}from"./ThemeToggle-De8aC1MN.js";import{k as ae,c as P,i as T,l as ft,a as c,n as gt,p as ee,b as n,C as kt,F as pe,q as Tt,s as yt,v as wt,r as D,x as De,y as bt,o as _t,z as N,e as j,w as o,u as d,d as E,g as Be,A as Ee,B as ie,f as ht,j as v,N as _,t as U,D as O,E as oe,G as W}from"./index-XtqsXPhp.js";import{_ as Ct}from"./xiaoyugan-Dwisk7G8.js";import $t from"./manual-DdFyNClH.js";import xt from"./url-AO5VsT8_.js";import{E as St,B as Ut,T as Mt}from"./bin-CYNtpyAA.js";import{_ as At}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as zt,C as Dt}from"./index-D_apwhcI.js";import{C as Bt,a as ue,S as Et,T as Pt}from"./index-CRDBrPEL.js";import{A as Pe}from"./Add-CQTMd0Ta.js";import{M as Lt}from"./Menu-BWEKwFHt.js";import{g as Ne,s as je,a as Oe,b as Rt,i as Le,c as It,B as Nt}from"./index-BjpO4cKO.js";import{R as ce}from"./Refresh-CdhzPM9z.js";import{E as Re}from"./EllipsisHorizontal-C6WE-zvi.js";import"./AlertCircleOutline-mg6HSfpI.js";import"./CloudUpload-CtQ8rO4w.js";import"./index-efJVBbu5.js";import"./render-function-DaVG5aXZ.js";const jt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ot=ft('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),Wt=[Ot],Ft=ae({name:"List",render:function(i,f){return T(),P("svg",jt,Wt)}}),Vt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Gt=c("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),Kt=[Gt],Ie=ae({name:"Star",render:function(i,f){return T(),P("svg",Vt,Kt)}}),Ht=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],Jt=["normal","processing","success","warning","danger"];var de=ae({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:p=>Jt.includes(p)},count:{type:Number}},setup(p,{slots:i}){const{status:f,color:a,dotStyle:L,offset:l,text:y,dot:C,maxCount:M,count:z}=gt(p),g=Ne("badge"),R=qt(g,f==null?void 0:f.value,i==null?void 0:i.default),F=ee(()=>{const B={...(L==null?void 0:L.value)||{}},[$,A]=(l==null?void 0:l.value)||[];$&&(B.marginRight=`${-$}px`),A&&(B.marginTop=`${A}px`);const I=!(a!=null&&a.value)||Ht.includes(a==null?void 0:a.value)?{}:{backgroundColor:a.value};return{mergedStyle:{...I,...B},computedDotStyle:B,computedColorStyle:I}}),J=()=>{const B=y==null?void 0:y.value,$=a==null?void 0:a.value,A=f==null?void 0:f.value,I=C==null?void 0:C.value,V=Number(z==null?void 0:z.value),x=(z==null?void 0:z.value)!=null,{computedDotStyle:q,mergedStyle:G}=F.value;return i.content?n("span",{class:`${g}-custom-dot`,style:q},[i.content()]):B&&!$&&!A?n("span",{class:`${g}-text`,style:q},[B]):A||$&&!x?n("span",{class:`${g}-status-wrapper`},[n("span",{class:[`${g}-status-dot`,{[`${g}-status-${A}`]:A,[`${g}-color-${$}`]:$}],style:G},null),B&&n("span",{class:`${g}-status-text`},[B])]):(I||$)&&V>0?n("span",{class:[`${g}-dot`,{[`${g}-color-${$}`]:$}],style:G},null):V===0?null:n("span",{class:`${g}-number`,style:G},[n("span",null,[M.value&&V>M.value?`${M.value}+`:V])])};return()=>n("span",{class:R.value},[i.default&&i.default(),J()])}});const qt=(p,i,f)=>ee(()=>[p,{[`${p}-status`]:i,[`${p}-no-children`]:!f}]),Xt=Object.assign(de,{install:(p,i)=>{je(p,i);const f=Oe(i);p.component(f+de.name,de)}});var me=ae({name:"Space",props:{align:{type:String},direction:{type:String,default:"horizontal"},size:{type:[Number,String,Array],default:"small"},wrap:{type:Boolean},fill:{type:Boolean}},setup(p,{slots:i}){const f=Ne("space"),a=ee(()=>{var C;return(C=p.align)!=null?C:p.direction==="horizontal"?"center":""}),L=ee(()=>[f,{[`${f}-${p.direction}`]:p.direction,[`${f}-align-${a.value}`]:a.value,[`${f}-wrap`]:p.wrap,[`${f}-fill`]:p.fill}]);function l(C){if(It(C))return C;switch(C){case"mini":return 4;case"small":return 8;case"medium":return 16;case"large":return 24;default:return 8}}const y=C=>{const M={},z=`${l(Le(p.size)?p.size[0]:p.size)}px`,g=`${l(Le(p.size)?p.size[1]:p.size)}px`;return C?p.wrap?{marginBottom:g}:{}:(p.direction==="horizontal"&&(M.marginRight=z),(p.direction==="vertical"||p.wrap)&&(M.marginBottom=g),M)};return()=>{var C;const M=Rt((C=i.default)==null?void 0:C.call(i),!0).filter(z=>z.type!==kt);return n("div",{class:L.value},[M.map((z,g)=>{var R,F;const J=i.split&&g>0;return n(pe,{key:(R=z.key)!=null?R:`item-${g}`},[J&&n("div",{class:`${f}-item-split`,style:y(!1)},[(F=i.split)==null?void 0:F.call(i)]),n("div",{class:`${f}-item`,style:y(g===M.length-1)},[z])])})])}}});const Yt=Object.assign(me,{install:(p,i)=>{je(p,i);const f=Oe(i);p.component(f+me.name,me)}}),Zt={class:"token-import-page"},Qt={class:"container"},en={class:"page-header"},tn={class:"header-content"},nn={class:"header-top"},sn={class:"card-header"},on={class:"card-body"},an={key:0,class:"tokens-section"},ln={class:"section-header"},rn={class:"header-actions"},un={key:0,class:"tokens-grid"},cn={class:"token-display"},dn={class:"token-value"},mn=["onClick"],pn={class:"remark-value"},vn={class:"token-timestamps"},fn={class:"timestamp-item"},gn={class:"timestamp-value"},kn={class:"timestamp-item"},Tn={class:"timestamp-value"},yn={class:"storage-info"},wn={class:"storage-item"},bn={key:0,class:"storage-upgrade"},_n={key:1,class:"tokens-list"},hn={style:{"min-width":"65px"}},Cn={style:{"min-width":"100px"}},$n={style:{display:"flex","align-items":"center","flex-wrap":"wrap",gap:"2px"}},xn={style:{"font-weight":"bold","font-size":"0.95em"}},Sn=["onClick"],Un={class:"modal-actions"},Mn={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(p){const i=p,f=ht(),a=Tt(),L=yt(),l=wt(),y=D(!1),C=D(!1),M=D(!1);D(null),D(null);const z=D(null),g=D(null),R=D("manual"),F=D(new Set),J=D(new Set),B=D(localStorage.getItem("tokenViewMode")||"list"),$=D(null),A=D(null),I=D({});De(B,t=>{localStorage.setItem("tokenViewMode",t)});const V=localStorage.getItem("tokenSortConfig"),x=D(V?JSON.parse(V):{field:"createdAt",direction:"asc"}),q=ee(()=>[...l.gameTokens].sort((t,e)=>{var b,w,h,k,se,K;let r,u;switch(x.value.field){case"name":r=((b=t.name)==null?void 0:b.toLowerCase())||"",u=((w=e.name)==null?void 0:w.toLowerCase())||"";break;case"server":r=((h=t.server)==null?void 0:h.toLowerCase())||"",u=((k=e.server)==null?void 0:k.toLowerCase())||"";break;case"createdAt":r=new Date(t.createdAt||0).getTime(),u=new Date(e.createdAt||0).getTime();break;case"lastUsed":r=new Date(t.lastUsed||0).getTime(),u=new Date(e.lastUsed||0).getTime();break;default:r=((se=t.name)==null?void 0:se.toLowerCase())||"",u=((K=e.name)==null?void 0:K.toLowerCase())||""}return r<u?x.value.direction==="asc"?-1:1:r>u?x.value.direction==="asc"?1:-1:0})),G=t=>{x.value.field===t?x.value.direction=x.value.direction==="asc"?"desc":"asc":(x.value.field=t,x.value.direction="asc"),localStorage.setItem("tokenSortConfig",JSON.stringify(x.value))},te=t=>x.value.field!==t?null:x.value.direction==="asc"?"↑":"↓",ve=(t,e)=>{$.value=t,e.dataTransfer.effectAllowed="move"},fe=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},ge=(t,e)=>{if(e.preventDefault(),$.value===null||$.value===t)return;const r=[...l.gameTokens],u=r[$.value];r.splice($.value,1),r.splice(t,0,u),l.gameTokens=r,$.value=null,a.success("Token 顺序已更新")},S=bt({name:"",token:"",server:"",wsUrl:"",remark:""}),We={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},Fe=[{label:"刷新所有Token",key:"refreshAll"},{label:"更新token信息",key:"updateInfo"},{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],Ve=()=>{y.value=!0},X=async t=>{F.value.add(t.id);try{if(t.sourceUrl){let e;if(t.sourceUrl.startsWith(window.location.origin)||t.sourceUrl.startsWith("/")||t.sourceUrl.startsWith("http://localhost")||t.sourceUrl.startsWith("http://127.0.0.1"))e=await fetch(t.sourceUrl);else try{e=await fetch(t.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(b){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${b.message}`)}if(!e.ok)throw new Error(`请求失败: ${e.status} ${e.statusText}`);const u=await e.json();if(!u.token)throw new Error("返回数据中未找到token字段");l.updateToken(t.id,{token:u.token,server:u.server||t.server,lastRefreshed:Date.now()}),a.success("Token刷新成功")}else{L.info({title:"重新获取Token",content:`Token "${t.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{y.value=!0,R.value="manual",importForm.name=t.name,importForm.server=t.server,importForm.wsUrl=t.wsUrl},onNegativeClick:()=>{l.getWebSocketStatus(t.id)==="connected"&&l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl),a.info("正在尝试重新连接...")},500)}});return}l.getWebSocketStatus(t.id)==="connected"&&(l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl)},500))}catch(e){console.error("刷新Token失败:",e),a.error(e.message||"Token刷新失败")}finally{F.value.delete(t.id)}},ke=t=>{L.warning({title:"升级为长期有效",content:`确认要将Token "${t.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{l.upgradeTokenToPermanent(t.id)?a.success(`Token "${t.name}" 已升级为长期有效！`):a.error("升级失败，该Token可能已经是长期有效状态")}})},Te=(t,e=!1)=>{if(A.value){Ce();return}const r=ie.value===t.id,u=Y(t.id);if(r&&u==="connected"&&!e){l.closeWebSocketConnection(t.id),a.success(`已断开 ${t.name} 的连接`);return}if(!r&&u==="connected"&&!e){l.closeWebSocketConnection(t.id),a.success(`已断开 ${t.name} 的连接`);return}if(r&&u==="connecting"&&!e){a.info(`${t.name} 正在连接中...`);return}l.selectToken(t.id,e)?e?a.success(`强制重连：${t.name}`):r?a.success(`重新连接：${t.name}`):a.success(`已选择：${t.name}`):a.error(`选择Token失败：${t.name}`)},Y=t=>l.getWebSocketStatus(t),ye=t=>{const e=Y(t);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[e]||"未连接"},we=t=>{const e=Y(t);return{connected:"success",connecting:"warning",disconnected:"danger",error:"danger",disconnecting:"warning"}[e]||"danger"},Ge=t=>Y(t)==="connected"?"success":"error",Ke=t=>Y(t)==="connected"?"green":"red",be=t=>{const e=[{label:"编辑",key:"edit",icon:()=>W(_,null,{default:()=>W(ue)})},{label:"复制Token",key:"copy",icon:()=>W(_,null,{default:()=>W(Dt)})}];return t.importMethod==="url"&&t.sourceUrl?e.push({label:"从URL刷新",key:"refresh-url",icon:()=>W(_,null,{default:()=>W(Et)})}):e.push({label:"重新获取",key:"refresh",icon:()=>W(_,null,{default:()=>W(ce)})}),e.push({type:"divider"},{label:"删除",key:"delete",icon:()=>W(_,null,{default:()=>W(Pt)}),props:{style:{color:"#e74c3c"}}}),e},_e=async(t,e)=>{switch(t){case"edit":He(e);break;case"copy":qe(e);break;case"refresh":X(e);break;case"refresh-url":X(e);break;case"delete":Xe(e);break}},He=t=>{g.value=t,Object.assign(S,{name:t.name,token:t.token,server:t.server||"",wsUrl:t.wsUrl||"",remark:t.remark||""}),M.value=!0},Je=async()=>{if(!(!z.value||!g.value))try{await z.value.validate(),l.updateToken(g.value.id,{name:S.name,token:S.token,server:S.server,wsUrl:S.wsUrl,remark:S.remark}),a.success("Token信息已更新"),M.value=!1,g.value=null}catch{}},qe=async t=>{try{await navigator.clipboard.writeText(t.token),a.success("Token已复制到剪贴板")}catch{a.error("复制失败")}},he=t=>{A.value=t.id,I.value[t.id]=t.remark||""},Ce=()=>{if(!A.value)return;const t=A.value,e=I.value[t]||"";l.updateToken(t,{remark:e}),A.value=null,a.success("备注已保存")},ne=t=>{Ce()},$e=()=>{A.value=null},Xe=t=>{L.warning({title:"删除Token",content:`确定要删除Token "${t.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{l.removeToken(t.id),a.success("Token已删除")}})},Ye=async()=>{if(!l.gameTokens.length){a.warning("没有可刷新的Token");return}const t=l.gameTokens.filter(r=>r.sourceUrl),e=l.gameTokens.filter(r=>!r.sourceUrl);if(t.length===0){a.warning("没有支持自动刷新的Token");return}L.warning({title:"批量刷新Token",content:"确定要刷新所有支持自动刷新的Token吗?",positiveText:"开始刷新",negativeText:"取消",onPositiveClick:async()=>{try{let r=0,u=0;const b=a.loading(`正在批量刷新Token (0/${t.length})`,{duration:0});for(let w=0;w<t.length;w++){const h=t[w];try{b.content=`正在刷新Token (${w+1}/${t.length}): ${h.name}`,await X(h),r++}catch(k){console.error(`刷新Token "${h.name}" 失败:`,k),u++}w<t.length-1&&await new Promise(k=>setTimeout(k,500))}b.destroy(),u===0?a.success(`批量刷新完成！成功刷新 ${r} 个Token`):a.warning(`批量刷新完成，成功 ${r} 个，失败 ${u} 个`),e.length>0&&a.info(`${e.length} 个手动导入的Token需要手动刷新`)}catch(r){a.error("批量刷新过程中发生错误: "+r.message)}}})},Ze=t=>{switch(t){case"refreshAll":Ye();break;case"updateInfo":ot();break;case"export":Qe();break;case"import":et();break;case"clean":tt();break;case"disconnect":nt();break;case"clear":st();break}},Qe=()=>{try{const t=l.exportTokens(),e=JSON.stringify(t,null,2),r=new Blob([e],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(r),u.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,u.click(),a.success("Token数据已导出")}catch{a.error("导出失败")}},et=()=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{const r=e.target.files[0];if(r){const u=new FileReader;u.onload=b=>{try{const w=JSON.parse(b.target.result),h=l.importTokens(w);h.success?a.success(h.message):a.error(h.message)}catch{a.error("文件格式错误")}},u.readAsText(r)}},t.click()},tt=()=>{const t=l.cleanExpiredTokens();a.success(`已清理 ${t} 个过期Token`)},nt=()=>{l.gameTokens.forEach(t=>{l.closeWebSocketConnection(t.id)}),a.success("所有连接已断开")},st=()=>{L.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{l.clearAllTokens(),a.success("所有Token已清除")}})},ot=async()=>{if(l.gameTokens.length===0){a.warning("没有可更新的Token");return}L.warning({title:"更新所有Token信息",content:`此操作将逐个连接所有Token，获取最新的角色名称和服务器信息，完成后自动断开连接。

预计耗时：约3-5秒/个Token`,positiveText:"开始更新",negativeText:"取消",onPositiveClick:async()=>{try{let t=0,e=0;const r=l.gameTokens.length,u=a.loading(`正在更新Token信息 (0/${r})`,{duration:0});for(let b=0;b<l.gameTokens.length;b++){const w=l.gameTokens[b];u.content=`正在更新Token信息 (${b+1}/${r}): ${w.name}`;try{await l.selectToken(w.id),await new Promise(h=>setTimeout(h,1e3)),l.closeWebSocketConnection(w.id),t++,a.success(`Token "${w.name}" 信息更新成功`)}catch(h){console.error(`更新Token "${w.name}" 失败:`,h),e++,a.error(`Token "${w.name}" 信息更新失败`)}b<l.gameTokens.length-1&&await new Promise(h=>setTimeout(h,500))}u.destroy(),e===0?a.success(`所有Token信息更新完成！成功更新 ${t} 个Token`):a.warning(`Token信息更新完成，成功 ${t} 个，失败 ${e} 个`)}catch(t){a.error("更新过程中发生错误: "+t.message)}}})},at=t=>{if(!t)return"";const e=t.length;return e<=8?t:t.substring(0,4)+"***"+t.substring(e-4)},xe=t=>new Date(t).toLocaleString("zh-CN"),lt=()=>{f.push("/admin/batch-daily-tasks")},Se=t=>{l.selectToken(t.id),a.success(`正在进入 ${t.name} 的控制台`),f.push("/admin/dashboard")},Ue=async()=>{if(i.token||i.api)try{C.value=!0;let t=null;if(i.api){a.info("正在从API获取token...");const e=await fetch(i.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!e.ok)throw new Error(`API请求失败: ${e.status} ${e.statusText}`);const r=await e.json();if(!r.token)throw new Error("API返回数据中未找到token字段");t=l.importBase64Token(i.name||r.name||"通过API导入的Token",r.token,{server:i.server||r.server,wsUrl:i.wsUrl,sourceUrl:i.api,importMethod:"url"})}else i.token&&(a.info("正在导入token..."),t=l.importBase64Token(i.name||"通过URL导入的Token",i.token,{server:i.server,wsUrl:i.wsUrl,importMethod:"url"}));if(t&&t.success)a.success(`Token "${t.tokenName}" 导入成功！`),i.auto&&t.token?(l.selectToken(t.token.id),a.success("正在跳转到控制台..."),setTimeout(()=>{f.push("/admin/dashboard")},1500)):f.replace("/tokens");else throw new Error((t==null?void 0:t.message)||"Token导入失败")}catch(t){console.error("URL参数处理失败:",t),a.error(`导入失败: ${t.message}`),f.replace("/tokens")}finally{C.value=!1}};return De(()=>[i.token,i.api],Ue,{immediate:!1}),_t(async()=>{l.initTokenStore(),await Ue(),!l.hasTokens&&!i.token&&!i.api&&(y.value=!0)}),(t,e)=>{const r=vt,u=E("n-radio-button"),b=E("n-radio-group"),w=zt,h=E("n-divider"),k=E("n-button"),se=E("n-button-group"),K=E("n-space"),le=E("n-dropdown"),rt=Mt,Me=Xt,it=Yt,H=E("n-input"),Ae=Nt,re=E("n-tag"),ut=Bt,ct=E("n-card"),dt=St,Z=E("n-form-item"),mt=E("n-form"),pt=E("n-modal");return T(),P("div",Zt,[c("div",Qt,[c("div",en,[c("div",tn,[c("div",nn,[e[28]||(e[28]=c("img",{src:Ct,alt:"XYZW",class:"brand-logo"},null,-1)),n(r)]),e[29]||(e[29]=c("h1",null,"游戏Token管理",-1))])]),n(w,{class:"token-import-modal",visible:y.value,"onUpdate:visible":e[7]||(e[7]=s=>y.value=s),width:"40rem",footer:!1,"default-visible":!d(l).hasTokens},{title:o(()=>[c("h2",null,[n(d(_),null,{default:o(()=>[n(d(Pe))]),_:1}),e[30]||(e[30]=v(" 添加游戏Token ",-1))])]),default:o(()=>[c("div",sn,[n(b,{value:R.value,"onUpdate:value":e[0]||(e[0]=s=>R.value=s),class:"import-method-tabs",size:"small"},{default:o(()=>[n(u,{value:"manual"},{default:o(()=>[...e[31]||(e[31]=[v(" 手动输入 ",-1)])]),_:1}),n(u,{value:"url"},{default:o(()=>[...e[32]||(e[32]=[v(" URL获取 ",-1)])]),_:1}),n(u,{value:"bin"},{default:o(()=>[...e[33]||(e[33]=[v(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),c("div",on,[R.value==="manual"?(T(),j($t,{key:0,onCancel:e[1]||(e[1]=()=>y.value=!1),onOk:e[2]||(e[2]=()=>y.value=!1)})):N("",!0),R.value==="url"?(T(),j(xt,{key:1,onCancel:e[3]||(e[3]=()=>y.value=!1),onOk:e[4]||(e[4]=()=>y.value=!1)})):N("",!0),R.value==="bin"?(T(),j(Ut,{key:2,onCancel:e[5]||(e[5]=()=>y.value=!1),onOk:e[6]||(e[6]=()=>y.value=!1)})):N("",!0)])]),_:1},8,["visible","default-visible"]),d(l).hasTokens?(T(),P("div",an,[c("div",ln,[n(K,{align:"center"},{default:o(()=>[c("h2",null,"我的Token列表 ("+U(d(l).gameTokens.length)+"个)",1),n(b,{value:B.value,"onUpdate:value":e[8]||(e[8]=s=>B.value=s),size:"small"},{default:o(()=>[n(u,{value:"list"},{default:o(()=>[...e[34]||(e[34]=[v("列表",-1)])]),_:1}),n(u,{value:"card"},{default:o(()=>[...e[35]||(e[35]=[v("卡片",-1)])]),_:1})]),_:1},8,["value"]),n(h,{vertical:"",style:{height:"24px"}}),n(se,{size:"small"},{default:o(()=>[n(k,{onClick:e[9]||(e[9]=s=>G("name")),type:x.value.field==="name"?"primary":"default"},{default:o(()=>[v(" 名称 "+U(te("name")),1)]),_:1},8,["type"]),n(k,{onClick:e[10]||(e[10]=s=>G("server")),type:x.value.field==="server"?"primary":"default"},{default:o(()=>[v(" 服务器 "+U(te("server")),1)]),_:1},8,["type"]),n(k,{onClick:e[11]||(e[11]=s=>G("createdAt")),type:x.value.field==="createdAt"?"primary":"default"},{default:o(()=>[v(" 创建时间 "+U(te("createdAt")),1)]),_:1},8,["type"]),n(k,{onClick:e[12]||(e[12]=s=>G("lastUsed")),type:x.value.field==="lastUsed"?"primary":"default"},{default:o(()=>[v(" 最后使用 "+U(te("lastUsed")),1)]),_:1},8,["type"])]),_:1})]),_:1}),c("div",rn,[n(k,{type:"success",onClick:lt},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Ft))]),_:1})]),default:o(()=>[e[36]||(e[36]=v(" 批量功能 ",-1))]),_:1}),y.value?N("",!0):(T(),j(k,{key:0,type:"primary",onClick:e[13]||(e[13]=s=>y.value=!0)},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Pe))]),_:1})]),default:o(()=>[e[37]||(e[37]=v(" 添加Token ",-1))]),_:1})),n(le,{options:Fe,onSelect:Ze},{default:o(()=>[n(k,null,{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Lt))]),_:1})]),default:o(()=>[e[38]||(e[38]=v(" 批量操作 ",-1))]),_:1})]),_:1})])]),B.value==="card"?(T(),P("div",un,[(T(!0),P(pe,null,Be(d(q),(s,Q)=>(T(),j(ut,{key:s.id,draggable:"true",onDragstart:m=>ve(Q,m),onDragover:e[16]||(e[16]=m=>fe(m)),onDrop:m=>ge(Q,m),class:Ee({"token-card":!0,active:d(ie)===s.id}),onClick:m=>Te(s)},{title:o(()=>[n(it,{class:"token-name"},{default:o(()=>[v(U(s.name)+" ",1),s.server?(T(),j(rt,{key:0,color:Ke(s.id)},{default:o(()=>[v(U(s.server),1)]),_:2},1032,["color"])):N("",!0),n(Me,{status:we(s.id),text:ye(s.id)},null,8,["status","text"])]),_:2},1024)]),extra:o(()=>[n(le,{options:be(s),onSelect:m=>_e(m,s)},{default:o(()=>[n(k,{text:""},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Re))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:o(()=>[c("div",cn,[e[39]||(e[39]=c("span",{class:"token-label"},"Token:",-1)),c("code",dn,U(at(s.token)),1)]),A.value===s.id?(T(),P("div",{key:0,class:"token-remark token-remark-edit",onClick:e[15]||(e[15]=O(()=>{},["stop"]))},[e[40]||(e[40]=c("span",{class:"remark-label"},"备注：",-1)),n(H,{value:I.value[s.id],"onUpdate:value":m=>I.value[s.id]=m,type:"textarea",rows:2,placeholder:"添加备注信息...",onBlur:m=>ne(s),onKeyup:[oe(m=>ne(s),["enter"]),e[14]||(e[14]=oe(m=>$e(),["esc"]))],autofocus:""},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(T(),P("div",{key:1,class:"token-remark",onClick:O(m=>he(s),["stop"])},[e[41]||(e[41]=c("span",{class:"remark-label"},"备注：",-1)),c("span",pn,U(s.remark||"点击添加备注"),1),n(d(_),{style:{"margin-left":"4px",color:"var(--text-tertiary)"}},{default:o(()=>[n(d(ue))]),_:1})],8,mn)),n(Ae,{loading:F.value.has(s.id),onClick:O(m=>X(s),["stop"])},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(ce))]),_:1})]),default:o(()=>[v(" "+U(s.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),c("div",vn,[c("div",fn,[e[42]||(e[42]=c("span",{class:"timestamp-label"},"创建：",-1)),c("span",gn,U(xe(s.createdAt)),1)]),c("div",kn,[e[43]||(e[43]=c("span",{class:"timestamp-label"},"使用：",-1)),c("span",Tn,U(xe(s.lastUsed)),1)])]),c("div",yn,[c("div",wn,[e[44]||(e[44]=c("span",{class:"storage-label"},"存储类型：",-1)),n(re,{size:"small",type:s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?"success":"warning"},{default:o(()=>[v(U(s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?N("",!0):(T(),P("div",bn,[n(k,{size:"tiny",type:"success",ghost:"",onClick:O(m=>ke(s),["stop"])},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Ie))]),_:1})]),default:o(()=>[e[45]||(e[45]=v(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])]))])]),actions:o(()=>[n(k,{type:"primary",size:"large",block:"",loading:J.value.has(s.id),onClick:m=>Se(s)},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(ze))]),_:1})]),default:o(()=>[e[46]||(e[46]=v(" 进入控制台 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["onDragstart","onDrop","class","onClick"]))),128))])):(T(),P("div",_n,[(T(!0),P(pe,null,Be(d(q),(s,Q)=>(T(),j(ct,{key:s.id,draggable:"true",onDragstart:m=>ve(Q,m),onDragover:e[20]||(e[20]=m=>fe(m)),onDrop:m=>ge(Q,m),size:"small",style:{"margin-bottom":"8px"},hoverable:"",onClick:m=>Te(s),class:Ee({active:d(ie)===s.id})},{default:o(()=>[n(K,{justify:"space-between",align:"center"},{default:o(()=>[n(K,{align:"center",size:6},{default:o(()=>[c("div",hn,[n(Me,{status:we(s.id),text:ye(s.id)},null,8,["status","text"])]),c("div",Cn,[c("div",$n,[c("span",xn,U(s.name),1),s.server?(T(),j(re,{key:0,size:"small",type:Ge(s.id)},{default:o(()=>[v(U(s.server),1)]),_:2},1032,["type"])):N("",!0),A.value===s.id?(T(),P("div",{key:1,style:{"font-size":"0.75em",display:"flex","align-items":"center",gap:"4px"},onClick:e[18]||(e[18]=O(()=>{},["stop"]))},[e[47]||(e[47]=c("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),n(H,{value:I.value[s.id],"onUpdate:value":m=>I.value[s.id]=m,size:"small",placeholder:"添加备注...",onBlur:m=>ne(s),onKeyup:[oe(m=>ne(s),["enter"]),e[17]||(e[17]=oe(m=>$e(),["esc"]))],autofocus:"",style:{width:"150px"}},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(T(),P("div",{key:2,style:{"font-size":"0.75em",color:"var(--text-secondary)","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer",display:"flex","align-items":"center",gap:"4px"},onClick:O(m=>he(s),["stop"])},[e[48]||(e[48]=c("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),v(" "+U(s.remark||"点击添加备注")+" ",1),n(d(_),{style:{"font-size":"0.8em",color:"var(--text-tertiary)"}},{default:o(()=>[n(d(ue))]),_:1})],8,Sn))])])]),_:2},1024),n(K,null,{default:o(()=>[n(re,{size:"small",type:s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?"success":"warning"},{default:o(()=>[v(U(s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?"长期":"临时"),1)]),_:2},1032,["type"]),s.importMethod==="url"||s.importMethod==="bin"||s.upgradedToPermanent?N("",!0):(T(),j(k,{key:0,size:"small",type:"success",ghost:"",onClick:O(m=>ke(s),["stop"])},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Ie))]),_:1})]),default:o(()=>[e[49]||(e[49]=v(" 升级 ",-1))]),_:1},8,["onClick"])),n(k,{size:"small",type:"primary",loading:J.value.has(s.id),onClick:O(m=>Se(s),["stop"])},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(ze))]),_:1})]),default:o(()=>[e[50]||(e[50]=v(" 控制台 ",-1))]),_:1},8,["loading","onClick"]),n(k,{size:"small",onClick:O(m=>X(s),["stop"]),loading:F.value.has(s.id)},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(ce))]),_:1})]),default:o(()=>[e[51]||(e[51]=v(" 刷新 ",-1))]),_:1},8,["onClick","loading"]),n(le,{options:be(s),onSelect:m=>_e(m,s)},{default:o(()=>[n(k,{size:"small",circle:"",onClick:e[19]||(e[19]=O(()=>{},["stop"]))},{icon:o(()=>[n(d(_),null,{default:o(()=>[n(d(Re))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDragstart","onDrop","onClick","class"]))),128))]))])):N("",!0),!d(l).hasTokens&&!y.value?(T(),j(dt,{key:1},{image:o(()=>[...e[52]||(e[52]=[c("i",{class:"mdi:bed-empty"},null,-1)])]),default:o(()=>[e[54]||(e[54]=v(" 还没有导入任何Token ",-1)),n(Ae,{type:"link",onClick:Ve},{default:o(()=>[...e[53]||(e[53]=[v("打开Token管理",-1)])]),_:1})]),_:1})):N("",!0)]),n(pt,{show:M.value,"onUpdate:show":e[27]||(e[27]=s=>M.value=s),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:o(()=>[c("div",Un,[n(k,{onClick:e[26]||(e[26]=s=>M.value=!1)},{default:o(()=>[...e[55]||(e[55]=[v(" 取消 ",-1)])]),_:1}),n(k,{type:"primary",onClick:Je},{default:o(()=>[...e[56]||(e[56]=[v(" 保存 ",-1)])]),_:1})])]),default:o(()=>[n(mt,{ref_key:"editFormRef",ref:z,model:S,rules:We,"label-placement":"left","label-width":"80px"},{default:o(()=>[n(Z,{label:"名称",path:"name"},{default:o(()=>[n(H,{value:S.name,"onUpdate:value":e[21]||(e[21]=s=>S.name=s)},null,8,["value"])]),_:1}),n(Z,{label:"Token字符串",path:"token"},{default:o(()=>[n(H,{value:S.token,"onUpdate:value":e[22]||(e[22]=s=>S.token=s),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),n(Z,{label:"服务器"},{default:o(()=>[n(H,{value:S.server,"onUpdate:value":e[23]||(e[23]=s=>S.server=s)},null,8,["value"])]),_:1}),n(Z,{label:"WebSocket地址"},{default:o(()=>[n(H,{value:S.wsUrl,"onUpdate:value":e[24]||(e[24]=s=>S.wsUrl=s)},null,8,["value"])]),_:1}),n(Z,{label:"备注"},{default:o(()=>[n(H,{value:S.remark,"onUpdate:value":e[25]||(e[25]=s=>S.remark=s),type:"textarea",rows:2,placeholder:"添加备注信息..."},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},Jn=At(Mn,[["__scopeId","data-v-eb5088a1"]]);export{Jn as default};
