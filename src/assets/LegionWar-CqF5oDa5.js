var Te=Object.defineProperty;var Ne=(g,e,o)=>e in g?Te(g,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):g[e]=o;var X=(g,e,o)=>Ne(g,typeof e!="symbol"?e+"":e,o);import{aj as Oe,ak as L,al as C,x as De,s as Ae,r as $,p as ee,o as qe,O as Me,c as je,a as I,b as te,j as ue,w as me,d as ye,t as fe,i as We,B as $e,u as Ee}from"./index-BpMbMj_Q.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe=[{id:"20_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"20_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"22_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"23_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"23_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"27_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"34_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"34_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"35_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"37_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"37_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"38_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"36_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"35_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"36_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"37_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"36_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"35_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"34_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"34_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"23_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_4",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_3",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_3",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_4",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"27_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"18_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"22_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"18_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"20_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"20_7",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"22_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_26",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"27_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_26",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_26",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_29",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"27_29",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"27_30",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_30",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_30",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_27",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"26_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"24_26",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"25_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"22_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"23_28",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"23_27",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_29",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_30",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_29",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_30",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_27",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"20_27",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"18_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"22_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"21_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"20_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"17_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"17_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"18_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"19_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"18_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"13_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"5_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_9",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"13_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"13_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_5",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_26",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"17_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_25",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"32_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"33_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"34_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_16",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"28_21",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"30_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"29_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_13",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"10_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"11_5",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"12_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"13_4",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"13_3",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_3",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_4",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_5",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"14_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"17_5",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"17_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"16_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"15_8",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_12",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"31_11",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"2_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"3_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"3_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"3_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"4_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"4_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"4_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"5_20",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"5_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"6_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"6_18",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"6_17",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"6_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"6_23",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_10",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_14",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_15",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_19",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_22",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"7_24",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_5",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_6",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_7",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"9_7",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0},{id:"8_7",type:9,belongsLegionId:-1,hP:0,maxHP:0,point:0}],E=class E{constructor(){X(this,"nodes",{});X(this,"evenQDirs",[{q:-1,r:0},{q:-1,r:-1},{q:0,r:1},{q:0,r:-1},{q:1,r:0},{q:1,r:-1}]);X(this,"oddQDirs",[{q:-1,r:0},{q:-1,r:1},{q:0,r:1},{q:0,r:-1},{q:1,r:0},{q:1,r:1}]);X(this,"getAllNodes",function(){return Object.values(this.nodes)});if(E.instance)throw new Error("è¯·ä½¿ç”¨HexGraph.getInstance()è·å–å•ä¾‹");this.loadStaticNodes(),E.instance=this}static getInstance(){return E.instance?E.instance:new E}loadStaticNodes(){Fe.forEach(e=>{this.addNode(e)})}removeAllNode(){this.nodes={},this.loadStaticNodes()}addNode(e){var t;const o=e.id;this.nodes[o]||(this.nodes[o]={id:e.id,type:e.type,belongsLegionId:e.belongsLegionId,hP:e.hP,maxHP:e.maxHP,point:e.point,colorBg:((t=e==null?void 0:e.belongsLegionInfo)==null?void 0:t.color)||Le(e.type),typeName:Ke(e.type),position:{x:(e.id+"").split("_")[0],y:(e.id+"").split("_")[1]},neighbors:[]},this.buildAdjacency(this.nodes[o]))}addNodeList(e){e.forEach(o=>{this.addNode(o)})}buildAdjacency(e){const{x:o,y:t}=e.position;(o%2===0?this.evenQDirs:this.oddQDirs).forEach(({q:n,r:p})=>{const P=`${parseInt(o)+n}_${parseInt(t)+p}`,y=this.nodes[P];y&&(e.neighbors.includes(y)||e.neighbors.push(y),y.neighbors.includes(e)||y.neighbors.push(e))})}getNodeByCoords(e){return this.nodes[e]}findShortestPath(e,o,t){if(!e.includes("_")||!e.includes("_")||e===o)return!1;let i=this.getNodeByCoords(e),n=this.getNodeByCoords(o);if(!i||!n)return!1;const p=[i],P=new Map;P.set(i.id,null);let y=!1;for(;p.length>0&&!y;){const R=p.shift();if(!(R.type!=9&&R.belongsLegionId!=t)){for(const z of R.neighbors)if(!P.has(z.id)&&(P.set(z.id,R),p.push(z),z.id===n.id)){y=!0;break}}}if(!y)return!1;const k=[];let M=n;for(;M;)k.push(M),M=P.get(M.id);return k.reverse(),k}};X(E,"instance");let ae=E;const Ue=["#ff000033","#00ff0033","#0000ff33","#FFFF0033","#FF00FF33","#00ffff33","#66666633","#cdcdcd","#f77aff","#c9a0ff","#a0c6ff","#a0fffb","#a0ffb0","#cdffa0","#fffca0","#ffdda0","#ffbfa0","#f16f5a","#fb9494","#dcdd9a"],Qe=g=>{const e=g;if(!e||!e.battlefield)return!1;let o=e.battlefield.buildingData,t=Object.fromEntries(Object.values(e.battlefield.legions).map((n,p)=>[n.id,{blessingCount:n.blessingIdList.length,blessingScore:n.blessingScore,buildings:n.buildings,redCount:n.custom["red:quench"]||0,killCnt:n.killCnt,level:n.level,name:n.name,color:Ue[n.color],id:n.id,memberCount:Object.keys(n.members).length,point:n.point,position:n.position,strongholdId:n.strongholdId,score:Object.keys((n==null?void 0:n.buildings)||{}).map(P=>{var y;return((y=o[P])==null?void 0:y.point)??0}).reduce((P,y)=>P+y,0)+n.blessingScore,power:n.power,OnlineCount:0,participantsCount:0,danCount:0,reviveCount:0}])),i=Object.values(e.battlefield.roles).map(n=>(t[n.legionID+""].participantsCount++,n.isOnline&&t[n.legionID+""].OnlineCount++,t[n.legionID].reviveCount+=n.revive,t[n.legionID].danCount+=n.d-6>0?n.d-6:0,{name:n.name,legionName:t[n.legionID].name,legionId:n.legionID,lastState:ze(n.state),digGround:n.aB,kill:n.killCnt,revive:n.revive,die:n.d,dan:n.d-6>0?n.d-6:0,score:g.battlefield.roleIds[n.key]}));return{buildingData:o,memberInfo:i,legionInfo:t}},ze=g=>{switch(g){case"idle":return"ç©ºé—²";case"march":return"è¡Œè¿›";case"watching":return"è§‚çœ‹";case"over":return"æ­»äº¡";default:return"æœªçŸ¥"}},Le=g=>{switch(g){case 1:return"orange";case 2:return"yellow";case 3:return"gray";case 4:return"red";case 5:return"green";case 6:return"#1bd7d7";case 9:return"#2452f7";default:return"æœªçŸ¥"}},Ke=g=>{switch(g){case 1:return"30åˆ†æ®ç‚¹";case 2:return"50åˆ†æ®ç‚¹";case 3:return"80åˆ†æ®ç‚¹";case 4:return"å¤§æœ¬è¥";case 5:return"100åˆ†æ®ç‚¹";case 6:return"æ ¸å¿ƒ";case 9:return"é“è·¯";default:return"æœªçŸ¥"}},Ve=g=>g?g>=1e8?(g/1e8).toFixed(2)+"äº¿":g>=1e4?(g/1e4).toFixed(2)+"ä¸‡":g.toString():"0";function _e(g){(typeof g!="string"||g.trim()==="")&&(g="yyyy-MM-dd HH:mm:ss"),g=g.trim();const o=new Date,t=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0"),p=String(o.getHours()).padStart(2,"0"),P=String(o.getMinutes()).padStart(2,"0"),y=String(o.getSeconds()).padStart(2,"0");return g.replace(/yyyy/g,t).replace(/MM/g,i).replace(/dd/g,n).replace(/HH/g,p).replace(/mm/g,P).replace(/ss/g,y)}const Xe=g=>new Promise(e=>setTimeout(e,g)),Ye=g=>{if(!g)return"";if(g instanceof Uint8Array)return`[BON:${g.length}b]`;if(Array.isArray(g))return`[Array:${g.length}]`;if(typeof g=="object"){if(Object.keys(g).every(o=>!Number.isNaN(parseInt(o))))return`[BON:Object:${Object.keys(g).length}]`;try{return JSON.stringify(g)}catch{return"[Object]"}}return String(g)};class Je{constructor(e,o,t){this.encoder=e,this.enc=o,this.hint=t,this.commands=new Map}register(e,o={}){return this.commands.set(e,(t=0,i=0,n={})=>{var p,P;return{cmd:e,ack:t,seq:i,hint:this.hint,time:Date.now(),body:(P=(p=this.encoder)==null?void 0:p.bon)!=null&&P.encode?this.encoder.bon.encode({...o,...n}):{...o,...n}}}),this}registerHeartbeat(){return this.commands.set("heart_beat",(e,o)=>({cmd:"war_ping",ack:e,seq:o,hint:this.hint,time:Date.now(),body:{battlefieldId:this.hint}})),this}encodePacket(e){var o;return(o=this.encoder)!=null&&o.encode&&this.enc?this.encoder.encode(e,this.enc):JSON.stringify(e)}build(e,o,t,i){const n=this.commands.get(e);if(!n)throw new Error(`Unknown cmd: ${e}`);return n(o,t,i)}}function Ge(g){return g.registerHeartbeat().register("war_getbattlefieldinfo").register("war_enterbattlefield")}class Ze{constructor({url:e,utils:o,hint:t,heartbeatMs:i=5e3}){var n;this.url=e,this.utils=o||Oe,this.enc=(n=this.utils)!=null&&n.getEnc?this.utils.getEnc("auto"):void 0,this.socket=null,this.ack=0,this.seq=0,this.hint=t,this.sendQueue=[],this.sendQueueTimer=null,this.heartbeatTimer=null,this.heartbeatInterval=i,this.dialogStatus=!1,this.messageListener=null,this.showMsg=!1,this.connected=!1,this.isReconnecting=!1,this.promises=Object.create(null),this.registry=Ge(new Je(this.utils,this.enc,this.hint)),this.onConnect=null,this.onDisconnect=null,this.onError=null}init(){L.info(`è¿æ¥: ${this.url.split("?")[0]}`),this.socket=new WebSocket(this.url),this.socket.onopen=()=>{L.info("è¿æ¥æˆåŠŸ"),this.connected=!0,this._setupHeartbeat(),this._processQueueLoop(),this.onConnect&&this.onConnect()},this.socket.onmessage=e=>{var o;try{let t;if(typeof e.data=="string")t=JSON.parse(e.data);else if(e.data instanceof ArrayBuffer)t=(o=this.utils)!=null&&o.parse?this.utils.parse(e.data,"auto",!0):e.data;else if(e.data instanceof Blob){e.data.arrayBuffer().then(i=>{var n;try{if(t=(n=this.utils)!=null&&n.parse?this.utils.parse(i,"auto",!0):i,t instanceof Object&&t.rawData!==void 0)C.verbose("ProtoMsg Blobæ¶ˆæ¯ï¼Œä½¿ç”¨rawData:",t.rawData);else if(t.body&&this.shouldDecodeBody(t.body))try{if(this.utils&&this.utils.bon&&this.utils.bon.decode){const y=this.convertToUint8Array(t.body);if(y){const k=this.utils.bon.decode(y);C.debug("BON Blobè§£ç æˆåŠŸ:",t.cmd,k),t.decodedBody=k}}else C.warn("BONè§£ç å™¨ä¸å¯ç”¨ (Blob)")}catch(y){C.error("BON Blobæ¶ˆæ¯ä½“è§£ç å¤±è´¥:",y.message,t.cmd)}const p=t._raw||t,P=typeof(p==null?void 0:p.seq)=="number"?p.seq:typeof(t==null?void 0:t.seq)=="number"?t.seq:void 0;typeof P=="number"&&P>=0&&(this.ack=P),this.showMsg,this.messageListener&&this.messageListener(t),this._handlePromiseResponse(t)}catch(p){C.error("Blobè§£æå¤±è´¥:",p.message)}});return}else C.warn("æœªçŸ¥æ•°æ®ç±»å‹:",typeof e.data,e.data),t=e.data;if(this.showMsg&&C.verbose("æ”¶åˆ°æ¶ˆæ¯:",t),t instanceof Object&&t.rawData!==void 0)C.verbose("ProtoMsgæ¶ˆæ¯ï¼Œä½¿ç”¨rawData:",t.rawData);else{const i=t._raw||t,n=typeof i.seq=="number"?i.seq:typeof t.seq=="number"?t.seq:void 0;if(typeof n=="number"&&n>=0&&(this.ack=n),i.body&&this.shouldDecodeBody(i.body))try{if(this.utils&&this.utils.bon&&this.utils.bon.decode){const p=this.convertToUint8Array(i.body);if(p){const P=this.utils.bon.decode(p);C.debug("BONè§£ç æˆåŠŸ:",i.cmd||t.cmd,P),t.decodedBody=P,t._raw&&(t._raw.decodedBody=P)}}else C.warn("BONè§£ç å™¨ä¸å¯ç”¨")}catch(p){C.error("BONæ¶ˆæ¯ä½“è§£ç å¤±è´¥:",p.message,i.cmd||t.cmd)}}this.messageListener&&this.messageListener(t),this._handlePromiseResponse(t)}catch(t){C.error("æ¶ˆæ¯å¤„ç†å¤±è´¥:",t.message)}},this.socket.onclose=e=>{L.info(`WebSocket è¿æ¥å…³é—­: ${e.code} ${e.reason||""}`),L.debug("å…³é—­è¯¦æƒ…:",{code:e.code,reason:e.reason||"æœªæä¾›åŸå› ",wasClean:e.wasClean,timestamp:new Date().toISOString()}),this.connected=!1,this._clearTimers(),this.onDisconnect&&this.onDisconnect(e)},this.socket.onerror=e=>{L.error("WebSocket é”™è¯¯:",e),this.connected=!1,this._clearTimers(),this.onError&&this.onError(e)}}setMessageListener(e){this.messageListener=e}setShowMsg(e){this.showMsg=!!e}shouldDecodeBody(e){if(!e)return!1;if(e instanceof Uint8Array||Array.isArray(e))return!0;if(typeof e=="object"&&e.constructor===Object){const o=Object.keys(e);return o.length>0&&o.every(t=>!isNaN(parseInt(t)))}return!1}convertToUint8Array(e){if(!e)return null;if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if(typeof e=="object"&&e.constructor===Object){const o=Object.keys(e).map(t=>parseInt(t)).sort((t,i)=>t-i);if(o.length>0){const t=Math.max(...o),i=new Array(t+1).fill(0);for(const[n,p]of Object.entries(e)){const P=parseInt(n);!isNaN(P)&&typeof p=="number"&&(i[P]=p)}return C.debug("è½¬æ¢å¯¹è±¡æ ¼å¼bodyä¸ºUint8Array:",i.length,"bytes"),new Uint8Array(i)}}return null}decodeBodyForLog(e){var i,n;if(!e)return null;const o=(n=(i=this.utils)==null?void 0:i.bon)==null?void 0:n.decode;if(typeof o!="function")return null;let t=null;if(e instanceof Uint8Array?t=e:Array.isArray(e)?t=new Uint8Array(e):this.shouldDecodeBody(e)&&(t=this.convertToUint8Array(e)),!t)return null;try{return o(t)}catch(p){return C.warn("æ—¥å¿—è§£æBONå¤±è´¥:",p.message),null}}reconnect(){if(this.isReconnecting){L.debug("é‡è¿å·²åœ¨è¿›è¡Œä¸­ï¼Œè·³è¿‡æ­¤æ¬¡é‡è¿è¯·æ±‚");return}this.isReconnecting=!0,L.info("å¼€å§‹WebSocketé‡è¿..."),this.disconnect(),setTimeout(()=>{try{this.init()}finally{setTimeout(()=>{this.isReconnecting=!1},2e3)}},1e3)}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.connected=!1,this._clearTimers()}send(e,o={},t={}){this.connected||(L.warn(`WebSocket æœªè¿æ¥ï¼Œæ¶ˆæ¯å·²å…¥é˜Ÿ: ${e}`),!this.dialogStatus&&!this.isReconnecting&&(this.dialogStatus=!0,L.info("è‡ªåŠ¨è§¦å‘é‡è¿..."),this.reconnect(),setTimeout(()=>{this.dialogStatus=!1},2e3)));const i=t.seq!==void 0?t.seq:e==="heart_beat"?0:++this.seq,n={cmd:e,params:o,seq:i,hint:this.hint,respKey:t.respKey||e,sleep:t.sleep||0,onSent:t.onSent};return this.sendQueue.push(n),n}sendWithPromise(e,o={},t=5e3){return new Promise((i,n)=>{if(!this.connected&&!this.socket)return n(new Error("WebSocket è¿æ¥å·²å…³é—­"));const p=++this.seq;this.promises[p]={resolve:i,reject:n,originalCmd:e},setTimeout(()=>{delete this.promises[p],n(new Error(`è¯·æ±‚è¶…æ—¶: ${e} (${t}ms)`))},t),this.send(e,o,{seq:p,onSent:()=>{}})})}sendHeartbeat(){L.verbose("å‘é€å¿ƒè·³æ¶ˆæ¯"),this.send("heart_beat",{},{respKey:"war_ping"})}_setupHeartbeat(){setTimeout(()=>{var e;this.connected&&((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN&&(L.debug("å¼€å§‹å‘é€é¦–æ¬¡å¿ƒè·³"),this.sendHeartbeat())},3e3),this.heartbeatTimer=setInterval(()=>{var e;this.connected&&((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN?this.sendHeartbeat():L.warn("å¿ƒè·³æ£€æŸ¥å¤±è´¥: è¿æ¥çŠ¶æ€å¼‚å¸¸")},this.heartbeatInterval)}_processQueueLoop(){this.sendQueueTimer&&clearInterval(this.sendQueueTimer),this.sendQueueTimer=setInterval(async()=>{var o,t;if(!this.sendQueue.length||!this.connected||((o=this.socket)==null?void 0:o.readyState)!==WebSocket.OPEN)return;const e=this.sendQueue.shift();if(e)try{const i=this.registry.build(e.cmd,this.ack,e.seq,e.params);if(i&&i.cmd!=="war_ping"){const p=this.decodeBodyForLog(i.body);L.info("ğŸ“¤ å‘é€æŠ¥æ–‡",{cmd:i.cmd,hint:i.hint??0,ack:i.ack??0,seq:i.seq??0,time:i.time,body:p??Ye(i.body)})}const n=this.registry.encodePacket(i);if((t=this.socket)==null||t.send(n),(this.showMsg||e.cmd==="heart_beat")&&(L.wsMessage("local",e.cmd,!1),this.showMsg&&(L.verbose("åŸå§‹æ•°æ®:",i),L.verbose("ç¼–ç åæ•°æ®:",n),L.verbose("ç¼–ç ç±»å‹:",typeof n,n instanceof Uint8Array?"Uint8Array (åŠ å¯†)":"String (æ˜æ–‡)"),n instanceof Uint8Array&&n.length>0&&L.verbose(`åŠ å¯†éªŒè¯: å‰8å­—èŠ‚ [${Array.from(n.slice(0,8)).join(", ")}]`))),e.onSent)try{const p={respKey:e.respKey,cmd:e.cmd,seq:(i==null?void 0:i.seq)??e.seq,ack:(i==null?void 0:i.ack)??this.ack,time:(i==null?void 0:i.time)??Date.now()};e.onSent(p)}catch(p){L.warn("å‘é€å›è°ƒæ‰§è¡Œå¤±è´¥:",p)}e.sleep&&await Xe(e.sleep)}catch(i){L.error(`å‘é€æ¶ˆæ¯å¤±è´¥: ${e.cmd}`,i)}},50)}_handlePromiseResponse(e){if(e.resp!==void 0&&this.promises[e.resp]){const p=this.promises[e.resp];delete this.promises[e.resp];const P=e.rawData!==void 0?e.rawData:e.decodedBody!==void 0?e.decodedBody:e.body;e.code===0||e.code===void 0?p.resolve(P||e):p.reject(new Error(`æœåŠ¡å™¨é”™è¯¯: ${e.code} - ${e.hint||"æœªçŸ¥é”™è¯¯"}`));return}const o=e.cmd;if(!o)return;const t=typeof o=="string"?o.toLowerCase():o;let n={fight_startpvpresp:"fight_startpvp",activity_getresp:"activity_get",collection_goodslistresp:"collection_goodslist",collection_claimfreerewardresp:"collection_claimfreereward",legion_getarearankresp:"legion_getarearank",legionwar_getgoldmonthwarrankresp:"legionwar_getgoldmonthwarrank",nightmare_getroleinforesp:"nightmare_getroleinfo",studyresp:"study_startgame",role_getroleinforesp:"role_getroleinfo",hero_recruitresp:"hero_recruit",friend_batchresp:"friend_batch",system_claimhanguprewardresp:"system_claimhangupreward",item_openboxresp:["item_openbox","item_batchclaimboxpointreward"],bottlehelper_claimresp:"bottlehelper_claim",bottlehelper_startresp:"bottlehelper_start",bottlehelper_stopresp:"bottlehelper_stop",legion_signinresp:"legion_signin",fight_startbossresp:"fight_startboss",fight_startlegionbossresp:"fight_startlegionboss",fight_startareaarenaresp:"fight_startareaarena",arena_startarearesp:"arena_startarea",arena_getareatargetresp:"arena_getareatarget",arena_getarearankresp:"arena_getarearank",presetteam_saveteamresp:"presetteam_saveteam",presetteam_getinforesp:"presetteam_getinfo",mail_claimallattachmentresp:"mail_claimallattachment",store_buyresp:"store_purchase",system_getdatabundleverresp:"system_getdatabundlever",tower_claimrewardresp:"tower_claimreward",fight_starttowerresp:"fight_starttower",evotowerinforesp:"evotower_getinfo",evotower_fightresp:"evotower_fight",item_openpackresp:"item_openpack",matchteam_getroleteaminforesp:"matchteam_getroleteaminfo",bosstower_getinforesp:"bosstower_getinfo",bosstower_startbossreso:"bosstower_startboss",bosstower_startboxresp:"bosstower_startbox",discount_getdiscountinforesp:"discount_getdiscountinfo",hero_heroupgradestarresp:"hero_heroupgradestar",book_upgraderesp:"book_upgrade",book_claimpointrewardresp:"book_claimpointreward",legion_getinforesp:"legion_getinfo",legion_getinforresp:"legion_getinfo",car_getrolecarresp:"car_getrolecar",car_refreshresp:"car_refresh",car_claimresp:"car_claim",car_sendresp:"car_send",car_getmemberhelpingcntresp:"car_getmemberhelpingcnt",role_gettargetteamresp:"role_gettargetteam",activity_warorderclaimresp:"activity_recyclewarorderrewardclaim",arena_getarearankresp:"arena_getarearank",bosstower_gethelprankresp:"bosstower_gethelprank",task_claimdailyrewardresp:"task_claimdailyreward",task_claimweekrewardresp:"task_claimweekreward",syncresp:["system_mysharecallback","task_claimdailypoint"],syncrewardresp:["system_buygold","discount_claimreward","card_claimreward","artifact_lottery","genie_sweep","genie_buysweep","system_signinreward","dungeon_selecthero"]}[t];n?typeof n=="string"&&(n=[n]):n=[t];for(const[p,P]of Object.entries(this.promises))if(n.includes(P.originalCmd)){delete this.promises[p];const y=e.rawData!==void 0?e.rawData:e.decodedBody!==void 0?e.decodedBody:e.body;e.code===0||e.code===void 0?P.resolve(y||e):P.reject(new Error(`æœåŠ¡å™¨é”™è¯¯: ${e.code} - ${e.hint||"æœªçŸ¥é”™è¯¯"}`));break}}_clearTimers(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.sendQueueTimer&&(clearInterval(this.sendQueueTimer),this.sendQueueTimer=null)}}const et={class:"legion-war-container"},tt={class:"legion-war-map"},nt={class:"map-title"},ot={class:"map-container"},it={class:"legion-war-operation"},st={class:"legion-war-operation-container"},rt={class:"legion-war-operation-item"},at={class:"legion-war-operation-item"},dt={class:"legion-war-operation-item"},Q=13.25,Ie=2.75,lt={__name:"LegionWar",setup(g){const e=De(),o=Ae();let t=null;const i=$(null),n=$(!1),p=$(_e("yyyy-MM-dd HH:mm:ss"));ee(()=>(t==null?void 0:t.status)==="connected"?"å·²è¿æ¥":"æœªè¿æ¥");const P=ee(()=>(t==null?void 0:t.status)==="connected"?"connected":"disconnected"),y=ee(()=>n.value?"status-connected":"status-disconnected");ee(()=>(P==null?void 0:P.value)==="connected");const k=$(!1),M=$(!1),R=function(s){oe()},z=async function(){let s=Object.values(N.value.legionInfo);const a=[];for(let c=0;c<2;c++){let m="";for(let _=0;_<10;_++){const r=s[_+c*10];_!=0&&(m+=`
`),m+=r.name+":å‰©"+(150-r.reviveCount)}a.push(m)}const d=e.selectedToken.id,l=1500;for(let c=0;c<a.length;c++){await new Promise(m=>setTimeout(m,l));try{await e.sendMessageToLegion(d,a[c])}catch(m){m.message.includes("é¢‘ç¹")&&(await new Promise(_=>setTimeout(_,l*2)),await e.sendMessageToLegion(d,a[c]))}}},ne=$(null);let h=null;const j=window.devicePixelRatio||1;let G=null;const xe=2*Q,de=Math.sqrt(3)*Q,u=Array.from({length:41},()=>Array.from({length:41},()=>0));let T=[0,0],N=$(null);const le=$(null),He=(s,a,d)=>{h.beginPath();for(let l=0;l<6;l++){const c=2*Math.PI/6*l,m=s+Q*Math.cos(c),_=a+Q*Math.sin(c);l===0?h.moveTo(m,_):h.lineTo(m,_),m>=T[0]&&(T[0]=m),_>=T[1]&&(T[1]=_)}h.closePath(),h.fillStyle=d,h.fill(),h.strokeStyle=d,h.stroke()},oe=(s=0,a=0,d="")=>{s!==0&&a!==0?ge(s,a,d):ge(),we(),ve(N.value)},ge=(s=0,a=0,d="")=>{h.clearRect(0,0,h.canvas.width/j,h.canvas.height/j);let l=ae.getInstance();if(l.removeAllNode(),N.value=Qe(le.value,k.value),N.value&&l.addNodeList(Object.values(N.value.buildingData).map(r=>({id:r.id,type:r.type,belongsLegionId:r.belongsLegionId,hP:r.hP,maxHP:r.maxHP,point:r.point,belongsLegionInfo:N.value.legionInfo[r.belongsLegionId]}))),!N.value)return;if(!k.value)Object.values(N.value.legionInfo).forEach(r=>{let b=Object.keys(r.buildings).sort((f,x)=>{const[S,H]=f.split("_").map(Number),[O,W]=x.split("_").map(Number),F=S-O;return F!==0?F:H-W});for(let f=0;f<b.length;f++)for(let x=f;x<b.length;x++){let S=l.findShortestPath(b[f],b[x],r.id);S&&S.forEach(H=>{H.belongsLegionId=r.id,H.colorBg=r.color})}});else{let r=Object.values(N.value.legionInfo);for(let b=0;b<r.length;b++){let f=l.getNodeByCoords(r[b].strongholdId);f.belongsLegionId=r[b].id,f.colorBg=r[b].color}}l.getAllNodes().forEach(r=>{let b=r.position.x,f=r.position.y;k.value&&r.type!=4&&(r.belongsLegionId=-1,r.colorBg=Le(9)),parseInt(b)>=0&&parseInt(b)<41&&parseInt(f)>=0&&parseInt(f)<32?u[parseInt(f)][parseInt(b)]=r:console.warn(`åæ ‡[${b},${f}]è¶Šç•Œï¼Œè·³è¿‡èµ‹å€¼`)}),k.value||(u[16][19].belongsLegionId=u[17][20].belongsLegionId,u[17][19].belongsLegionId=u[17][20].belongsLegionId,u[16][21].belongsLegionId=u[17][20].belongsLegionId,u[17][21].belongsLegionId=u[17][20].belongsLegionId,u[16][20].belongsLegionId=u[17][20].belongsLegionId,u[18][20].belongsLegionId=u[17][20].belongsLegionId,u[16][21].colorBg=u[17][20].colorBg,u[17][21].colorBg=u[17][20].colorBg,u[16][19].colorBg=u[17][20].colorBg,u[17][19].colorBg=u[17][20].colorBg,u[16][20].colorBg=u[17][20].colorBg,u[18][20].colorBg=u[17][20].colorBg);let m={},_=[];for(let r=0;r<=31;r++)for(let b=0;b<=40;b++)if(r>2&&u[r][b]!=0){const f=b*(xe*.75)+Q+Ie*b,x=r*de+(b%2===1?de/2:0)+Ie*r;let S=u[r][b].colorBg;if(s!==0&&a!==0){const H=Math.sqrt((s-f)**2+(a-x)**2);d==="mousemove"?S=H<Q?"#42b983":S:d==="click"&&H<Q&&(m=u[r][b])}if(He(f,x,S),u[r][b].type!=9){let H=u[r][b].typeName.replace("æ®ç‚¹","");H=="å¤§æœ¬è¥"&&(h.fillStyle="#055138",H=N.value.legionInfo[u[r][b].belongsLegionId].name),_.push({x:f-13,y:x+4,name:H})}}for(let r=0;r<_.length;r++)h.fillStyle="black",h.font="bold 12px Microsoft Yahei",h.fillText(_[r].name,_[r].x,_[r].y);m.type!=9&&Object.keys(m).length>0&&d==="click"&&Se(s,a,m)},we=()=>{h.beginPath(),h.moveTo(T[0]+10,T[1]),h.lineTo(T[0]+10,10),h.closePath(),h.strokeStyle="#000",h.stroke()},ve=s=>{if(s){let a={};if(!M.value)s=Object.values(s.legionInfo).sort((d,l)=>l.score-d.score).map(d=>[d.name,d.killCnt,d.reviveCount+"/150",d.score,d.redCount,Ve(d.power),d.participantsCount+"/"+d.memberCount,d.danCount,d.blessingCount+"ä¸ªå…±"+d.blessingScore+"åˆ†",d.color]),a={x:T[0]+20,y:20,columns:9,rows:20,headerData:["ä¿±ä¹éƒ¨åç§°","å‡»æ€æ•°","å…è´¹å¤æ´»","ç§¯åˆ†","çº¢æ•°","æˆ˜åŠ›","äººæ•°","èŠ±è´¹æ€»ä¸¹","å››åœ£"],tableData:s||[],columnWidth:78,rowHeight:37,scale:1};else{let d=[];Object.values(s.memberInfo).forEach(l=>{var c,m;l.legionId==((m=(c=e.gameData)==null?void 0:c.roleInfo)==null?void 0:m.role.legionId)&&d.push([l.name,l.kill,l.die,l.revive+"/5",l.score,l.digGround,l.dan,parseFloat(l.kill/l.die).toFixed(2)])}),d=d.sort((l,c)=>c[1]-l[1]),a={x:T[0]+20,y:20,columns:8,rows:d?d.length:30,headerData:["åç§°","å‡»æ€æ•°","æ­»äº¡æ¬¡æ•°","å·²å¤æ´»æ¬¡æ•°","ç§¯åˆ†","åˆ¨åœ°","å¤æ´»ä¸¹","K/D"],tableData:d||[],columnWidth:88,rowHeight:25,scale:1}}ke(h,a)}},ke=(s,a)=>{var Pe,be;const l={...{columnWidth:80,rowHeight:25,headerBgColor:"#42b983",cellBgColor:"#ffffff",borderColor:"#333333",headerTextColor:"#ffffff",cellTextColor:"#373737",fontSize:14,font:"Arial",scale:1},...a},{x:c,y:m,columns:_,rows:r,headerData:b,tableData:f,columnWidth:x,rowHeight:S,headerBgColor:H,cellBgColor:O,borderColor:W,headerTextColor:F,cellTextColor:ie,fontSize:K,font:Y,scale:U}=l;let v=x*U;const w=S*U,J=K*U,q=1*U;s.save(),s.strokeStyle=W,s.lineWidth=q,s.strokeRect(c,m,_*v,(r+1)*w);let D=c,Z=20,he=20;for(let A=0;A<_;A++){s.fillStyle=H;let B=A===0?v+Z:v;B=A===1?v-he:B,s.fillRect(D,m,B,w),s.strokeRect(D,m,B,w),s.fillStyle=F,s.font=`${J}px ${Y}`,s.textAlign="center",s.textBaseline="middle",s.fillText(b[A]||"",D+B/2,m+w/2),D+=B}for(let A=0;A<r;A++){D=c;for(let B=0;B<_;B++){let V=B===0?v+Z:v;V=B===1?v-he:V,s.fillStyle=((Pe=f[A])==null?void 0:Pe[9])||O;const se=D,re=m+(A+1)*w;s.fillRect(se,re,V,w),s.strokeRect(se,re,V,w),s.fillStyle=ie,s.font=`${J}px ${Y}`,s.textAlign="center",s.textBaseline="middle",s.fillText(((be=f[A])==null?void 0:be[B])||"0",se+V/2,re+w/2),D+=V}}s.restore()},Se=(s,a,d,l=1,c=0,m=0,_={})=>{var J;const r={boxWidth:200,boxPadding:10,bgColor:"rgba(0, 0, 0, 0.8)",borderColor:"#ffffff",borderWidth:1,fontColor:"#ffffff",fontSize:14,font:"Arial",gap:10,..._};let b="";if(typeof d=="object"&&d!==null){b=Object.entries(d).map(([D,Z])=>`${D}: ${Z}`).join(`
`);let q=d;b=`åæ ‡:${q.id}
è¡€é‡:${q.hP}/${q.maxHP}
ç±»å‹:${q.typeName}
åˆ†æ•°:${q.point}
æ‰€å±ä¿±ä¹éƒ¨:${((J=N.value.legionInfo[q.belongsLegionId])==null?void 0:J.name)||"æ— æ‰€å±"}`}else b=String(d||"æ— æ•°æ®");const f=b.split(`
`),x=r.boxWidth*l,S=r.boxPadding*l,H=r.fontSize*l,O=r.borderWidth*l,W=r.gap*l,F=H*1.4,K=f.length*F+2*S,Y=s*l+c,U=a*l+m;let v=Y+W,w=U+W;h.canvas.width/j,h.canvas.height/j,v+x>T[0]+10&&(v=Y-x-W),w+K>T[1]+20&&(w=U-K-W),v=Math.max(O,v),w=Math.max(O,w),h.save(),h.fillStyle=r.bgColor,h.fillRect(v-O,w-O,x+2*O,K+2*O),h.strokeStyle=r.borderColor,h.lineWidth=O,h.strokeRect(v,w,x,K),h.fillStyle=r.fontColor,h.font=`${H}px ${r.font}`,h.textBaseline="top",f.forEach((q,D)=>{h.fillText(q,v+S,w+S+D*F)}),h.restore()};function pe(s){const a=s.parentElement,d=a.clientWidth,l=a.clientHeight;s.width=d*j,s.height=l*j,h.scale(j,j),oe()}const Ce=()=>{if(!e.selectedToken){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªToken"),router.push("/tokens");return}try{const s=e.selectedToken.id,a=e.selectedToken.token;e.createWebSocketConnection(s,a),o.info("æ­£åœ¨å»ºç«‹ WebSocket è¿æ¥..."),setTimeout(async()=>{if(e.getWebSocketStatus(s)==="connected"){o.success("WebSocket è¿æ¥æˆåŠŸ");const l=await e.sendMessageWithPromise(s,"legion_getbattlefield",{},1e4);ce(l)}},2e3)}catch(s){console.error("WebSocketè¿æ¥å¤±è´¥:",s),o.error("WebSocketè¿æ¥å¤±è´¥")}},ce=async s=>{if(e.selectedToken){const a=e.selectedToken.id;if(e.getWebSocketStatus(e.selectedToken.id)!=="connected"){Ce();return}const l=(s==null?void 0:s.info.domainName)+`?p=${encodeURIComponent(e.selectedToken.token)}&e=x&sid2=${s.info.sid}&lang=chinese&sid2=${s.info.sid}`;i.value=s.info.battlefieldId,t=new Ze({url:l,utils:null,hint:i.value,heartbeatMs:5e3}),t.onConnect=async()=>{try{setTimeout(()=>{n.value=!0,o.success("å·²è¿›å…¥æˆ˜åœº")},5e3)}catch(c){console.error(`åˆå§‹è¯·æ±‚ç›åœºä¿¡æ¯å¤±è´¥ [${a}]`,c)}},t.setMessageListener(c=>{((c==null?void 0:c.cmd)||"unknown").includes("war_getbattlefieldinfo")&&(le.value=c==null?void 0:c.rawData,pe(ne.value))}),t.onDisconnect=c=>{c.code===1006||c.reason,console.log(c)},t.onError=c=>{console.log(c)},t.init()}},Be=async()=>{n.value?(t.send("war_getbattlefieldinfo",{battlefieldId:i.value}),p.value=_e("")):o.error("æš‚æœªè¿›å…¥æˆ˜åœº,è¯·ç¨å")};return qe(()=>{ce();const s=ne.value;h=s.getContext("2d"),G=()=>pe(s),G(),s.addEventListener("click",a=>{const d=s.getBoundingClientRect(),l=a.clientX-d.left,c=a.clientY-d.top;h.font="12px Arial",h.fillStyle="rgb(0,0,0)",oe(l,c,"click")}),window.addEventListener("resize",G)}),Me(()=>{window.removeEventListener("resize",G)}),(s,a)=>{const d=ye("n-button"),l=ye("n-switch");return We(),je("div",et,[I("div",tt,[I("div",nt,[a[3]||(a[3]=I("div",{class:"map-title-item"}," æˆ˜åœºå›¾ç¤º ",-1)),I("div",null,[a[2]||(a[2]=I("span",null,"æ˜¯å¦è¿›å…¥æˆ˜åœº:",-1)),te(d,{text:"",onClick:Be},{default:me(()=>[I("span",{class:$e(Ee(y))},fe(n.value?"å·²è¿›å…¥æˆ˜åœº":"é‡æ–°è¿›å…¥æˆ˜åœº"),3)]),_:1}),ue(" å½“å‰æ—¶é—´-"+fe(p.value),1)])]),I("div",ot,[I("canvas",{ref_key:"legionWarMapDom",ref:ne,class:"mapCanvas"},null,512)])]),I("div",it,[a[9]||(a[9]=I("div",{class:"legion-war-operation-title"},[I("div",{class:"operation-title-item"}," æ“ä½œé¢æ¿ ")],-1)),I("div",st,[I("div",rt,[a[4]||(a[4]=I("div",null," å é¢†å¸ƒå±€ ",-1)),I("div",null,[te(l,{value:k.value,"onUpdate:value":[a[0]||(a[0]=c=>k.value=c),R]},null,8,["value"])]),a[5]||(a[5]=I("div",null," åˆ†å¸ƒå¸ƒå±€ ",-1))]),I("div",at,[a[6]||(a[6]=I("div",null," æˆ˜é˜Ÿæˆ˜å†µ ",-1)),I("div",null,[te(l,{value:M.value,"onUpdate:value":[a[1]||(a[1]=c=>M.value=c),R]},null,8,["value"])]),a[7]||(a[7]=I("div",null," ä¸ªäººæˆ˜å†µ ",-1))]),I("div",dt,[te(d,{type:"primary",onClick:z,style:{padding:"12px"}},{default:me(()=>[...a[8]||(a[8]=[ue(" å‘é€å„æˆ˜é˜Ÿå…è´¹å¤æ´»åˆ°æˆ˜é˜Ÿé¢‘é“ ",-1)])]),_:1})])])])])}}},ht=Re(lt,[["__scopeId","data-v-76271b6e"]]);export{ht as default};
